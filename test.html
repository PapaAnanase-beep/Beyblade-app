<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beyblade ANANAS</title>
<link rel="icon" href="tlo.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Kode+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@2.10.1/dist/dom-to-image-more.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* ============================================= */
    /* === PODSTAWOWE STYLE I UKÅAD APLIKACJI === */
    /* ============================================= */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: 'Kode Mono', monospace;
        background: #101018;
        color: #f0f0f0;
        overflow-x: hidden;
        text-align: center;
    }

    * {
        -webkit-tap-highlight-color: transparent;
        box-sizing: border-box;
    }

    button, a, select, input, textarea {
        outline: none;
    }

    #vanta-background {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 0;
    }

    #app-container {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        padding: 20px;
        margin-left: 50px;
        transition: margin-left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .page {
        display: none;
        padding-top: 20px;
        animation: fadeInPage 0.5s ease-in-out;
    }

    .page.active {
        display: block;
    }

    @keyframes fadeInPage {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* ========================================= */
    /* === EKRAN ÅADOWANIA (LOADER) === */
    /* ========================================= */
    #loader-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: #101018;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        z-index: 10001;
        transition: opacity 0.7s ease-in-out;
        opacity: 1;
    }

    #loader-overlay.hidden {
        opacity: 0;
        pointer-events: none;
    }

    .loader-spinner {
        border: 6px solid rgba(255, 255, 255, 0.2);
        border-top: 6px solid #a25ff0;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1.2s linear infinite;
    }

    .loader-text {
        margin-top: 20px;
        color: #ccc;
        font-size: 1.5em;
        font-family: monospace;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    #app-container, .sidebar {
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
    }

    #app-container.loaded, .sidebar.loaded {
        visibility: visible;
        opacity: 1;
    }

    /* ========================================= */
    /* === PASEK BOCZNY (SIDEBAR) === */
    /* ========================================= */
    .sidebar {
        height: 100%; width: 50px; position: fixed; top: 0; left: 0;
        background: rgba(30, 30, 30, 0.75);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        box-shadow: 3px 0 15px rgba(0, 0, 0, 0.6);
        transition: width 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 0 15px 15px 0;
        z-index: 2000;
        display: flex; flex-direction: column;
        overflow-x: hidden;
    }
    .sidebar.expanded { width: 260px; }
    .openbtn-container { width: 100%; padding: 10px 0 8px 0; display: flex; }
    .sidebar.expanded .openbtn-container { padding-left: 10px; padding-right: 10px; }
    .openbtn { cursor: pointer; display: flex; align-items: center; gap: 12px; border-radius: 10px; transition: background-color 0.25s ease; padding: 10px; margin: 0 auto; }
    .sidebar.expanded .openbtn { margin: 0; }
    .openbtn img { width: 28px; height: 28px; display: block; flex-shrink: 0; }
    .openbtn .menu-text { color: #f0f0f0; font-size: 1.0em; font-weight: bold; opacity: 0; max-width: 0; overflow: hidden; white-space: nowrap; transition: opacity 0.25s ease 0.1s, max-width 0.25s ease 0.1s; }
    .sidebar.expanded .openbtn .menu-text { opacity: 1; max-width: 120px; }
    .sidebar-links { width: 100%; overflow-y: auto; max-height: calc(100% - 70px); }
    /* POPRAWKA SELEKTORA - dotyczy tylko linkÃ³w w menu */
    .sidebar .sidebar-links a { display: flex; align-items: center; gap: 12px; color: #e0e0e0; text-decoration: none; transition: background-color 0.25s ease, color 0.25s ease; border-radius: 8px; white-space: nowrap; overflow: hidden; padding: 12px; justify-content: center; width: auto; margin: 4px auto; }
    .sidebar:not(.expanded) .sidebar-links a span { display: none; }
    .sidebar.expanded .sidebar-links a { width: calc(100% - 20px); margin: 4px 10px; padding: 12px 10px; justify-content: flex-start; }
    .sidebar a:hover { background: rgba(70, 70, 70, 0.8); }
    .sidebar a img { width: 22px; height: 22px; flex-shrink: 0; }
    .sidebar a.active-link { background: rgba(138, 43, 226, 0.4); font-weight: bold; color: #fff; }
    .sidebar a.active-link:hover { background: rgba(138, 43, 226, 0.5); }
    .sidebar a.help-link:hover { background: rgba(50, 140, 220, 0.6); }

    /* ========================================= */
    /* === OGÃ“LNE ELEMENTY FORMULARZY === */
    /* ========================================= */
    label { display: block; margin-bottom: 5px; color: #ccc; font-size: 0.9em; text-align: left; }
    select, input[type="text"], input[type="number"], input[type="url"], input[type="search"], textarea {
        width: 100%;
        padding: 12px 15px;
        margin: 0 0 10px 0;
        background: rgba(45, 45, 55, 0.8);
        color: #f0f0f0;
        font-family: 'Kode Mono', monospace;
        font-size: 1em;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    select:focus, input:focus, textarea:focus {
        border-color: rgba(138, 43, 226, 0.7);
        box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.25);
    }
    textarea { resize: vertical; min-height: 80px; }

    /* ========================================= */
    /* === PRZYCISKI I KARTY (CARDS) === */
    /* ========================================= */
    button { cursor: pointer; background: rgba(80, 85, 95, 0.8); color: #f0f0f0; transition: background-color 0.2s ease, transform 0.1s ease; border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px 18px; font-family: 'Kode Mono', monospace; font-size: 1em; border-radius: 8px; font-weight: bold; }
    button:hover { background: rgba(100, 105, 115, 0.9); }
    button:active { transform: scale(0.97); }
    button:disabled { background: rgba(60, 60, 70, 0.7); color: #888; cursor: not-allowed; }
    button.danger-btn { background: rgba(190, 50, 50, 0.7); }
    button.danger-btn:hover { background: rgba(210, 60, 60, 0.8); }
    .card { background: rgba(35, 35, 45, 0.75); backdrop-filter: blur(6px); border-radius: 15px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5); padding: 20px; margin: 15px 0; text-align: center; }
    .card h2, .page > h2 { margin-top: 0; margin-bottom: 20px; color: #a25ff0; font-weight: bold; text-align: center; }
    .card h3 { margin-top: 0; margin-bottom: 15px; color: #b27ff0; font-weight: bold; }
    .card h4 { margin-top: 0; margin-bottom: 8px; color: #c080ff; font-weight: bold; }
    .card p { font-size: 0.95em; line-height: 1.6; color: #d0d0d0; }
    .card p strong { color: #a25ff0; }
    
    /* ========================================= */
    /* === MAGAZYN I FILTRY === */
    /* ========================================= */
    #magazyn-filtry-container { display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-end; gap: 20px; padding-bottom: 10px; }
    .filtr-item { flex-grow: 1; flex-basis: 220px; max-width: 300px; text-align: left; }
    #magazyn-filtry-container select, #magazyn-filtry-container .search-input-container { margin-bottom: 0 !important; }
    .search-input-container { position: relative; }
    #searchMagazynByName { -webkit-appearance: none; appearance: none; padding: 12px 15px 12px 40px !important; margin: 0; }
    #searchMagazynByName::-webkit-search-cancel-button { -webkit-appearance: none; appearance: none; height: 20px; width: 20px; cursor: pointer; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23999'><path d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/></svg>"); opacity: 0.6; transition: opacity 0.2s; }
    #searchMagazynByName::-webkit-search-cancel-button:hover { opacity: 1; }
    #lista-magazyn { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; }
    #lista-magazyn .card { display: flex; flex-direction: column; justify-content: space-between; padding: 15px; }
  #lista-magazyn img.part-img {
    width: 100px;
    height: 100px;
    object-fit: contain;
    margin-bottom: 10px;
    /* --- NOWE LINIE DO CENTROWANIA --- */
    margin-left: auto;
    margin-right: auto;
}
    #lista-magazyn h3 { font-size: 1.05em; margin: 5px 0; color: #e0e0e0; }
    #lista-magazyn p { font-size: 0.8em; margin: 3px 0; line-height: 1.3; color: #bbb; }
    .item-quantity-controls { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 12px; }
    .quantity-btn { font-size: 1.2em; padding: 6px 12px; min-width: 40px; }
    .quantity-display { font-size: 1.1em; font-weight: bold; background-color: rgba(0, 0, 0, 0.15); border-radius: 6px; min-width: 30px; text-align: center; padding: 5px 10px; }
    .mode-switch-btn { font-size: 0.75em; padding: 4px 8px; background-color: rgba(138, 43, 226, 0.4); border: 1px solid rgba(138, 43, 226, 0.6); font-weight: normal; }

    /* ========================================= */
    /* === GALERIA DECKÃ“W I WYKRESY === */
    /* ========================================= */
    #savedDecksContainer { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
    .deck-card-set-preview { position: relative; border-radius: 10px; background-color: rgba(0, 0, 0, 0.15); padding: 15px; margin-bottom: 15px; overflow: visible; }
    .deck-card-set-preview:last-child { margin-bottom: 0; }
    .deck-card-set-preview:before { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 180px; height: 180px; background-image: var(--bg-symbol-url); background-repeat: no-repeat; background-position: center; background-size: contain; opacity: 0.15; z-index: 0; }
.wynik-zestaw-obrazki {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    padding: 8px 5px;
	padding-left: 40px;
    /* Linia 'width: 100%;' zostaÅ‚a usuniÄ™ta */
    align-self: center; /* Ta linia pomaga w centrowaniu w pionie/poziomie w zaleÅ¼noÅ›ci od kontekstu flex */
}
.wynik-zestaw-obrazki {
    padding: 0;
}
.cx-images-container { 
    flex-direction: column; 
    align-items: center; 
}
.cx-blade-row, .cx-drive-row { 
    width: 100%;
}
    .wynik-zestaw-obrazki img.deck-part-img { height: 60px; max-width: 60px; object-fit: contain; }

    /* ZNAJDÅ¹ I WYKASUJ TEN BLOK */
    .set-info-wrapper {
        flex: 1;
        min-width: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    

.set-chart-container {
    flex-shrink: 0;
    /* Ustawiamy docelowy, wiÄ™kszy rozmiar */
    width: 160px;
    height: 160px;
    position: relative;
}
saved-deck-card {
    padding-right: 25px; /* 20px domyÅ›lnego paddingu + 5px dodatkowego */
}
.set-chart-container canvas { width: 100% !important; height: 100% !important; }
    .set-header-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 8px; }
    .set-icons-container { display: flex; gap: 8px; padin;}
    .set-icons-container .set-icon { height: 28px; width: 28px; object-fit: contain; border-radius: 5px; padding: 2px;margin-left:10px; }
   /* ======================================================= */
/* === OSTATECZNA POPRAWKA: Statystyki w osobnych liniach === */
/* ======================================================= */
.stat-grid {
    display: block; /* Zmieniamy z flex na block, aby elementy ukÅ‚adaÅ‚y siÄ™ pionowo */
    margin-top: 10px;
    font-size: 0.9em; /* Lekko powiÄ™kszamy czcionkÄ™ dla czytelnoÅ›ci */
    line-height: 1.6; /* ZwiÄ™kszamy odstÄ™p miÄ™dzy liniami */
    text-align: center;   /* WyrÃ³wnujemy tekst do lewej wewnÄ…trz kolumny statystyk */
    padding-left: 20px; /* Dodajemy wciÄ™cie, aby wyglÄ…daÅ‚o jak lista */
}

/* 
  Ta reguÅ‚a zamienia kaÅ¼dy element <span> ze statystykÄ… w osobny blok,
  co wymusza jego wyÅ›wietlenie w nowej linii.
*/
.stat-grid span {
    display: block; /* KLUCZOWA ZMIANA */
    margin-bottom: 3px; /* MaÅ‚y odstÄ™p pod kaÅ¼dÄ… statystykÄ… */
}
.stat-grid span { white-space: nowrap; }
    .set-info-wrapper div[style*="break-word"], .set-info-wrapper .stat-grid { word-break: break-all; hyphens: auto; }
    @media (max-width: 500px) { .set-preview-with-chart { flex-direction: column; } .set-chart-container { width: 180px; height: 180px; margin-top: 15px; } }

    /* ========================================= */
    /* === INNE === */
    /* ========================================= */
    .inline-icon { height: 1.5em; width: auto; vertical-align: -0.35em; margin: 0 4px; }
    .action-button-container { background: rgba(40, 40, 50, 0.7); backdrop-filter: blur(10px); border-radius: 12px; padding: 20px; margin-top: 15px; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.45); }
    .action-button-container h4 { margin: 0 0 12px 0; color: #a25ff0; }
    .action-button-container p { font-size: 0.9em; color: #bbb; }
    #notification-bar { position: fixed; top: 0; left: 0; width: 100%; color: white; text-align: center; padding: 14px; font-size: 1em; font-weight: bold; z-index: 10000; display: none; border-radius: 0 0 12px 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.35); opacity: 0; transition: opacity 0.3s ease-in-out; }
    #notification-bar.notification-show { opacity: 1; }
    #generator-obraz img { display: block; max-width: 220px; width: 70%; height: auto; margin: 10px auto; animation: rotateImg 10s linear infinite; border-radius: 12px; }
    .info-panels-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
    .info-panel { text-align: left; display: flex; flex-direction: column; }
    .info-list { max-height: calc(1.6em * 6 + 10px * 5); overflow-y: auto; list-style-position: inside; padding-right: 10px; line-height: 1.6; font-size: 0.9em; }
    @media (max-width: 768px) { .info-panels-container { grid-template-columns: 1fr; } }
    .score-counter-card { display: flex; flex-wrap: wrap; justify-content: space-around; gap: 20px; padding: 25px; align-items: flex-start; }
    .player-section { background-color: rgba(25, 25, 35, 0.6); padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); max-width: 450px; width: 100%; }
    .score-display { font-size: 4.5em; font-weight: bold; background-color: rgba(10,10,10,0.4); padding: 15px 25px; border-radius: 10px; margin-bottom: 20px; border: 2px solid rgba(138, 43, 226, 0.3); }
    .score-buttons button { font-size: 1.1em; padding: 10px 18px; margin: 5px; min-width: 60px; }
    .game-controls { margin-top: 20px;
  flex-basis: 100%;
    width: 100%;
    text-align: center;	}
    .fullscreen-finish-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: black; display: none; justify-content: center; align-items: center; z-index: 9000; opacity: 0; transition: opacity 0.3s ease-in-out; }
    .fullscreen-finish-overlay.visible { display: flex; opacity: 1; }
    .fullscreen-finish-overlay img { max-width: 80vw; max-height: 80vh; object-fit: contain; animation: zoomInFinishImage 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes zoomInFinishImage { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @media (max-width: 600px) { .score-counter-card { padding: 15px; } .player-section { padding: 15px; } .score-display { font-size: 3.5em; } .score-buttons button { font-size: 1em; padding: 8px 15px; } }
    .deck-builder-container { display: flex; gap: 20px; }
    .available-parts-panel { width: 300px; padding: 15px; background: rgba(40,40,50,0.7); border-radius: 10px; height: fit-content; max-height: 70vh; overflow-y: auto; }
    .available-parts-panel h4 { margin: 0 0 10px 0; color: #c080ff; }
    .available-part-item { display: flex; align-items: center; gap: 10px; padding: 8px; margin-bottom: 8px; background: rgba(55,55,65,0.8); border-radius: 6px; cursor: grab; }
    .available-part-item img { width: 40px; height: 40px; object-fit: contain; border-radius: 4px; }
    .dragging { opacity: 0.5; border: 2px dashed #8a2be2; }
    .deck-set-slots-container { flex-grow: 1; }
    .deck-part-slot { min-height: 70px; padding: 10px; margin-bottom: 10px; background: rgba(30,30,40,0.6); border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .deck-part-slot.drag-over-target { background-color: rgba(138,43,226,0.2); border-color: #8a2be2; }
    .deck-part-slot.filled { border-style: solid; background: rgba(45,45,55,0.7); justify-content: space-between; padding: 5px 10px; }
    .deck-part-slot .part-info-container { display: flex; align-items: center; gap: 8px; }
    .deck-part-slot img { width: 50px; height: 50px; object-fit: contain; }
    .deck-part-slot .remove-part-btn { background: none; border: none; color: #ff6b6b; font-size: 1.3em; cursor: pointer; padding: 5px; }
.tabs-container {
    display: flex;
    flex-wrap: wrap; /* KLUCZOWA ZMIANA: Pozwala przyciskom zawijaÄ‡ siÄ™ do nowej linii */
    justify-content: center; /* Dodatkowo wycentruje przyciski, gdy siÄ™ zawinÄ… */
    gap: 5px; /* MaÅ‚y odstÄ™p miÄ™dzy przyciskami */
    margin-bottom: 15px;
 
}
.tab-button { padding: 10px 18px; cursor: pointer; background-color: rgba(55, 55, 65, 0.7); color: #ccc; border: none; border-radius: 6px 6px 0 0; font-family: 'Kode Mono', monospace; font-size: 0.95em; transition: all 0.2s; }
    .tab-button:hover { background-color: rgba(70, 70, 80, 0.8); color: #fff; }
    .tab-button.active { background-color: rgba(35,35,45,0.75); color: #a25ff0; border-bottom: 2px solid #a25ff0; }
    @media (max-width: 768px) { .deck-builder-container { flex-direction: column; } .available-parts-panel { width: 100%; max-height: 40vh; } }
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: rgba(138, 43, 226, 0.5); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(138, 43, 226, 0.8); }
    html { scrollbar-width: thin; scrollbar-color: rgba(138, 43, 226, 0.7) rgba(0, 0, 0, 0.2); }
	@keyframes rotateImg {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.deck-card-set-preview.exporting-png::before {
    display: none !important;
}
/* Styl dla tymczasowego obrazka tÅ‚a przy eksporcie PNG */
.background-symbol-img {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 180px;
    height: 180px;
    object-fit: contain;
    z-index: -1; /* UmieÅ›Ä‡ obrazek pod treÅ›ciÄ… */
    pointer-events: none; /* Zapobiegaj przechwytywaniu klikniÄ™Ä‡ */
}
/* Styl dla kontenera z ikonkÄ… lupy */
.search-input-container {
    position: relative;
}

/* GÅ‚Ã³wne style dla pola wyszukiwania */
#searchMagazynByName {
    /* Usuwa domyÅ›lny wyglÄ…d w niektÃ³rych przeglÄ…darkach */
    -webkit-appearance: none;
    appearance: none;
    
    /* NAJWAÅ»NIEJSZE: Dodaje wewnÄ™trzny odstÄ™p po lewej stronie, aby zrobiÄ‡ miejsce na ikonkÄ™ lupy */
    padding: 12px 15px 12px 40px !important;
    
    margin: 0; /* Usuwa domyÅ›lne marginesy */
}
/* Styl dla przycisku 'X' (wyczyÅ›Ä‡) w przeglÄ…darkach WebKit (Chrome, Safari) */
#searchMagazynByName::-webkit-search-cancel-button {
    -webkit-appearance: none;
    appearance: none;
    height: 20px;
    width: 20px;
    cursor: pointer;
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23999'><path d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/></svg>");
    opacity: 0.6;
    transition: opacity 0.2s;
}

/* Efekt po najechaniu na przycisk 'X' */
#searchMagazynByName::-webkit-search-cancel-button:hover {
    opacity: 1;
}
/* ======================================================= */
/* === OSTATECZNA POPRAWKA: Style dla nazw pod obrazkami === */
/* ======================================================= */

.part-with-name {
    display: flex;
    flex-direction: column; /* Ustawia obrazek nad tekstem */
    align-items: center;    /* Centruje w poziomie */
    text-align: center;
    max-width: 80px; /* Ogranicza szerokoÅ›Ä‡, by dÅ‚ugie nazwy siÄ™ zawijaÅ‚y */
}

.part-name-label {
    font-size: 0.75em;
    color: #ccc;
    margin-top: 5px;
    line-height: 1.2;
    word-break: break-word; /* Zapewnia zawijanie dÅ‚ugich nazw */
    hyphens: auto;
}

/* Poprawka dla kontenera obrazkÃ³w, aby daÄ‡ mu wiÄ™cej przestrzeni */
.wynik-zestaw-obrazki, .cx-images-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    align-items: flex-start;
    width: 100%; 
    padding: 0; 
}
#galeriaDeckow .cx-images-container,
#galeriaDeckow .wynik-zestaw-obrazki:not(.cx-blade-row):not(.cx-drive-row) {
    margin-bottom: 15px;
}
.cx-images-container,
#galeriaDeckow .wynik-zestaw-obrazki {
    margin-bottom: 15px;
}
.saved-deck-card .item-actions {
    display: flex;
    justify-content: center; /* Centruje przyciski */
    flex-wrap: wrap;         /* Pozwala zawijaÄ‡ siÄ™ do nowej linii */
    gap: 10px;               /* DODAJEMY ODSTÄ˜P 10px miÄ™dzy przyciskami */
}
.deck-builder-container + .card .action-buttons-wrapper {
    display: flex;
    flex-wrap: wrap;         /* Pozwala zawijaÄ‡ przyciski */
    justify-content: center; /* Centruje przyciski w poziomie */
    gap: 10px;               /* DODAJEMY ODSTÄ˜P MIÄ˜DZY PRZYCISKAMI */
    margin-top: 10px;
}

/*
  Naprawia wysokoÅ›Ä‡ slotÃ³w, jeÅ›li jakimÅ› cudem
  nadal byÅ‚aby nieprawidÅ‚owa. Ta reguÅ‚a gwarantuje, Å¼e
  zawsze bÄ™dÄ… miaÅ‚y minimalnÄ… wysokoÅ›Ä‡ 70px.
*/
.deck-part-slot {
    min-height: 70px;
}
/* ======================================================= */
/* === OSTATECZNA, KOMPLETNA SEKCJA DLA GALERII DECKÃ“W === */
/* ======================================================= */

/* --- GÅ‚Ã³wny kontener siatki --- */
#savedDecksContainer {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 15px;
    align-items: start; /* KLUCZOWE: Karty majÄ… wÅ‚asnÄ… wysokoÅ›Ä‡ */
}

/* --- Przyciski na dole karty decku --- */
.saved-deck-card .item-actions {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}

/* --- Pojedyncza karta zestawu (wewnÄ…trz karty decku) --- */
.deck-card-set-preview {
    position: relative;
    border-radius: 10px;
    background-color: rgba(0, 0, 0, 0.25);
    padding: 15px;
    margin-bottom: 15px;
    overflow: hidden; /* WaÅ¼ne dla z-index */
}
.deck-card-set-preview:last-child { margin-bottom: 0; }

/* --- Poprawne, pÃ³Å‚przezroczyste tÅ‚o --- */
.deck-card-set-preview::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 180px;
    height: 180px;
    background-image: var(--bg-symbol-url);
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    opacity: 0.15;
    z-index: -1; /* Umieszcza tÅ‚o POD treÅ›ciÄ… */
}

/* --- NagÅ‚Ã³wek (Zestaw X + ikony) --- */
.set-header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.set-icons-container { display: flex; gap: 8px; }
.set-icons-container .set-icon { height: 28px; width: 28px; object-fit: contain; }

/* --- Segment obrazkÃ³w i nazw --- */
.wynik-zestaw-obrazki, .cx-images-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
    align-items: flex-start;
}
.cx-images-container { flex-direction: column; align-items: center; }
.cx-blade-row, .cx-drive-row { display: flex; justify-content: center; gap: 10px; }
.part-with-name { display: flex; flex-direction: column; align-items: center; text-align: center; max-width: 80px; }
.wynik-zestaw-obrazki img.deck-part-img { height: 60px; max-width: 60px; object-fit: contain; }
.part-name-label { font-size: 0.75em; color: #ccc; margin-top: 5px; line-height: 1.2; word-break: break-word; }

/* --- Dolny segment (Statystyki + Wykres) --- */
.set-preview-with-chart {
    display: flex;
    flex-direction: row; /* Zapewnia ukÅ‚ad poziomy */
    align-items: center;   /* WyrÃ³wnuje w pionie statystyki i wykres */
    gap: 25px;
    width: 100%;
    margin-left: 0; /* Resetuje stary, bÅ‚Ä™dny margines */
}

.stat-grid { display: block; font-size: 0.85em; line-height: 1.6; text-align: center; }
.stat-grid span { display: block; }
.set-chart-container { flex-shrink: 0; width: 140px; height: 140px; position: relative; }
.set-chart-container canvas { width: 100% !important; height: 100% !important; }

/* --- Media Query dla telefonÃ³w --- */
@media (max-width: 500px) {
    /* ZmieÅ„ kierunek na pionowy: Staty na gÃ³rze, Wykres na dole */
    .set-chart-container {
        width: 180px;
        height: 180px;
        margin-top: 15px;
    }
    .stat-grid {
        text-align: center; /* Na mobilce wycentruj listÄ™ statystyk */
    }
}

/* --- GÅ‚Ã³wna siatka dla kart --- */
#achievementsContainer {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    max-width: 1400px;
    margin: 0 auto;
    gap: 20px;
}

/* --- GÅ‚Ã³wny kontener karty osiÄ…gniÄ™cia --- */
.achievement-card {
    background: rgba(30, 30, 40, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    gap: 15px; 
}

/* --- TytuÅ‚ na samej gÃ³rze karty --- */
.achievement-title {
    font-size: 1.2em;
    font-weight: bold;
    color: #e0e0e0;
    text-align: center;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    width: 100%;
}

/* --- Kontener na treÅ›Ä‡ (ikona + blok info) --- */
.achievement-card-content {
    display: flex;
    align-items: flex-start; /* WyrÃ³wnuje ikonÄ™ i blok info do gÃ³ry */
    gap: 20px;
    width: 100%;
}

/* --- Ikona osiÄ…gniÄ™cia po lewej (wiÄ™ksza) --- */
.achievement-icon {
    width: 120px; /* ZwiÄ™kszamy rozmiar ikony */
    height: 120px;
    flex-shrink: 0;
    object-fit: contain;
    border-radius: 8px;
    transition: filter 0.3s ease;
}

/* --- Blok po prawej (opis + pasek) --- */
.achievement-info {
    display: flex;
    flex-direction: column; /* UkÅ‚ada opis i pasek w pionie */
    gap: 12px; /* OdstÄ™p miÄ™dzy opisem a paskiem */
    flex-grow: 1; /* Blok zajmuje caÅ‚Ä… dostÄ™pnÄ… przestrzeÅ„ */
}

.achievement-description {
    font-size: 0.9em;
    color: #aaa;
    line-height: 1.5;
    margin: 0;
    min-height: 54px; /* Zapewnia staÅ‚Ä… wysokoÅ›Ä‡ na 3 linie tekstu */
}

/* --- Pasek postÄ™pu (teraz wewnÄ…trz .achievement-info) --- */
.achievement-progress-bar {
    width: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    height: 22px;
    position: relative;
    overflow: hidden;
}

.progress-fill {
    background: linear-gradient(90deg, #8a2be2, #a25ff0);
    height: 100%;
    border-radius: 7px;
    transition: width 0.5s ease;
    box-shadow: 0 0 10px rgba(162, 95, 240, 0.5);
}

.progress-text {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.8em;
    font-weight: bold;
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
}

/* --- Style stanu: ZABLOKOWANE --- */
.achievement-card.locked .achievement-icon {
    filter: grayscale(100%) brightness(0.5);
}
.achievement-card.locked .achievement-title {
    color: #777;
}

/* --- Style stanu: ODBLOKOWANE --- */
.achievement-card.unlocked {
    background: linear-gradient(145deg, rgba(138, 43, 226, 0.1), rgba(40, 40, 50, 0.2));
    border-color: rgba(138, 43, 226, 0.25);
}
.achievement-card.unlocked .achievement-title {
    color: #a25ff0;
}
.achievement-card.unlocked .achievement-icon {
    filter: none;
    border: 2px solid rgba(170, 95, 240, 0.4);
}
    .poradnik-zakladka.card {
        text-align: left; /* WyrÃ³wnaj tekst w kartach poradnika do lewej */
    }
    .poradnik-zakladka h3 {
        text-align: center; /* Ale nagÅ‚Ã³wki wycentruj */
        color: #a25ff0;
        margin-bottom: 20px;
    }
    .poradnik-zakladka p, .poradnik-zakladka li {
        line-height: 1.7;
        font-size: 0.95em;
        color: #ddd;
    }
    .poradnik-zakladka ul {
        margin-left: 20px;
        margin-bottom: 15px;
}

.kategorie-bitow-lista {
    margin-top: 20px;
    display: flex;
    flex-direction: column; /* UkÅ‚ada elementy jeden pod drugim */
    gap: 15px; /* OdstÄ™p miÄ™dzy elementami listy */
}

.kategoria-item {
    display: flex; /* UkÅ‚ada obrazek i tekst w jednej linii */
    align-items: center; /* WyrÃ³wnuje obrazek i tekst w pionie */
    background-color: rgba(0, 0, 0, 0.2);
    padding: 10px;
    border-radius: 8px;
    border-left: 3px solid #a25ff0; /* Dodaje akcent kolorystyczny */
}

.kategoria-item img {
    width: 40px; /* **NAJWAÅ»NIEJSZE: Ustawia staÅ‚y, maÅ‚y rozmiar obrazka** */
    height: 40px;
    margin-right: 15px; /* OdstÄ™p miÄ™dzy obrazkiem a tekstem */
    flex-shrink: 0; /* Zapobiega kurczeniu siÄ™ obrazka */
}

.kategoria-item span {
    font-size: 0.9em;
    line-height: 1.5;
}


/* GÅ‚Ã³wny kontener dla ukÅ‚adu 3-kolumnowego */
.trzy-kolumny-kontener {
    display: flex;
    justify-content: center;
    gap: 20px; /* OdstÄ™p miÄ™dzy kolumnami */
    margin: 25px 0;
    flex-wrap: wrap; /* Pozwala kolumnom spadaÄ‡ niÅ¼ej na maÅ‚ych ekranach */
}

/* Styl pojedynczej kolumny */
.kolumna {
    flex: 1; /* KaÅ¼da kolumna zajmuje tyle samo miejsca */
    min-width: 280px; /* Minimalna szerokoÅ›Ä‡, by tekst byÅ‚ czytelny */
    max-width: 350px;
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    overflow: hidden; /* Ukrywa wystajÄ…ce elementy (np. rogi obrazka) */
    display: flex;
    flex-direction: column;
}

/* NagÅ‚Ã³wek kolumny (obrazek + tytuÅ‚) */
.kolumna-naglowek {
    padding: 15px;
    text-align: center;
}

.kolumna-naglowek img {
    max-width: 120px; /* Rozmiar przykÅ‚adowego obrazka */
    margin-bottom: 10px;
 
    background-color: rgba(0,0,0,0.3);
}

.kolumna-naglowek h5 {
    margin: 0;
    font-size: 1.2em;
    color: #fff;
}

/* Kolory tÅ‚a dla nagÅ‚Ã³wkÃ³w */
.bx-kolor { background: linear-gradient(145deg, #274a8a, #1c3563); }
.ux-kolor { background: linear-gradient(145deg, #8a2727, #631c1c); }
.cx-kolor { background: linear-gradient(145deg, #6a278a, #4a1c63); }
/* TreÅ›Ä‡ kolumny (opisy) */
.kolumna-tresc {
    padding: 15px;
    font-size: 0.9em;
    line-height: 1.6;
    flex-grow: 1; /* Sprawia, Å¼e treÅ›Ä‡ rozpycha kolumnÄ™ na caÅ‚Ä… wysokoÅ›Ä‡ */
}

.kolumna-tresc p {
    margin-bottom: 15px;
}

.kolumna-tresc p:last-child {
    margin-bottom: 0;
}


/* Styl dla kolumny w ukÅ‚adzie porÃ³wnawczym */
.kolumna-porownawcza {
    flex: 1; /* KaÅ¼da kolumna zajmuje tyle samo miejsca */
    min-width: 280px;
    padding: 20px;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    border-top: 4px solid #a25ff0; /* Akcent kolorystyczny na gÃ³rze */
}

/* Styl dla nagÅ‚Ã³wka w kolumnie porÃ³wnawczej */
.kolumna-porownawcza h5 {
    display: flex; /* UkÅ‚ada ikonkÄ™ i tekst w jednej linii */
    align-items: center;
    font-size: 1.2em;
    margin-top: 0;
    margin-bottom: 20px;
    color: #fff;
}

/* Styl dla maÅ‚ej ikonki w nagÅ‚Ã³wku */
.kolumna-porownawcza h5 img {
    width: 30px;
    height: 30px;
    margin-right: 10px;
}

.kolumna-porownawcza p {
    font-size: 0.9em;
    line-height: 1.6;
    color: #ddd;
    margin-bottom: 15px;
}
.kolumna-porownawcza p strong {
    color: #a25ff0;
}

.kolumna-porownawcza p:last-child {
    margin-bottom: 0;
}


/* Kontener dla pojedynczego obrazka z podpisem */
.poradnik-obrazek-z-podpisem {
    text-align: center;      /* Centruje podpis pod obrazkiem */
    max-width: 45%;          /* DomyÅ›lna maksymalna szerokoÅ›Ä‡ */
    min-width: 200px;
}

/* Obrazek wewnÄ…trz kontenera */
.poradnik-obrazek-z-podpisem img {
    width: 100%;             /* Obrazek dopasowuje siÄ™ do szerokoÅ›ci kontenera */
    border-radius: 8px;      /* ZaokrÄ…glone rogi */
    background-color: rgba(0,0,0,0.2);
}

/* Podpis pod obrazkiem */
.podpis-obrazka {
    font-size: 0.85em;       /* Mniejsza czcionka dla podpisu */
    color: #bbb;
    margin-top: 10px;        /* OdstÄ™p od obrazka */
    line-height: 1.4;
}

/* GÅ‚Ã³wny kontener na karty z launcherami */
.launcher-cards-container {
    display: flex;
    flex-direction: column; /* UkÅ‚ada karty jedna pod drugÄ… */
    gap: 25px; /* OdstÄ™p miÄ™dzy kartami */
    margin-top: 25px;
}

/* Pojedyncza karta launchera */
.launcher-card {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex; /* UkÅ‚ada nagÅ‚Ã³wek i treÅ›Ä‡ obok siebie */
    overflow: hidden;
    transition: all 0.2s ease-in-out;
}

.launcher-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
}

/* Lewa czÄ™Å›Ä‡ karty (obrazek + nazwa) */
.launcher-header {
    flex: 0 0 200px; /* StaÅ‚a szerokoÅ›Ä‡ 200px */
    padding: 20px;
    text-align: center;
    background-color: rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.launcher-header img {
    max-width: 120px;
    margin-bottom: 15px;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
}

.launcher-header h5 {
    margin: 0;
    font-size: 1em;
    color: #d1b3ff;
}

/* Prawa czÄ™Å›Ä‡ karty (opisy) */
.launcher-body {
    padding: 20px;
    flex-grow: 1;
}

.launcher-body p {
    font-size: 0.9em;
    margin-top: 0;
    margin-bottom: 15px;
}

.launcher-body ul {
    font-size: 0.85em;
    line-height: 1.7;
    padding-left: 20px;
    margin: 0;
}

.launcher-body li {
    margin-bottom: 8px;
}

.launcher-body li strong {
    color: #a25ff0;
}

/* ResponsywnoÅ›Ä‡ dla mniejszych ekranÃ³w */
@media (max-width: 768px) {
    .launcher-card {
        flex-direction: column; /* Na telefonach ukÅ‚adamy w pionie */
    }
    .launcher-header {
        flex-basis: auto; /* SzerokoÅ›Ä‡ dopasuje siÄ™ automatycznie */
    }
}

/* Kontener na przyciski L/R */
.spin-switcher {
    display: flex;
    gap: 8px;
    margin-top: 15px; /* OdstÄ™p od nagÅ‚Ã³wka */
    background-color: rgba(0,0,0,0.3);
    padding: 5px;
    border-radius: 8px;
}

.spin-switcher button {
    background-color: transparent;
    border: 2px solid transparent;
    color: #aaa;
    font-family: 'Kode Mono', monospace;
    font-weight: bold;
    font-size: 0.9em;
    padding: 5px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}

.spin-switcher button:hover {
    background-color: rgba(255,255,255,0.1);
    color: #fff;
}

/* Styl dla aktywnego przycisku (L lub R) */
.spin-switcher button.active {
    background-color: #a25ff0;
    color: #fff;
    border-color: rgba(255,255,255,0.5);
    box-shadow: 0 0 10px rgba(162, 95, 240, 0.5);
}


/* Nowy styl dla kart akcesoriÃ³w */
.akcesorium-card {
    flex: 1; /* KaÅ¼da kolumna zajmuje tyle samo miejsca */
    min-width: 280px;
    padding: 25px;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    border-top: 4px solid #a25ff0;
    text-align: center; /* Wycentruj caÅ‚Ä… zawartoÅ›Ä‡ */
    display: flex;
    flex-direction: column; /* UkÅ‚adaj elementy (obraz, tytuÅ‚, tekst) w pionie */
    align-items: center;  /* Wycentruj w poziomie */
}

/* DuÅ¼y, czytelny obrazek na gÃ³rze karty */
.akcesorium-card img {
    width: 150px;  /* **KLUCZOWA ZMIANA: DuÅ¼y rozmiar obrazka** */
    height: 150px;
    object-fit: contain; /* Zachowaj proporcje obrazka */
    margin-bottom: 20px; /* OdstÄ™p od tytuÅ‚u */
}

/* TytuÅ‚ pod obrazkiem */
.akcesorium-card h5 {
    font-size: 1.2em;
    margin-top: 0;
    margin-bottom: 15px;
    color: #fff;
}

/* Akapity z tekstem */
.akcesorium-card p {
    font-size: 0.9em;
    line-height: 1.6;
    color: #ddd;
    margin-bottom: 15px;
    text-align: left; /* WyrÃ³wnaj tekst w akapitach do lewej dla lepszej czytelnoÅ›ci */
}

.akcesorium-card p:last-child {
    margin-bottom: 0;
}




/* Kontener na karty z punktacjÄ… */
.punktacja-container {
    display: grid;
    /* Tworzy 2 kolumny na desktopie, 1 na mobilce */
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 25px;
}

/* Pojedyncza karta punktacji */
.punktacja-card {
    background-color: rgba(45, 45, 55, 0.7);
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Kolorowy nagÅ‚Ã³wek karty punktacji */
.punktacja-header {
    padding: 15px;
    text-align: center;
    position: relative;
}

.punktacja-header img {
    max-width: 90px;
    margin-bottom: 10px;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5));
}

.punktacja-header h4 {
    margin: 0;
    font-size: 1.2em;
    color: #fff;
}

/* Etykieta z punktami w rogu */
.punktacja-header span {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: rgba(0,0,0,0.4);
    color: #fff;
    font-weight: bold;
    font-size: 0.8em;
    padding: 5px 8px;
    border-radius: 6px;
}

/* Opis pod nagÅ‚Ã³wkiem */
.punktacja-body {
    padding: 15px;
    background-color: rgba(30, 30, 40, 0.7);
    flex-grow: 1; /* Rozpycha tÅ‚o na caÅ‚Ä… dostÄ™pnÄ… wysokoÅ›Ä‡ */
}

.punktacja-body p {
    margin: 0;
    font-size: 0.9em;
    line-height: 1.6;
    color: #ccc;
}


    /* Kontener tworzÄ…cy siatkÄ™ 2x2 */
    .punktacja-grid-2x2 {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Zawsze dwie kolumny */
        gap: 20px;
        margin-top: 25px;
    }

    /* Pojedyncza karta w siatce */
    .finish-card {
        background-color: rgba(30, 30, 40, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

  
.finish-card img {
    width: 100%;
    /* **KLUCZOWA ZMIANA:** Ograniczamy maksymalnÄ… wysokoÅ›Ä‡ obrazka */
    max-height: 180px; 
    /* Zmieniamy object-fit, aby obrazek byÅ‚ w peÅ‚ni widoczny */
    object-fit: contain; 
    display: block;
    /* Dodajemy tÅ‚o, aby przezroczyste PNG wyglÄ…daÅ‚y dobrze */
    background-color: rgba(0, 0, 0, 0.2); 
}


    /* Kontener na opis pod obrazkiem */
    .finish-card-body {
        padding: 15px;
        flex-grow: 1; /* Rozpycha tÅ‚o na caÅ‚Ä… dostÄ™pnÄ… wysokoÅ›Ä‡ */
    }

    .finish-card-body p {
        margin: 0;
        font-size: 0.9em;
        line-height: 1.6;
        color: #ccc;
    }
    
    /* ResponsywnoÅ›Ä‡ dla maÅ‚ych ekranÃ³w */
    @media (max-width: 600px) {
        .punktacja-grid-2x2 {
            grid-template-columns: 1fr; /* Na telefonach jedna kolumna */
        }
    }


/* GÅ‚Ã³wny kontener dla kaÅ¼dego ukÅ‚adu kolumnowego */
.kolumny-kontener {
    display: flex;
    align-items: flex-start; /* DomyÅ›lnie wyrÃ³wnuje elementy do gÃ³ry */
    gap: 25px;
    margin: 25px 0;
    flex-wrap: wrap; /* Pozwala kolumnom spadaÄ‡ niÅ¼ej na maÅ‚ych ekranach */
}

/* Uniwersalna klasa dla kolumny z obrazkiem (lewa strona) */
.kolumna-obrazek {
    flex: 1; /* DomyÅ›lnie zajmuje poÅ‚owÄ™ miejsca */
    min-width: 250px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.kolumna-obrazek img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    background-color: rgba(0,0,0,0.2);
}

/* Uniwersalna klasa dla kolumny z tekstem (prawa strona) */
.kolumna-tekst {
    flex: 1; /* DomyÅ›lnie zajmuje poÅ‚owÄ™ miejsca */
    min-width: 250px;
}

/* Podpis pod obrazkiem w kolumnie */
.podpis-obrazka {
    font-size: 0.85em;
    color: #bbb;
    margin-top: 10px;
    line-height: 1.4;
    text-align: center;
}
.kontoBox {
    background: rgba(20,20,20,0.6);
    border: 1px solid rgba(255,255,255,0.15);
    padding: 20px;
    border-radius: 15px;
    max-width: 420px;
    margin: 20px auto;
    animation: fadeIn 0.3s ease-out;
}

.kontoInput {
    width: 100%;
    padding: 10px;
    margin: 6px 0 12px 0;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 10px;
}

.kontoSubBox {
    background: rgba(40,40,40,0.4);
    padding: 12px;
    border-radius: 10px;
    margin-top: 15px;
}

</style>
<script type="module">
    // ---- Import Firebase Core ----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";

    // ---- Firebase Authentication ----
    import { 
        getAuth, 
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    // ---- Firebase Firestore ----
    import { 
        getFirestore,
        doc,
        setDoc,
        getDoc,
        updateDoc
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";


    // ================================
    //   TWOJA FAKTYCZNA KONFIGURACJA
    // ================================
    const firebaseConfig = {
        apiKey: "AIzaSyDZWXPCYnxme7JGtlSp1xk9KKfgErsNoOo",
        authDomain: "ananansbey.firebaseapp.com",
        projectId: "ananansbey",
        storageBucket: "ananansbey.firebasestorage.app",
        messagingSenderId: "442693586304",
        appId: "1:442693586304:web:3f6bd531aaf0719ffb4565",
        measurementId: "G-DSJX5R0RVX"
    };

    // ================================
    //       Inicjalizacja Firebase
    // ================================
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // UdostÄ™pniamy globalnie â€” aby caÅ‚y TwÃ³j kod JS mÃ³gÅ‚ korzystaÄ‡
    window.firebaseAuth = auth;
    window.firebaseDB = db;
    window.firebaseCreateUser = createUserWithEmailAndPassword;
    window.firebaseSignIn = signInWithEmailAndPassword;
    window.firebaseSignOut = signOut;
    window.firebaseOnAuth = onAuthStateChanged;
    window.firebaseSet = setDoc;
    window.firebaseGet = getDoc;
    window.firebaseUpdate = updateDoc;

    console.log("%cðŸ”¥ Firebase poprawnie zaÅ‚adowane!", "color: #28ff28; font-size: 14px");
</script>

</head>
<div id="loader-overlay">
    <div class="loader-spinner"></div>
    <p class="loader-text">Wczytywanie zasobÃ³w...</p>
</div>
<!-- ======================================= -->

<div id="vanta-background"></div>
<div id="vanta-background"></div>
<div id="notification-bar"></div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="openbtn-container">
        <div class="openbtn" id="sidebarToggleBtn" title="RozwiÅ„/ZwiÅ„ menu">
            <img src="menu.png" alt="Menu Icon" id="menu-icon">
            <span class="menu-text" id="menu-btn-text">MENU</span>
        </div>
    </div>
    <div class="sidebar-links">
        <a href="#" onclick="navigateTo('info', this)" title="Informacje i Instrukcja"><img src="info.png" alt="Info"><span>Info</span></a>
        <a href="#" onclick="navigateTo('poradnik', this)" title="Poradnik dla PoczÄ…tkujÄ…cych"><img src="0.png" alt="Poradnik"><span>Poradnik</span></a>
        <a href="#" onclick="navigateTo('generator', this)" title="Generator ZestawÃ³w"><img src="1.png" alt="Generator"><span>Generator</span></a>
        <a href="#" onclick="navigateTo('magazyn', this)" title="MÃ³j Magazyn CzÄ™Å›ci"><img src="2.png" alt="Magazyn"><span>Magazyn</span></a>
        <a href="#" onclick="navigateTo('licznikPunktow', this)" title="Licznik PunktÃ³w"><img src="3.png" alt="Licznik"><span>Licznik</span></a>
        <a href="#" onclick="navigateTo('deck', this)" title="Deck Generator"><img src="4.png" alt="Deck" class="menu-icon"><span>Deck Generator</span></a>
        <a href="#" onclick="navigateTo('galeriaDeckow', this)" title="Moje Zapisane Decki"><img src="5.png" alt="Galeria"><span>Moje Decki</span></a>
        <a href="#" onclick="navigateTo('importexport', this)" title="Ustawienia"><img src="6.png" alt="Import/Eksport"><span>Dane</span></a>
        <a href="#" onclick="navigateTo('osiagniecia', this)" title="OsiÄ…gniÄ™cia"><img src="osiagniecie.png" alt="OsiÄ…gniÄ™cia"><span>OsiÄ…gniÄ™cia</span></a>
    <!-- ============================================= -->
    <!-- === SEKCJA KONTO W SIDEBARZE (NOWA) === -->
    <!-- ============================================= -->
    <div class="sidebar-account-section">
        <a href="#" onclick="toggleAccountSubmenu(this)" title="Konto">
            <img src="img/user.png" alt="Konto"><span>Konto</span>
        </a>
        <div class="sidebar-submenu" id="account-submenu">
            <!-- --- WIDOK GDY UÅ»YTKOWNIK JEST WYLOGOWANY (DOMYÅšLNY) --- -->
            <div id="logged-out-view">
                <button class="submenu-button" onclick="showAuthPopup('login')">Zaloguj siÄ™</button>
                <button class="submenu-button" onclick="showAuthPopup('register')">UtwÃ³rz konto</button>
            </div>
            <!-- --- WIDOK GDY UÅ»YTKOWNIK JEST ZALOGOWANY (UKRYTY) --- -->
            <div id="logged-in-view" style="display: none;">
                <p id="user-email-display">Zalogowano jako:</p>
                <button class="submenu-button" onclick="syncData()">Synchronizuj dane</button>
                <p id="last-sync-display">Ostatnia synch.: Nigdy</p>
                <button class="submenu-button danger" onclick="logoutUser()">Wyloguj</button>
            </div>
        </div>
    </div>
    		
   </div>
</div>

<!-- NOWY ELEMENT DLA PEÅNOEKRANOWEGO OBRAZKA FINISHU -->
<div id="fullscreenFinishOverlay" class="fullscreen-finish-overlay">
    <img id="fullscreenFinishImage" src="#" alt="Finish Effect">
</div>

<div id="app-container">
    <section id="info" class="page">
        <h2>Witaj w Beyblade App by Ananasek</h2>
        <div id="generator-obraz" style="margin-top:20px; margin-bottom: 20px;">
            <img src="tlo.png" alt="Animowane tÅ‚o generatora">
        </div>
        <div class="card">
            <h3>KrÃ³tka Instrukcja ObsÅ‚ugi</h3>
            <p style="text-align: left; line-height: 1.8;">
                Witaj w aplikacji wspomagajÄ…cej Twoje rozgrywki i zarzÄ…dzanie kolekcjÄ… Beyblade! Oto kilka wskazÃ³wek, jak zaczÄ…Ä‡:
            </p>
            <ul style="text-align: left; margin-left: 20px; line-height: 1.8;">
                <li><strong>Poradnik:</strong><img src="0.png" alt="tutorial Icon" class="inline-icon">Poradnik dla nowych BladerÃ³w</li>
                <li><strong>Generator ZestawÃ³w:</strong><img src="1.png" alt="Generator Icon" class="inline-icon">Wybierz seriÄ™ i iloÅ›Ä‡, a aplikacja wylosuje dla Ciebie czÄ™Å›ci z Twojego magazynu.</li>
                <li><strong>MÃ³j Magazyn:</strong><img src="2.png" alt="Magazyn Icon" class="inline-icon"> Tutaj zarzÄ…dzasz swojÄ… kolekcjÄ… czÄ™Å›ci</li>
                <li><strong>Licznik PunktÃ³w:</strong><img src="3.png" alt="Licznik Icon" class="inline-icon"> Prosty licznik do Å›ledzenia wynikÃ³w podczas rozgrywki</li>
                <li><strong>Deck Generator:</strong><img src="4.png" alt="Deck Icon" class="inline-icon"> SkÅ‚adaj wÅ‚asne decki w oparciu o zasady turniejowe</li>
                <li><strong>Moje Decki:</strong><img src="5.png" alt="Galeria Icon" class="inline-icon"> PrzeglÄ…daj, edytuj lub usuwaj decki</li>
                <li><strong>Dane:</strong><img src="6.png" alt="Dane Icon" class="inline-icon"> W tej sekcji moÅ¼esz importowaÄ‡/eksportowaÄ‡ swoje czÄ™Å›ci jak i decki</li>
                <li><strong>OsiÄ…gniÄ™cia:</strong><img src="img/osiagniecie.png" alt="OsiÄ…gniÄ™cia Icon" class="inline-icon"> W tej sekcji moÅ¼esz zobaczyÄ‡ swoje osiÄ…gniÄ™cia</li>

            </ul>
            <p style="text-align: left; margin-top: 15px;">
                PamiÄ™taj, aby regularnie zapisywaÄ‡ swoje dane (magazyn i decki) za pomocÄ… opcji eksportu, aby uniknÄ…Ä‡ ich utraty!
            </p>
            <p style="text-align: center; margin-top: 20px; font-weight: bold;">
                MiÅ‚ej zabawy i udanych pojedynkÃ³w!
            </p>
        </div>
        <div class="info-panels-container">

            <div class="card info-panel">
                <h4>Co w planach:</h4>
                <ul class="info-list">
                    <li><strong>Aktualnie:</strong> Rozbudowa bazy czÄ™Å›ci, aktualizacja brakujÄ…cych statystyk.</li>
                    <li><strong>W planach:</strong> Optymalizacja obecnych oraz dodawanie nowych funkcji.</li>
                    <li style="margin-top: 10px;"><em>Masz sugestie? Daj znaÄ‡!</em></li>
                </ul>
            </div>

            <div class="card info-panel">
                <h4>Patch Notes:</h4>
                <ul class="info-list">
                    <li><strong>v2.4.2:</strong> UzupeÅ‚niono brakujace statystyki z zestawÃ³w Cx 10 i CX 11</li>
                    <li><strong>v2.4.1:</strong> Poprawki graficzne i logiczne deck buildera oraz dodanie trybÃ³w w <em>Turn</em></li>
                    <li><strong>v2.4.0:</strong> Dodano Poradnik dla nowcyh BladerÃ³w</li>
                    <li><strong>v2.3.2:</strong> MoÅ¼liwoÅ›Ä‡ dodawania Hurtowo czÄ™Å›ci do magazynu</li>
                    <li><strong>v2.3.1:</strong> Aktuazlizacja walidacji decku dotyczÄ…ca metalowych LockChipÃ³w</li>
                    <li><strong>v2.3.0:</strong> Dodano osiÄ…gniÄ™cia</li>
                    <li><strong>v2.2.6:</strong> Dodano Nowe elemeny: <em>Operate, Heavy, Might, Emperor, Wolf, Hunt, Free, 0-60, 9-65,</em> statystyki uzupeÅ‚nione czÄ™Å›ciowo</li>
                    <li><strong>v2.2.5:</strong> Dodano tryby w bicie <em>Turbo</em></li>
                    <li><strong>v2.2.4:</strong> Dodano wykresy statystyk</li>
                    <li><strong>v2.2.3:</strong> Dodano wyszukiwanie po nazwie w magazynie</li>
                    <li><strong>v2.2.2:</strong> Zmiany wizualne galerii DeckÃ³w</li>
                    <li><strong>v2.2.1:</strong> MoÅ¼liwoÅ›Ä‡ zapisu decku jako png</li>
                    <li><strong>v2.2.0:</strong> Dodanie systemu trybÃ³w na elementach np.<em>Eclipse</em> i <em>Dual</em> </li>
                    <li><strong>v2.1.4:</strong> Rozdzielenie <em>Eclipse</em> na upper i smash mode </li>
                    <li><strong>v2.1.3:</strong> Dodano czÄ™Å›Ä‡ brakujÄ…cych statystyk</li>
                    <li><strong>v2.1.2:</strong> Dodano Patch Note</li>
                    <li><strong>v2.1.1:</strong> Dodano <em>ClockMirage</em> wraz z zasadami dopasowania do niego</li>
                    <li><strong>v2.1.0:</strong> Nowa Strona gÅ‚Ã³wna Info</li>
                    <li><strong>v2.0.3:</strong> Poprawki Graficnze licznika punktÃ³w</li>
                    <li><strong>v2.0.2:</strong> Dodane Automatyczny update Bazy DyskÃ³w</li>
                    <li><strong>v2.0.1:</strong> Bugfixy, zwiÄ™kszony cap losowaÅ„</li>
                    <li><strong>v2.0.0:</strong> Deck Builder 2.0 Zmiany graficzne</li>
                    <li><strong>v1.2.0:</strong> Dodano licznik punkÃ³w</li>
                    <li><strong>v1.1.2:</strong> Poprawa deck buildera</li>
                    <li><strong>v1.1.1:</strong> Poprawa zasad dla <em>Turbo</em></li>
                    <li><strong>v1.1.0:</strong> Dodano import export dla deckÃ³w i magazynu</li>
                    <li><strong>v1.0.1:</strong> Dodano deck builder oraz status beta czÄ™Å›ci w magazynie oraz obsÅ‚uge cx</li>
                    <li><strong>v1.0.0:</strong> Dodano generator zestawÃ³w losowych wraz z rÄ™cznym dodawaniem czÄ™Å›ci</li>
                </ul>
            </div>

        </div>
    </section>

    <section id="licznikPunktow" class="page">
        <h2>Licznik PunktÃ³w Rozgrywki</h2>
        <div class="card score-counter-card">
            <div class="player-section" data-player-id="player1">
                <h3 id="playerName1">Gracz 1</h3>
                <!-- Obrazek finishu jest teraz globalny, usuwamy stÄ…d lokalne kontenery -->
                <div class="score-display" id="scorePlayer1">0</div>
                <div class="score-buttons">
                    <button onclick="updateScore('player1', 1, 'spin_finish')">Spin </button>
                    <button onclick="updateScore('player1', 2, 'over_finish')">Over </button>
                    <button onclick="updateScore('player1', 2, 'burst_finish')">Burst </button>
                    <button onclick="updateScore('player1', 3, 'xtreme_finish')">Xtreme </button>
                    <button class="danger-btn" onclick="updateScore('player1', -1)" style="margin-left: 10px;">-1</button>
                </div>
                <input type="text" id="inputPlayerName1" placeholder="Wpisz imiÄ™ Gracza 1" onchange="updatePlayerName('player1')">
            </div>

            <div class="player-section" data-player-id="player2">
                <h3 id="playerName2">Gracz 2</h3>
                <!-- Obrazek finishu jest teraz globalny, usuwamy stÄ…d lokalne kontenery -->
                <div class="score-display" id="scorePlayer2">0</div>
                <div class="score-buttons">
                    <button onclick="updateScore('player2', 1, 'spin_finish')">Spin </button>
                    <button onclick="updateScore('player2', 2, 'over_finish')">Over </button>
                    <button onclick="updateScore('player2', 2, 'burst_finish')">Burst </button>
                    <button onclick="updateScore('player2', 3, 'xtreme_finish')">Xtreme </button>
                    <button class="danger-btn" onclick="updateScore('player2', -1)" style="margin-left: 10px;">-1</button>
                </div>
                <input type="text" id="inputPlayerName2" placeholder="Wpisz imiÄ™ Gracza 2" onchange="updatePlayerName('player2')">
            </div>
            <div class="game-controls">
                <button onclick="resetScoresAndImages()">Resetuj Wyniki</button>
            </div>
        </div>
    </section>

    <section id="generator" class="page">
        <h2>Generator ZestawÃ³w</h2>
        <div class="card">
            <label for="seriaLosowania">Wybierz SeriÄ™ do Losowania:</label>
            <select id="seriaLosowania" aria-label="Seria BeybladÃ³w do losowania">
                <option value="all">Wszystkie Serie (All)</option> <!-- DODAJ TÄ˜ LINIÄ˜ -->
                <option value="bx_ux">BX / UX (Blade, Ratchet, Bit)</option>
                <option value="cx">CX (LockChip, Main, Assist, Ratchet, Bit)</option>
            </select>

            <label for="ilosc" style="margin-top:15px;">Wybierz iloÅ›Ä‡ BeybladÃ³w do wylosowania:</label>
            <select id="ilosc" aria-label="IloÅ›Ä‡ BeybladÃ³w do wylosowania">
                <option value="1">1</option><option value="2">2</option><option value="3">3</option>
                <option value="4">4</option><option value="5">5</option><option value="6">6</option>
                <option value="7">7</option><option value="8">8</option><option value="9">9</option>
                <option value="10">10</option><option value="11">11</option><option value="12">12</option>
                <option value="13">13</option><option value="14">14</option><option value="15">15</option>
                <option value="16">16</option><option value="17">17</option><option value="18">18</option>
                <option value="19">19</option><option value="20">20</option><option value="21">21</option>
                <option value="22">22</option><option value="23">23</option><option value="24">24</option>
            </select>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button onclick="LOSUJ()">Losuj Zestawy</button>
                <button onclick="wyczyscLosowanie()" class="cancel-btn">WyczyÅ›Ä‡ Wyniki</button>
            </div>
        </div>
        <div id="wyniki" style="margin-top:20px;"></div>
        <!-- Dodany kontener dla przyciskÃ³w zapisu wylosowanego zestawu -->

    </section>

    <section id="magazyn" class="page">
        <h2>MÃ³j Magazyn CzÄ™Å›ci</h2>
        <!-- === CAÅY POPRAWIONY KONTENER FILTRÃ“W === -->
        <!-- === OSTATECZNY, POPRAWIONY KONTENER FILTRÃ“W === -->
        <div class="card" id="magazyn-filtry-container">

            <!-- Filtr Kategorii -->
            <div class="filtr-item">
                <label for="filterKategoria">Filtruj wedÅ‚ug kategorii:</label>
                <select id="filterKategoria" onchange="wyswietlMagazyn()" aria-label="Filtr kategorii czÄ™Å›ci">
                    <option value="all">Wszystkie Kategorie</option>
                    <optgroup label="Seria BX">
                        <option value="blade">Blade (BX)</option>
                    </optgroup>
                    <optgroup label="Seria UX">
                        <option value="ux-blade">Blade (UX)</option>
                    </optgroup>
                    <optgroup label="Seria CX">
                        <option value="cx-lock-chip">CX Lock Chip</option>
                        <option value="cx-main-blade">CX Main Blade</option>
                        <option value="cx-assist-blade">CX Assist Blade</option>
                    </optgroup>
                    <optgroup label="Komponenty WspÃ³lne">
                        <option value="rachet">Ratchet</option>
                        <option value="bit">Bit</option>
                    </optgroup>
                </select>
            </div>

            <!-- Pole Wyszukiwania -->
            <div class="filtr-item">
                <label for="searchMagazynByName">Wyszukaj po nazwie:</label>
                <div class="search-input-container">
                    <input
                            type="search"
                            id="searchMagazynByName"
                            placeholder="Np. DranSword, 3-60..."
                            oninput="wyswietlMagazyn()"
                            aria-label="Wyszukaj czÄ™Å›Ä‡ po nazwie"
                    >
                </div>
            </div>

            <!-- Filtr Posiadania -->
            <div class="filtr-item">
                <label for="filterPosiadane">PokaÅ¼ czÄ™Å›ci:</label>
                <select id="filterPosiadane" onchange="wyswietlMagazyn()" aria-label="Filtr posiadanych czÄ™Å›ci">
                    <option value="posiadane">Posiadane</option>
                    <option value="nieposiadane">Nieposiadane</option>
                    <option value="wszystkie_w_bazie" selected>Wszystkie</option> <!-- "selected" jest teraz tutaj -->
                </select>

            </div>

        </div>
        <div style="text-align: center; margin-bottom: 20px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
            <button id="toggleBulkEditBtn" onclick="toggleBulkEditMode()">
                WÅ‚Ä…cz Tryb Edycji Hurtowej
            </button>
            <button id="addAllButton" onclick="addAllPartsByOne()">
                Dodaj Wszystko (+1)
            </button>
            <button id="subtractAllButton" class="danger-btn" onclick="subtractAllPartsByOne()">
                Odejmij Wszystko (-1)
            </button>
        </div>

        <!-- === KONIEC POPRAWIONEGO KONTENERA FILTRÃ“W === -->


        <div id="lista-magazyn" style="margin-top:15px;"></div>
    </section>


    <section id="deck" class="page">
        <h2>Deck Generator</h2>
        <p style="text-align: center;">PrzeciÄ…gnij czÄ™Å›ci z panelu do odpowiednich slotÃ³w aktywnego zestawu.</p>
        <div class="card" style="margin-bottom: 20px;">
            <h3>ZarzÄ…dzanie Deckiem</h3>
            <div>
                <label for="deckName" style="display: block; margin-bottom: 5px;">Nazwa Decku:</label>
                <input type="text" id="deckName" placeholder="Np. MÃ³j Deck Turniejowy" style="margin-bottom: 10px;">
            </div>
            <div class="action-buttons-wrapper">
                <button id="saveDeckButton" onclick="saveCurrentDeck()">Zapisz Aktualny Deck</button>
                <button onclick="clearCurrentDeckForBuilder()" class="cancel-btn">WyczyÅ›Ä‡ Builder</button>
            </div>
        </div>
        <div class="deck-builder-container">
            <div class="available-parts-panel" id="available-parts-panel">
                <h4>DostÄ™pne CzÄ™Å›ci</h4>
                <div class="filter-parts-dnd" style="margin-bottom:15px;">
                    <label for="dndPartTypeFilter">Filtruj czÄ™Å›ci:</label>
                    <select id="dndPartTypeFilter" onchange="renderAvailablePartsList()">
                        <option value="blade">BX Blade</option>
                        <option value="ux-blade">UX Blade</option>
                        <option value="cx-lock-chip">CX Lock Chip</option>
                        <option value="cx-main-blade">CX Main Blade</option>
                        <option value="cx-assist-blade">CX Assist Blade</option>
                        <option value="rachet">Ratchet</option>
                        <option value="bit">Bit</option>
                    </select>
                </div>
                <div id="parts-list-for-dnd">
                    <!-- Lista czÄ™Å›ci do przeciÄ…gania -->
                </div>
            </div>
            <div class="deck-set-slots-container">
                <div id="deck-set-tabs-container" class="tabs-container">
                    <!-- Guziki zakÅ‚adek bÄ™dÄ… generowane przez JS -->
                </div>
                <div id="deck-builder-active-set-slots">
                    <!-- SlotÃ³w na aktywny zestaw bÄ™dÄ… renderowane tutaj przez JS -->
                </div>
</div>
        </div>
    </section>

    <section id="galeriaDeckow" class="page">
        <h2>Moje Zapisane Decki</h2>
        <p style="text-align: center;">Tutaj znajdziesz wszystkie swoje zapisane konfiguracje deckÃ³w.</p>
        <div id="savedDecksContainer" style="margin-top: 20px;"></div>
    </section>
    <!-- ============================================= -->
    <!-- ===            SEKCJA OSIÄ„GNIÄ˜Ä†           === -->
    <!-- ============================================= -->
    <section id="osiagniecia" class="page">
        <h2>Moje OsiÄ…gniÄ™cia</h2>
        <p style="text-align: center;">ÅšledÅº swoje postÄ™py i odblokowuj kolejne cele!</p>
        <div id="achievementsContainer" style="margin-top: 20px;">
            <!-- Karty osiÄ…gniÄ™Ä‡ bÄ™dÄ… generowane przez JavaScript -->
        </div>
    </section>

    <!-- ============================================= -->
    <!-- ===           SEKCJA DANE                 === -->
    <!-- ============================================= -->
    <section id="importexport" class="page">
        <h2>ZarzÄ…dzanie Danymi</h2>
        <div class="card">
            <h3>Magazyn CzÄ™Å›ci</h3>
            <p>Skopiuj ten tekst, aby zrobiÄ‡ kopiÄ™ zapasowÄ… swojego magazynu, lub wklej dane, aby je przywrÃ³ciÄ‡.</p>
            <textarea id="poleDanychJsonMagazyn" rows="8" placeholder="Wklej tutaj dane JSON magazynu..."></textarea>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top:10px;">
                <button onclick="eksportujDaneDoPolaTekstowego()">Eksportuj Magazyn</button>
                <button onclick="importujDaneZPolaTekstowego()" class="danger-btn">Importuj Magazyn</button>
            </div>
        </div>
        <div class="card">
            <h3>Zapisane Decki</h3>
            <p>Skopiuj ten tekst, aby zrobiÄ‡ kopiÄ™ zapasowÄ… swoich deckÃ³w, lub wklej dane, aby je przywrÃ³ciÄ‡.</p>
            <textarea id="poleDanychJsonDecki" rows="8" placeholder="Wklej tutaj dane JSON deckÃ³w..."></textarea>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top:10px;">
                <button onclick="eksportujDeckiDoPolaTekstowego()">Eksportuj Decki</button>
                <button onclick="importujDeckiZPolaTekstowego()" class="danger-btn">Importuj Decki</button>
            </div>
        </div>
        <div class="card">
            <h3>Reset Aplikacji</h3>
            <p style="color: #ff8b8b;"><strong>OSTRZEÅ»ENIE:</strong> Ta operacja usunie <strong>WSZYSTKIE</strong> Twoje dane (magazyn, decki, wyniki) i przywrÃ³ci aplikacjÄ™ do stanu poczÄ…tkowego. Tej akcji nie moÅ¼na cofnÄ…Ä‡!</p>
            <button onclick="wykonajPelnyResetAplikacji()" class="danger-btn" style="margin-top: 10px; background-color: #d92d2d;">Resetuj AplikacjÄ™</button>
        </div>
    </section>
<section id="konto" class="page" style="display:none;">
    <h1 class="center">Moje Konto</h1>

    <!-- JeÅ›li uÅ¼ytkownik nie jest zalogowany -->
    <div id="kontoLoggedOut" style="display:none;" class="kontoBox">
        <h2>Zaloguj siÄ™</h2>
        <input type="email" id="loginEmail" placeholder="Email" class="kontoInput">
        <input type="password" id="loginPass" placeholder="HasÅ‚o" class="kontoInput">

        <button class="btnPrimary" onclick="firebaseLogin()">Zaloguj</button>
        <button class="btnSecondary" onclick="firebaseRegister()">UtwÃ³rz konto</button>
    </div>

    <!-- JeÅ›li uÅ¼ytkownik jest zalogowany -->
    <div id="kontoLoggedIn" style="display:none;" class="kontoBox">
        <h2>Witaj, <span id="kontoUserEmail"></span></h2>

        <button class="btnPrimary" onclick="logoutCurrentUser()">Wyloguj</button>

        <div class="kontoSubBox">
            <h3>Twoje dane w chmurze</h3>
            <p>Decki, magazyn i osiÄ…gniÄ™cia sÄ… automatycznie synchronizowane.</p>
        </div>

        <button class="btnSecondary" onclick="exportUserCloudData()">ðŸ“¦ Eksport danych z chmury</button>
    </div>
</section>

 <section id="poradnik" class="page">
     <h2>Poradnik dla PoczÄ…tkujÄ…cych</h2>
    <p style="text-align: center; margin-bottom: 25px;">Witaj w Å›wiecie Beyblade! Ten poradnik pomoÅ¼e Ci zrozumieÄ‡ podstawy.</p>
    <!-- ===>>> POPRAWIONY KOD - IKONA I TEKST SÄ„ LINKIEM <<<=== -->
    <p style="text-align: center; margin-top: -15px; margin-bottom: 30px; font-size: 1em; color: #bbb;">
        Polecam rÃ³wnieÅ¼ kanaÅ‚ na YouTube
        <a href="https://www.youtube.com/@bakutenshootblader" target="_blank" style="color: #ff6b6b; font-weight: bold; text-decoration: none;">
            <img src="img/yt.png" alt="YT" style="height:1.2em; vertical-align: -0.25em; margin: 0 3px;"> Baku
        </a>
        w tej tematyce.
    </p>
    <!-- Kontener na przyciski zakÅ‚adek -->
    <div class="tabs-container" id="poradnik-tabs">
        <button class="tab-button active" onclick="pokazZakladkePoradnika('bity', this)">Bity</button>
        <button class="tab-button" onclick="pokazZakladkePoradnika('rachety', this)">Ratchety</button>
        <button class="tab-button" onclick="pokazZakladkePoradnika('ostrza', this)">Ostrza</button>
        <button class="tab-button" onclick="pokazZakladkePoradnika('launchery', this)">Launchery</button>
        <button class="tab-button" onclick="pokazZakladkePoradnika('arena', this)">Arena i Zasady</button>
    </div>

    <!-- Kontener na treÅ›Ä‡ zakÅ‚adek -->
    <div id="poradnik-content-container">

        <!-- === SEKCJA BITY (POPRAWNIE ZAMKNIÄ˜TA) === -->
        <div id="poradnik-bity" class="poradnik-zakladka card active">
            <h3>Czym jest Bit?</h3>
            <p>Bit to koÅ„cÃ³wka ktÃ³ra stanowi punkt kontaktu Beyblade'a z arenÄ…. Jego ksztaÅ‚t i materiaÅ‚ decydujÄ… o sposobie poruszania siÄ™, prÄ™dkoÅ›ci, wytrzymaÅ‚oÅ›ci i odpornoÅ›ci na odrzucenie. To serce strategii kaÅ¼dego zestawu!</p>
            <h4>PodziaÅ‚ i Rodzaje BitÃ³w</h4>
            <p>Bity dzielÄ… siÄ™ na cztery gÅ‚Ã³wne kategorie, z ktÃ³rych kaÅ¼da ma unikalny symbol i styl gry:</p>
            <div class="kategorie-bitow-lista">
                <div class="kategoria-item">
                    <img src="img/attack.webp" alt="Symbol Ataku">
                    <span><strong>AtakujÄ…ce (Attack):</strong> SkupiajÄ… siÄ™ na szybkim i agresywnym ruchu, aby jak najszybciej znokautowaÄ‡ przeciwnika.</span>
                </div>
                <div class="kategoria-item">
                    <img src="img/defence.webp" alt="Symbol Obrony">
                    <span><strong>Obronne (Defence):</strong> Sstabilne i zaprojektowane, aby wytrzymaÄ‡ uderzenia i utrzymaÄ‡ siÄ™ w centrum areny.</span>
                </div>
                <div class="kategoria-item">
                    <img src="img/stamina.webp" alt="Symbol WytrzymaÅ‚oÅ›ci">
                    <span><strong>WytrzymaÅ‚oÅ›ciowe (Stamina):</strong> MajÄ… za zadanie krÄ™ciÄ‡ siÄ™ jak najdÅ‚uÅ¼ej, aby wygraÄ‡ przez przetrwanie (Spin Finish).</span>
                </div>
                <div class="kategoria-item">
                    <img src="img/balance.webp" alt="Symbol Balansu">
                    <span><strong>Zbalansowane (Balance):</strong> ÅÄ…czÄ… w sobie cechy pozostaÅ‚ych typÃ³w. SÄ… wszechstronne i potrafiÄ… dostosowaÄ‡ siÄ™ do rÃ³Å¼nych sytuacji.</span>
                </div>
            </div>
            <!-- ========================================================= -->
            <!-- ===>>> OSTATECZNA, POPRAWIONA STRUKTURA ZAKÅADEK <<<=== -->
            <!-- ========================================================= -->

            <h4>Lista BitÃ³w WedÅ‚ug Kategorii</h4>
            <!-- Tu umieÅ›cimy dynamicznie generowanÄ… listÄ™ -->
        </div> <!-- ZAMKNIÄ˜CIE SEKCJI #poradnik-bity -->

        <!-- === SEKCJA RACHETY (TERAZ POPRAWNIE JAKO OSOBNY ELEMENT) === -->
        <div id="poradnik-rachety" class="poradnik-zakladka card" style="display: none;">
            <h3>Czym jest Ratchet?</h3>
            <p>Ratchet to kluczowy element konstrukcyjny, ktÃ³ry Å‚Ä…czy Ostrze (Blade) z Bitem. Odpowiada za dwie fundamentalne cechy Beyblade'a: jego <strong>wysokoÅ›Ä‡</strong> oraz <strong>liczbÄ™ "zÄ™bÃ³w"</strong> wpÅ‚ywajÄ…cych na odpornoÅ›Ä‡ na rozpad (Burst).</p>

            <div class="kolumna-porownawcza" style="margin-bottom: 25px;">
                <h4>Jak odczytywaÄ‡ oznaczenia?</h4>
                <div class="kolumny-kontener">
                    <div class="kolumna-tekst">
                        <p>Nazwa Rachetu to jego kod DNA. Zawiera dwie kluczowe liczby:</p>
                        <div class="punkt-z-ikona">
                            <span class="cyfra-ikona">3</span>
                            <div>
                                <strong>Liczba zÄ™bÃ³w (np. "3")</strong>
                                <p>Oznacza liczbÄ™ wypustek, ktÃ³re blokujÄ… siÄ™ z Bitem. Generalnie, im wiÄ™cej zÄ™bÃ³w (np. 5 lub 9), tym wiÄ™ksza odpornoÅ›Ä‡ na Burst.</p>
                            </div>
                        </div>
                        <div class="punkt-z-ikona">
                            <span class="cyfra-ikona">60</span>
                            <div>
                                <strong>WysokoÅ›Ä‡ (np. "60")</strong>
                                <p>OkreÅ›la wysokoÅ›Ä‡ w milimetrach (60 = 6.0mm). Niskie Ratchety (np. 60) idealnie nadajÄ… siÄ™ do atakÃ³w od doÅ‚u.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <h4>Wizualne odczytywanie wysokoÅ›ci</h4>
                <p>WysokoÅ›Ä‡ Rachetu moÅ¼na rÃ³wnieÅ¼ szybko zidentyfikowaÄ‡, liczÄ…c pionowe wgÅ‚Ä™bienia w jego dolnej czÄ™Å›ci:</p>
                <ul class="lista-oznaczen">
                    <li><strong>8 wgÅ‚Ä™bieÅ„</strong> (4 na stronÄ™) = wysokoÅ›Ä‡ <strong>8.0mm</strong></li>
                    <li><strong>7 wgÅ‚Ä™bieÅ„</strong> (3+4) = wysokoÅ›Ä‡ <strong>7.0mm</strong></li>
                    <li><strong>6 wgÅ‚Ä™bieÅ„</strong> (3 na stronÄ™) = wysokoÅ›Ä‡ <strong>6.0mm</strong></li>
                    <li><strong>5 wgÅ‚Ä™bieÅ„</strong> (3+2) = wysokoÅ›Ä‡ <strong>5.0mm</strong></li>
                    <li><strong>WgÅ‚Ä™bienie poziome</strong> dodaje <strong>+0.5mm</strong>. To cecha RatchetÃ³w typu "Simple".</li>
                </ul>
            </div>

            <div class="kolumna-porownawcza">
                <h4 style="margin-top: 0;">PodziaÅ‚ RatchetÃ³w</h4>
                <p>ChociaÅ¼ wszystkie Ratchety peÅ‚niÄ… tÄ™ samÄ… funkcjÄ™, dzielÄ… siÄ™ na trzy gÅ‚Ã³wne grupy konstrukcyjne:</p>
                <div class="trzy-kolumny-kontener" style="margin-top: 15px;">
                    <div class="kolumna">
                        <div class="kolumna-naglowek bx-kolor"><h5>Standardowe</h5></div>
                        <div class="kolumna-tresc">
                            <p>Najbardziej podstawowy i wszechstronny typ.</p>
                            <p><strong>PrzykÅ‚ad:</strong> <em>3-60, 5-80.</em></p>
                        </div>
                    </div>
                    <div class="kolumna">
                        <div class="kolumna-naglowek cx-kolor"><h5>Simple</h5></div>
                        <div class="kolumna-tresc">
                            <p>PosiadajÄ… "poÅ‚Ã³wkowÄ…" wysokoÅ›Ä‡ (np. 65 = 6.5mm) i sÄ… kompatybilne z ostrzem <strong>ClockMirage</strong>.</p>
                            <p><strong>PrzykÅ‚ad:</strong> <em>9-65.</em></p>
                        </div>
                    </div>
                    <div class="kolumna">
                        <div class="kolumna-naglowek ux-kolor"><h5>Zintegrowane z Bitem</h5></div>
                        <div class="kolumna-tresc">
                            <p>MajÄ… na staÅ‚e wbudowanÄ… koÅ„cÃ³wkÄ™ (Bit). Nie moÅ¼na ich rozdzieliÄ‡.</p>
                            <p><strong>PrzykÅ‚ad:</strong> <em>Operate, Turbo.</em></p>
                        </div>
                    </div>
                </div>
                <div class="poradnik-obrazek-z-podpisem" style="margin: 30px auto 0 auto; max-width: 300px;">
                    <img src="img/rodzajerachet.png" alt="Zaczepy montaÅ¼owe RatchetÃ³w">
                    <p class="podpis-obrazka">Zaczepy montaÅ¼owe RatchetÃ³w idÄ…c od lewej <strong>Simple</strong>, <strong>Standardowy</strong>, <strong>Zintegrowany z Bitem</strong></p>
                </div>
            </div>
        </div> <!-- ZAMKNIÄ˜CIE SEKCJI #poradnik-rachety -->

        <!-- === SEKCJA OSTRZA === -->
        <div id="poradnik-ostrza" class="poradnik-zakladka card" style="display: none;">
            <h3>Czym jest Ostrze (Blade)?</h3>
            <p>Ostrze to gÅ‚Ã³wna, metalowa czÄ™Å›Ä‡ Beyblade'a, ktÃ³ra odpowiada za zadawanie obraÅ¼eÅ„ i obronÄ™. Jego ksztaÅ‚t, waga i rozkÅ‚ad masy definiujÄ… podstawowy charakter Beyblade'a (atak, obrona, wytrzymaÅ‚oÅ›Ä‡, balans).</p>
            <h4 style="text-align: center; margin-bottom: 20px;">PodziaÅ‚ Ostrzy ze wzglÄ™du na budowÄ™</h4>
            <p>Ostrza w systemie Beyblade X dzielÄ… siÄ™ na trzy gÅ‚Ã³wne typy konstrukcyjne, ktÃ³re determinujÄ… ich unikalne wÅ‚aÅ›ciwoÅ›ci i sposÃ³b montaÅ¼u.</p>
            <div class="trzy-kolumny-kontener">
                <div class="kolumna">
                    <div class="kolumna-naglowek bx-kolor">
                        <img src="img/Bx.webp" alt="PrzykÅ‚ad Ostrza BX">
                        <h5>Basic (BX)</h5>
                    </div>
                    <div class="kolumna-tresc">
                        <p><strong>Budowa:</strong> JednoczÄ™Å›ciowe, metalowe zaczepy.</p>
                        <p><strong>Charakterystyka:</strong> StanowiÄ… fundament wiÄ™kszoÅ›ci standardowych zestawÃ³w, takich jak <strong>Dran Sword</strong> czy <strong>Hells Scythe</strong>.</p>
                        <p><strong>MontaÅ¼:</strong> Prosty, Blade + Rachet + Bit</p>
                    </div>
                </div>
                <div class="kolumna">
                    <div class="kolumna-naglowek ux-kolor">
                        <img src="img/Ux.webp" alt="PrzykÅ‚ad Ostrza UX">
                        <h5>Unique(UX)</h5>
                    </div>
                    <div class="kolumna-tresc">
                        <p><strong>Budowa:</strong> JednoczÄ™Å›ciowe, plastikowe zaczepy.</p>
                        <p><strong>Charakterystyka:</strong> Plastikowe haki sprawiajÄ…, Å¼e wiÄ™cej masy moÅ¼na przenieÅ›Ä‡ na rant Bladeâ€™a. Emblem (ozdoba) w UX bywa zablokowany.</p>
                        <p><strong>MontaÅ¼:</strong> Prosty, Blade + Rachet + Bit</p>
                    </div>
                </div>
                <div class="kolumna">
                    <div class="kolumna-naglowek cx-kolor">
                        <img src="img/Cx.webp" alt="PrzykÅ‚ad Ostrza CX">
                        <h5>Custom(CX)</h5>
                    </div>
                    <div class="kolumna-tresc">
                        <p><strong>Budowa:</strong> Trzy elementy skÅ‚adowe.</p>
                        <p><strong>Charakterystyka:</strong> WprowadzajÄ… rewolucyjnÄ… moÅ¼liwoÅ›Ä‡ personalizacji i dostosowania dysku pod swÃ³j styl gry.</p>
                        <p><strong>MontaÅ¼:</strong> Wieloetapowy, Blade (Lockchip + Main + Assist) + Ratchet + Bit.</p>
                    </div>
                </div>
            </div>
            <h4 style="text-align: center; margin-top: 40px; margin-bottom: 20px;">Prawo- czy LewoskrÄ™tne? Klucz do strategii</h4>
            <div class="kolumny-kontener">
                <div class="kolumna-porownawcza">
                    <h5><img src="img/prawo.png" alt="Symbol PrawoskrÄ™tnoÅ›ci"> PrawoskrÄ™tne (Right-Spin)</h5>
                    <p>To standardowy i najczÄ™Å›ciej spotykany typ rotacji. W walce dwÃ³ch prawoskrÄ™tnych Beyblade'Ã³w dochodzi do wielu uderzeÅ„ "odpychajÄ…cych".</p>
                </div>
                <div class="kolumna-porownawcza">
                    <h5><img src="img/lewo.png" alt="Symbol LewoskrÄ™tnoÅ›ci"> LewoskrÄ™tne (Left-Spin)</h5>
                    <p>W starciu z prawoskrÄ™tnym przeciwnikiem dochodzi do czoÅ‚owych, silnych uderzeÅ„ i "kradzieÅ¼y" energii kinetycznej.</p>
                </div>
            </div>
        </div>

        <!-- === SEKCJA LAUNCHERY === -->
        <div id="poradnik-launchery" class="poradnik-zakladka card" style="display: none;">
            <h3>Czym jest Launcher?</h3>
            <p>Launcher (wyrzutnia) to urzÄ…dzenie sÅ‚uÅ¼Ä…ce do wprawienia Beyblade'a w ruch obrotowy. SiÅ‚a, stabilnoÅ›Ä‡ i rodzaj launchera majÄ… ogromny wpÅ‚yw na wynik pojedynku.</p>
            <h4 style="text-align: center; margin-top: 40px;">Rodzaje LauncherÃ³w</h4>
            <div class="launcher-cards-container">
                <div class="launcher-card">
                    <div class="launcher-header">
                        <img id="winder-launcher-img" src="img/winder.png" alt="Winder Launcher">
                        <h5 id="winder-launcher-title">Winder Launcher (PrawoskrÄ™tny)</h5>
                        <div class="spin-switcher">
                            <button id="winder-l-btn" onclick="zmienLauncher('winder', 'l')">L</button>
                            <button id="winder-r-btn" class="active" onclick="zmienLauncher('winder', 'r')">R</button>
                        </div>
                    </div>
                    <div class="launcher-body">
                        <p><strong>Jak dziaÅ‚a:</strong> UÅ¼ywa plastikowej zÄ™batki (ripcord). Najpopularniejszy typ wyrzutni.</p>
                        <ul><li><strong>Zalety:</strong> Potencjalnie najwyÅ¼sza siÅ‚a startu (RPM).</li><li><strong>Wady:</strong> Trudniejsza kontrola nad mocÄ….</li></ul>
                    </div>
                </div>
                <div class="launcher-card">
                    <div class="launcher-header">
                        <img id="string-launcher-img" src="img/string.png" alt="String Launcher">
                        <h5 id="string-launcher-title">String Launcher (PrawoskrÄ™tny)</h5>
                        <div class="spin-switcher">
                            <button id="string-l-btn" onclick="zmienLauncher('string', 'l')">L</button>
                            <button id="string-r-btn" class="active" onclick="zmienLauncher('string', 'r')">R</button>
                        </div>
                    </div>
                    <div class="launcher-body">
                        <p><strong>Jak dziaÅ‚a:</strong> UÅ¼ywa linki, co zapewnia pÅ‚ynniejszy start.</p>
                        <ul><li><strong>Zalety:</strong> Znacznie lepsza kontrola nad siÅ‚Ä… startu.</li><li><strong>Wady:</strong> Zazwyczaj niÅ¼sza maksymalna prÄ™dkoÅ›Ä‡.</li></ul>
                    </div>
					</div>
					
					<div class="launcher-card">
    <div class="launcher-header">
        <img src="img/hold.png" alt="Hold Launcher">
        <h5>Hold Launcher</h5>
    </div>
    <div class="launcher-body">
        <p><strong>Jak dziaÅ‚a:</strong> Unikalny dla Beyblade X typ wyrzutni zintegrowanej z uchwytem (gripem). Beyblade jest "trzymany" w specjalnym mechanizmie, co pozwala na start pod rÃ³Å¼nymi kÄ…tami.</p>
        <ul>
            <li><strong>Zalety:</strong> Daje ogromnÄ… kontrolÄ™ nad kÄ…tem i momentem startu. Pozwala na niestandardowe, strategiczne zagrania, takie jak start z pochyleniem.</li>
            <li><strong>Wady:</strong> MoÅ¼e oferowaÄ‡ nieco mniejszÄ… moc w porÃ³wnaniu do dedykowanego, mocnego Windera. Wymaga przyzwyczajenia.</li>
            <li><strong>Kiedy uÅ¼ywaÄ‡:</strong> Gdy Twoja strategia opiera siÄ™ na precyzyjnym umiejscowieniu Beyblade'a na arenie lub chcesz zaskoczyÄ‡ przeciwnika nietypowym startem.</li>
        </ul>
    </div>
</div>


        <!-- KARTA 3: Proto Launcher -->
        <div class="launcher-card">
            <div class="launcher-header">
                <img src="img/proto.png" alt="Proto Launcher">
                <h5>Proto Launcher (startowy)</h5>
            </div>
            <div class="launcher-body">
                <p><strong>Jak dziaÅ‚a:</strong> Maksymalnie uproszczona, maÅ‚a wyrzutnia, czÄ™sto doÅ‚Ä…czana do niektÃ³rych zestawÃ³w jako podstawowe akcesorium.</p>
                <ul>
                    <li><strong>Zalety:</strong> MaÅ‚y, lekki i prosty w obsÅ‚udze.</li>
                    <li><strong>Wady:</strong> Bardzo niska moc i kontrola. Powszechnie uwaÅ¼any za najgorszy typ wyrzutni, niezalecany do powaÅ¼niejszych rozgrywek.</li>
                    <li><strong>Kiedy uÅ¼ywaÄ‡:</strong> WyÅ‚Ä…cznie jako rozwiÄ…zanie tymczasowe, gdy nie masz dostÄ™pu do lepszej wyrzutni.</li>
                </ul>
            </div>
        </div>

               
            </div>
            <h4 style="text-align: center; margin-top: 40px; margin-bottom: 20px;">Akcesoria do LauncherÃ³w</h4>
            <div class="launcher-cards-container">
                <div class="launcher-card">
                    <div class="launcher-header"><img src="img/pass.png" alt="Battle Pass" style="width: 150px; height: auto;"><h5>Battle Pass</h5></div>
                    <div class="launcher-body"><p>Cyfrowe urzÄ…dzenie do Å›ledzenia statystyk i mocy startu. Synchronizuje dane z aplikacjÄ… mobilnÄ….</p></div>
                </div>
                <div class="launcher-card">
                    <div class="launcher-header"><img src="img/grip.png" alt="Grip" style="width: 150px; height: auto;"><h5>Grip (Uchwyt)</h5></div>
                    <div class="launcher-body"><p>Ergonomiczny uchwyt, do ktÃ³rego montuje siÄ™ launcher. Poprawia stabilnoÅ›Ä‡ i komfort trzymania wyrzutni.</p></div>
                </div>
            </div>
        </div>
</div>
        <!-- === SEKCJA ARENA I ZASADY (OSTATECZNA POPRAWKA STRUKTURY) === -->
        <div id="poradnik-arena" class="poradnik-zakladka card" style="display: none;">

            <!-- Kolumna 1: Arena -->
            <div class="kolumna-porownawcza">
                <h3>Arena (Beystadium X)</h3>
                <div class="kolumny-kontener" style="align-items: center;">
                    <div class="kolumna-obrazek" style="flex: 1.2;"><img src="img/arena.png" alt="Arena Beyblade X"></div>
                    <div class="kolumna-tekst" style="flex: 1;">
                        <p>Oficjalna arena Beyblade X to kluczowy element taktyczny. Jej unikalna budowa wymusza dynamiczne starcia.</p>
                        <ul class="lista-oznaczen">
                            <li><strong>Battle Zone:</strong> GÅ‚Ã³wne pole walki w centrum.</li>
                            <li><strong>Xtreme Line:</strong> ZewnÄ™trzny tor z zÄ™batkami, ktÃ³ry gwaÅ‚townie przyspiesza Beyblade'y.</li>
                            <li><strong>Over Zone (Pocket):</strong> Boczne "kieszenie", do ktÃ³rych wpadniÄ™cie koÅ„czy walkÄ™.</li>
                            <li><strong>Xtreme Zone (Pocket):</strong> Specjalna strefa, do ktÃ³rej wrzucenie przeciwnika daje najwiÄ™cej punktÃ³w.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Kolumna 2: Punktacja -->
            <div class="kolumna-porownawcza" style="margin-top: 25px;">
                <h3>Podstawowe Zasady Punktacji</h3>
                <p>W standardowej walce wygrywa gracz, ktÃ³ry jako pierwszy zdobÄ™dzie 4 punkty. Punkty przyznawane sÄ… za cztery rodzaje "finishÃ³w":</p>
                <div class="punktacja-grid-2x2">
                    <div class="finish-card"><img src="img/spin_finish.png" alt="Spin Finish - 1 Punkt"><div class="finish-card-body"><p>TwÃ³j Beyblade krÄ™ci siÄ™ dÅ‚uÅ¼ej niÅ¼ Beyblade przeciwnika.</p></div></div>
                    <div class="finish-card"><img src="img/over_finish.png" alt="Over Finish - 2 Punkty"><div class="finish-card-body"><p>Wyrzucasz Beyblade'a przeciwnika do jednej z "kieszeni" (Over Zone).</p></div></div>
                    <div class="finish-card"><img src="img/burst_finish.png" alt="Burst Finish - 2 Punkty"><div class="finish-card-body"><p>"Rozbijasz" Beyblade'a przeciwnika na elementy.</p></div></div>
                    <div class="finish-card"><img src="img/xtreme_finish.png" alt="Xtreme Finish - 3 Punkty"><div class="finish-card-body"><p>Wyrzucasz Beyblade'a przeciwnika poza arenÄ™ przez "Xtreme Pocket".</p></div></div>
                </div>
            </div>

            <!-- Kolumna 3: Zasady Decku -->
            <div class="kolumna-porownawcza" style="margin-top: 25px;">
                <h3>Zasady Konstrukcji Decku</h3>
                <p>Na oficjalnych turniejach obowiÄ…zuje format tzw. <em><strong>"DeckÃ³w"</strong></em> czyli zestawÃ³w skÅ‚adajÄ…cych siÄ™ z 3 lub 4 rÃ³Å¼nych Beyblade'Ã³w.</p>
                <p>Przy formacie <strong>Trzech DyskÃ³w</strong> gramy wszystkimi Dyskami</p>
				<p>Przy formacie <strong>Czterech DyskÃ³w</strong> na poczÄ…tku banuje siÄ™ <em>(wyrzuca z pojedynku)</em> jeden dysk przeciwnika i gra sie pozostaÅ‚ymi.</p>
                <h4>ReguÅ‚a Unikalnych CzÄ™Å›ci</h4>
                <p>NajwaÅ¼niejszÄ… zasadÄ… jest <strong>reguÅ‚a unikalnoÅ›ci czÄ™Å›ci</strong>. Oznacza to, Å¼e w caÅ‚ym Decku <strong>kaÅ¼da czÄ™Å›Ä‡ moÅ¼e byÄ‡ uÅ¼yta tylko raz</strong>.
             
                    <p>Np. JeÅ›li uÅ¼yÅ‚eÅ› Blade'a <strong><em>Dran Sword</em></strong> w pierwszym zestawie, nie moÅ¼esz go uÅ¼yÄ‡ w pozostaÅ‚ych</p>
                   
                <h4>WyjÄ…tek: CX Lock Chip</h4>
                <p>Jedynym wyjÄ…tkiem od tej reguÅ‚y sÄ… <strong>standardowe (niemetalowe) CX Lock Chipy</strong>. MogÄ… byÄ‡ uÅ¼ywane wielokrotnie. Metalowe Lock Chipy <strong><em>Emperor</em></strong> oraz <strong><em>Valkyrie</em></strong> podlegajÄ… regule unikalnoÅ›ci.</p>
            </div>
</div>

        
</section> 
        <script>
            // =================================
            // Konfiguracja i Zmienne Globalne
            // =================================
			    // =================================
    // === Inicjalizacja Firebase (NOWE) ===
    // =================================
    const firebaseConfig = {
      apiKey: "TWOJ_API_KEY", // <--- PODMIEÅƒ
      authDomain: "TWOJ-PROJEKT-ID.firebaseapp.com", // <--- PODMIEÅƒ
      projectId: "TWOJ-PROJEKT-ID", // <--- PODMIEÅƒ
      storageBucket: "TWOJ-PROJEKT-ID.appspot.com", // <--- PODMIEÅƒ
      messagingSenderId: "TWOJ_SENDER_ID", // <--- PODMIEÅƒ
      appId: "TWOJ_APP_ID" // <--- PODMIEÅƒ
    };

    // Inicjalizacja aplikacji Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let currentUser = null;
    let currentAuthMode = 'login'; // 'login' lub 'register'

            const ACHIEVEMENTS_KEY = 'beybladeAchievementsAnanas_v1';
            const ID_CLOCK_MIRAGE = "206";
            let sidebarExpanded = false;
            const sidebarWidthExpanded = 260;
            const sidebarWidthCollapsed = 50;
            let currentEditingDeckId = null;
            let isBulkEditMode = false;

            let sidebar, appContainer, sidebarToggleBtn, menuIcon, menuBtnText;
            let wynikiDivGenerator, placeholderActualImgGenerator;

            let ostatnioWylosowaneZestawyGlobalnie = [];

            const MAGAZYN_KEY = 'beybladeMagazynAnanasCX_v3';
            const SAVED_DECKS_KEY = 'savedBeybladeDecksAnanasCX_v3';
            const SCORES_KEY = 'beybladeScoreCounterAnanas';
            const DOMYSLNA_BAZA_ZALADOWANA_KEY = 'ananasAppDomyÅ›lnaBazaZaladowana_v1';
            let currentDeckBeingBuilt = {};
            let currentlyActiveSetIndexInBuilder = 0;
            let imageHideTimeouts = { player1: null, player2: null };
            let fullscreenOverlayHideTimeout = null;
            let deckViewMode = localStorage.getItem("deckViewMode") || "list";

            function toggleDeckView() {
              deckViewMode = (deckViewMode === "list") ? "drag" : "list";
              localStorage.setItem("deckViewMode", deckViewMode);
              renderDeckBuilderAndParts(currentDeckBeingBuilt);
            }


            function renderDeckBuilder() {
              const container = document.getElementById("deck-builder");
              if (!container) {
                console.warn("âš ï¸ Brak kontenera #deck-builder â€” pomijam renderowanie (np. po dropie)");
                return;
              }container.innerHTML = "";

              if (deckViewMode === 'list') {
                renderDeckList(container);
              } else {
                renderDeckDrag(container);
              }
            }

            function handleDrop(event) {
              event.preventDefault();
              // aktualizacja danych po przeciÄ…gniÄ™ciu
              // ...
              renderDeckBuilder(); // zachowuje wybrany tryb
            }


            function initializeOrResetCurrentDeck(deckData = null) {
                const defaultSetStructure = () => ({
                    seria: 'bx_ux', bladeId: null, bladeAktywnyTrybIndex: 0,
                    ratchetId: null, bitId: null, cx_lock_chipId: null,
                    cx_main_bladeId: null, cx_main_bladeAktywnyTrybIndex: 0,
                    cx_assist_bladeId: null, statystykiObliczone: {}
                });

                if (deckData && deckData.id) {
                    currentDeckBeingBuilt = JSON.parse(JSON.stringify(deckData));
                    currentDeckBeingBuilt.sets = currentDeckBeingBuilt.sets.map(set => ({ ...defaultSetStructure(), ...set }));
                    while (currentDeckBeingBuilt.sets.length < 4) {
                        currentDeckBeingBuilt.sets.push(defaultSetStructure());
                    }
                    if (document.getElementById('deckName')) {
                        document.getElementById('deckName').value = currentDeckBeingBuilt.name || "";
                    }
                    currentEditingDeckId = deckData.id;
                } else {
                    currentDeckBeingBuilt = {
                        name: "",
                        id: `temp_deck_${Date.now()}_${Math.random().toString(16).slice(2)}`,
                        sets: Array(4).fill(null).map(() => defaultSetStructure())
                    };
                    if (document.getElementById('deckName')) {
                        document.getElementById('deckName').value = "";
                    }
                    currentEditingDeckId = null;
                }
                console.log("Zainicjalizowano/Zresetowano currentDeckBeingBuilt:", JSON.parse(JSON.stringify(currentDeckBeingBuilt)));
            }

            function clearCurrentDeckForBuilder() {
                const deckNameInput = document.getElementById('deckName');
                if (deckNameInput) deckNameInput.value = "";
                initializeOrResetCurrentDeck();
                currentEditingDeckId = null;
                const saveBtn = document.getElementById('saveDeckButton');
                if (saveBtn) saveBtn.textContent = 'Zapisz Aktualny Deck';
                currentlyActiveSetIndexInBuilder = 0;
                renderDeckBuilderAndParts();
                showNotification("Builder decku wyczyszczony.", 2000, 'info');
            }

            function getMagazyn() {
                try {
                    const magazynString = localStorage.getItem(MAGAZYN_KEY);
                    return magazynString ? JSON.parse(magazynString) : [];
                } catch (e) {
                    showNotification("BÅ‚Ä…d odczytu danych magazynu.", 3000, 'error');
                    console.error("BÅ‚Ä…d odczytu magazynu:", e);
                    return [];
                }
            }

            function setMagazyn(magazynArray) {
                try {
                    localStorage.setItem(MAGAZYN_KEY, JSON.stringify(magazynArray));
                } catch (e) {
                    showNotification("BÅ‚Ä…d zapisu danych magazynu.", 3000, 'error');
                    console.error("BÅ‚Ä…d zapisu magazynu:", e);
                }
            }

            function getSavedDecks() {
                try {
                    const decksString = localStorage.getItem(SAVED_DECKS_KEY);
                    return decksString ? JSON.parse(decksString) : [];
                } catch (e) {
                    showNotification("BÅ‚Ä…d odczytu zapisanych deckÃ³w.", 3000, 'error');
                    console.error("getSavedDecks BÅ‚Ä…d:", e);
                    return [];
                }
            }

            function setSavedDecks(decksArray) {
                try {
                    localStorage.setItem(SAVED_DECKS_KEY, JSON.stringify(decksArray));
                } catch (e) {
                    showNotification("BÅ‚Ä…d zapisu deckÃ³w do localStorage.", 3000, 'error');
                    console.error("setSavedDecks BÅ‚Ä…d:", e);
                }
            }

            // =======================================================================
            // === OSTATECZNY SYSTEM OSIÄ„GNIÄ˜Ä† z PASKAMI POSTÄ˜PU ===
            // =======================================================================

            function getUnlockedAchievements() {
                try {
                    const unlocked = localStorage.getItem(ACHIEVEMENTS_KEY);
                    return unlocked ? JSON.parse(unlocked) : {};
                } catch (e) {
                    return {};
                }
            }

            // --- Szablon do tworzenia funkcji `progress` dla kolekcji konkretnych czÄ™Å›ci ---
            const createCollectionProgress = (requiredPartNames) => {
                return () => {
                    const posiadane = new Set(getMagazyn().filter(p => p.ilosc > 0).map(p => p.nazwa));
                    const ilePosiadanych = requiredPartNames.filter(nazwa => posiadane.has(nazwa)).length;
                    return { current: ilePosiadanych, max: requiredPartNames.length };
                };
            };

            // --- Szablon do tworzenia funkcji `progress` dla kolekcji czÄ™Å›ci danego typu ---
            const createPartTypeProgress = (partType, subType = null) => {
                return () => {
                    const baza = getMagazyn();
                    let czesciDanegoTypu = baza.filter(p => p.typ === partType && (subType ? p.rodzaj === subType : true));
                    if (czesciDanegoTypu.length === 0) return { current: 0, max: 1 };
                    const posiadane = czesciDanegoTypu.filter(p => p.ilosc > 0).length;
                    return { current: posiadane, max: czesciDanegoTypu.length };
                };
            };

            // --- GÅ‚Ã³wny obiekt z definicjami osiÄ…gniÄ™Ä‡ (teraz z funkcjÄ… `progress`) ---
            const allAchievements = {
                // --- OsiÄ…gniÄ™cia Funkcjonalne ---
                mojpierwszydeck: { title: "MÃ³j Pierwszy Deck", description: "Zapisz pierwszy deck.", icon: 'img/osiagniecie.png', progress: () => ({ current: getSavedDecks().length, max: 1 }) },
                beycrafter_braz: { title: "BeyCrafter BrÄ…z", description: "Zapisz 5 lub wiÄ™cej deckÃ³w w galerii.", icon: 'img/PucharBraz.png', progress: () => ({ current: getSavedDecks().length, max: 5 }) },
                beycrafter_srebro: { title: "BeyCrafter Srebro", description: "Zapisz 10 lub wiÄ™cej deckÃ³w w galerii.", icon: 'img/PucharSrebro.png', progress: () => ({ current: getSavedDecks().length, max: 10 }) },
                beycrafter_zloto: { title: "BeyCrafter ZÅ‚oto", description: "Zapisz 15 lub wiÄ™cej deckÃ³w w galerii.", icon: 'img/PucharZloto.png', progress: () => ({ current: getSavedDecks().length, max: 15 }) },
                beycrafter_diament: { title: "BeyCrafter Diament", description: "Zapisz 20 lub wiÄ™cej deckÃ³w w galerii.", icon: 'img/PucharDiament.png', progress: () => ({ current: getSavedDecks().length, max: 20 }) },

                // --- Poziomy Kolekcjonerskie (Procentowe) ---
                kolekcjoner_poczotkujacy: {
                    title: "Kolekcjoner BrÄ…z", description: "Posiadaj 15% wszystkich czÄ™Å›ci.", icon: 'img/PucharBraz.png',
                    progress: () => {
                        const baza = getMagazyn(); if (baza.length === 0) return { current: 0, max: 1 };
                        return { current: baza.filter(p => p.ilosc > 0).length, max: Math.ceil(baza.length * 0.15) };
                    }
                },
                kolekcjoner_zaawansowany: {
                    title: "Kolekcjoner Srebro", description: "Posiadaj 30% wszystkich czÄ™Å›ci.", icon: 'img/PucharSrebro.png',
                    progress: () => {
                        const baza = getMagazyn(); if (baza.length === 0) return { current: 0, max: 1 };
                        return { current: baza.filter(p => p.ilosc > 0).length, max: Math.ceil(baza.length * 0.30) };
                    }
                },
                kolekcjoner_elitarny: {
                    title: "Kolekcjoner ZÅ‚oto", description: "Posiadaj 60% wszystkich czÄ™Å›ci.", icon: 'img/PucharZloto.png',
                    progress: () => {
                        const baza = getMagazyn(); if (baza.length === 0) return { current: 0, max: 1 };
                        return { current: baza.filter(p => p.ilosc > 0).length, max: Math.ceil(baza.length * 0.60) };
                    }
                },
                kolekcjoner_boski: {
                    title: "Kolekcjoner Diament", description: "Posiadaj 90% wszystkich czÄ™Å›ci.", icon: 'img/PucharDiament.png',
                    progress: () => {
                        const baza = getMagazyn(); if (baza.length === 0) return { current: 0, max: 1 };
                        return { current: baza.filter(p => p.ilosc > 0).length, max: Math.ceil(baza.length * 0.90) };
                    }
                },
                cheater: {
                    title: "Cheater!", description: "Posiadaj 100% wszystkich czÄ™Å›ci.", icon: 'img/PucharEnigma.png',
                    progress: () => {
                        const baza = getMagazyn(); if (baza.length === 0) return { current: 0, max: 1 };
                        return { current: baza.filter(p => p.ilosc > 0).length, max: baza.length };
                    }
                },

                // --- OsiÄ…gniÄ™cia Tematyczne (Rodziny) ---
                rodzina_smoka: { title: "Rodzina Smoka", description: "Posiadaj Wszystkie Drany.", icon: 'img/PucharDran.png', progress: createCollectionProgress(['DranSword', 'DranDagger', 'DranBuster', 'Dran']) },
                gildia_magow: { title: "Gildia MagÃ³w", description: "Posiadaj Wszystkie Wizard.", icon: 'img/PucharWizard.png', progress: createCollectionProgress(['WizardArrow', 'WizardRod', 'Wizard']) },
                z_piekla_rodem: { title: "Z PiekÅ‚a Rodem", description: "Posiadaj Wszystkie Hells.", icon: 'img/PucharHells.png', progress: createCollectionProgress(['HellsScythe', 'HellsChain', 'HellsHammer', 'Hells']) },
                bractwo_rycerskie: { title: "Bractwo Rycerskie", description: "Posiadaj Wszystkie Knight.", icon: 'img/PucharKnight.png', progress: createCollectionProgress(['KnightShield', 'KnightLance', 'KnightMail']) },
                dojo: { title: "Dojo", description: "Posiadaj KaÅ¼dego Samuraja i Shinobi.", icon: 'img/PucharDojo.png', progress: createCollectionProgress(['SamuraiCalibur', 'SamuraiSaber', 'SamuraiSteel', 'ShinobiKnife', 'ShinobiShadow']) },
            stajnia: {
                title: "Stajnia",
                description: "Posiadaj wszystkie Konie.",
                icon: 'img/osiagniecie.png', // MoÅ¼esz podmieniÄ‡ na 'img/PucharKonie.png'
                progress: createCollectionProgress(['StormPegasis', 'UnicornSting', 'AeroPegasus', 'Pegasus'])
            },

            sharknado: {
                title: "Sharknado",
                description: "Posiadaj wszystkie Rekiny.",
                icon: 'img/osiagniecie.png', // MoÅ¼esz podmieniÄ‡ na 'img/PucharRekin.png'
                progress: createCollectionProgress(['GillShark', 'SharkEdge', 'SharkScale'])
            },

            ornitolog: {
                title: "Ornitolog",
                description: "Posiadaj wszystkie Ptaki.",
                icon: 'img/osiagniecie.png', // MoÅ¼esz podmieniÄ‡ na 'img/PucharPtak.png'
                progress: createCollectionProgress(['CrimsonGaruda', 'PhoenixRudder', 'PhoenixWing', 'PhoenixFeather'])
            },
                // --- OsiÄ…gniÄ™cia Specjalne (Persony) ---
                og_persona: { title: "OG Persona", description: "Posiadaj Deck Persony z S1.", icon: 'img/osiagniecie.png', progress: createCollectionProgress(['DranDagger', 'WizardArrow', 'KnightLance', 'HellsScythe']) },
                persona_v2: { title: "Persona v2", description: "Posiadaj Deck Persony z S2.", icon: 'img/osiagniecie.png', progress: createCollectionProgress(['Dran', 'Hells', 'KnightMail', 'Wizard', 'SamuraiSaber']) },

                // --- OsiÄ…gniÄ™cia Crossover ---
                x_over_project: { title: "X-Over Project", description: "Posiadaj wszystkie czÄ™Å›ci z X-Over Project.", icon: 'img/PucharX.png', progress: createCollectionProgress(['DragoonStorm', 'DranzerSpiral', 'DrigerSlash', 'DracielShield', 'Lightning L-Drago (Upper Type)', 'Lightning L-Drago (Rapid-Hit Type)', 'Rock Leone', 'StormPegasis', 'VictoryValkyrie', 'XenoXcalibur']) },
                transformers_collection: { title: "Kolekcja: Transformers", description: "Posiadaj wszystkie czÄ™Å›ci z serii Transformers.", icon: 'img/PucharTrans.png', progress: createCollectionProgress(['Bumblebee', 'Megatron', 'Optimus Primal', 'Optimus Prime', 'Shockwave', 'Starscream']) },
                star_wars_collection: { title: "Kolekcja: Star Wars", description: "Posiadaj wszystkie czÄ™Å›ci z serii Star Wars.", icon: 'img/PucharStar.png', progress: createCollectionProgress(['Chewbacca', 'Darth Vader', 'General Grievous', 'Luke Skywalker', 'Moff Gideon', 'Obi-Wan Kenobi', 'Stormtrooper', 'Mandalorian']) },
                marvel_collection: { title: "Kolekcja: Marvel", description: "Posiadaj wszystkie czÄ™Å›ci z serii Marvel.", icon: 'img/PucharMarvel.png', progress: createCollectionProgress(['Captain America', 'Green Goblin', 'Iron Man', 'Miles Morales', 'Red Hulk', 'Spider-Man', 'Thanos', 'Venom']) },
                jurassic_world_collection: { title: "Kolekcja: Jurassic World", description: "Posiadaj wszystkie czÄ™Å›ci z serii Jurassic World.", icon: 'img/PucharDino.png', progress: createCollectionProgress(['TriceraSpiky', 'Quetzalcoatlus', 'Spinosaurus', 'T.Rex']) },


                // --- Specjalistyczne OsiÄ…gniÄ™cia Kolekcjonerskie ---
                   // --- NOWA KATEGORIA: OSIÄ„GNIÄ˜CIA ZA SKOMPLETOWANIE TYPU CZÄ˜ÅšCI ---

                mistrz_blade_bx: {
                    title: "Mistrz Ostrzy BX",
                    description: "Zbierz wszystkie czÄ™Å›ci typu Blade z serii BX.",
                    icon: 'img/PucharBX.png', // Przygotuj ikonÄ™
                    progress: () => {
                        const all_bx = getMagazyn().filter(p => p.typ === 'blade' && p.nazwa !== 'Trypio');
                        if (all_bx.length === 0) return { current: 0, max: 1 };
                        const owned_bx = all_bx.filter(p => p.ilosc > 0).length;
                        return { current: owned_bx, max: all_bx.length };
                    }
                },

                mistrz_blade_ux: {
                    title: "Mistrz Ostrzy UX",
                    description: "Zbierz wszystkie czÄ™Å›ci typu Blade z serii UX.",
                    icon: 'img/PucharUX.png', // Przygotuj ikonÄ™
                    progress: createPartTypeProgress('ux-blade')
                },

                mistrz_lock_chip: {
                    title: "Mistrz Lock ChipÃ³w",
                    description: "Zbierz wszystkie czÄ™Å›ci typu CX Lock Chip.",
                    icon: 'img/PucharCX.png', // Przygotuj ikonÄ™
                    progress: createPartTypeProgress('cx-lock-chip')
                },

                mistrz_main_blade: {
                    title: "Mistrz GÅ‚Ã³wnych Ostrzy",
                    description: "Zbierz wszystkie czÄ™Å›ci typu CX Main Blade.",
                    icon: 'img/PucharCX.png', // Przygotuj ikonÄ™
                    progress: createPartTypeProgress('cx-main-blade')
                },

                mistrz_assist_blade: {
                    title: "Mistrz Ostrzy Assist",
                    description: "Zbierz wszystkie czÄ™Å›ci typu CX Assist Blade.",
                    icon: 'img/PucharCX.png', // Przygotuj ikonÄ™
                    progress: createPartTypeProgress('cx-assist-blade')
                },

                mistrz_ratchet: {
                    title: "Mistrz RatchetÃ³w",
                    description: "Zbierz wszystkie czÄ™Å›ci typu Ratchet.",
                    icon: 'img/PucharDiament.png', // Przygotuj ikonÄ™
                    progress: createPartTypeProgress('rachet')
                },

                mistrz_bit: {
                    title: "Mistrz BitÃ³w",
                    description: "Zbierz wszystkie czÄ™Å›ci typu Bit.",
                    icon: 'img/PucharDiament.png', // Przygotuj ikonÄ™
                    progress: createPartTypeProgress('bit')
                },


                mistrz_ataku: { title: "Mistrz Ataku", description: "Zbierz wszystkie Bity typu Atak.", icon: 'img/PucharATK.png', progress: createPartTypeProgress('bit', 'atak') },
                mistrz_obrony: { title: "Mistrz Obrony", description: "Zbierz wszystkie Bity typu Obrona.", icon: 'img/PucharDEF.png', progress: createPartTypeProgress('bit', 'obrona') },
                mistrz_staminy: { title: "Mistrz Staminy", description: "Zbierz wszystkie Bity typu WytrzymaÅ‚oÅ›Ä‡.", icon: 'img/PucharSTM.png', progress: createPartTypeProgress('bit', 'wytrzymalosc') },
                mistrz_balansu: { title: "Mistrz Balansu", description: "Zbierz wszystkie Bity typu Balans.", icon: 'img/PucharBAL.png', progress: createPartTypeProgress('bit', 'balans') },
                mistrz_lewego_raila: {
                    title: "Mistrz Lewego Raila", description: "Posiadaj wszystkie lewoskrÄ™tne Blade'y.", icon: 'img/PucharLewo.png',
                    progress: () => {
                        const lewoskretne = getMagazyn().filter(p => p.kierunek === 'lewy');
                        if (lewoskretne.length === 0) return { current: 0, max: 1 };
                        const posiadane = lewoskretne.filter(p => p.ilosc > 0).length;
                        return { current: posiadane, max: lewoskretne.length };
                    }
                },

                // --- OsiÄ…gniÄ™cia Synergii i Ukryte ---
                sentymenalna_podroz: {
                    title: "Sentymentalna PodrÃ³Å¼", description: "Zbuduj i zapisz zestaw z czÄ™Å›ciÄ… z klasycznej serii.", icon: 'img/osiagniecie.png',
                    progress: () => {
                        const klasyki = ['DragoonStorm', 'DranzerSpiral', 'DrigerSlash', 'DracielShield', 'StormPegasis', 'Rock Leone', 'Lightning L-Drago (Upper Type)', 'Lightning L-Drago (Rapid-Hit Type)', 'VictoryValkyrie', 'XenoXcalibur'];
                        const magazyn = getMagazyn();
                        const nazwyCzesci = (set) => [set.bladeId, set.ratchetId, set.bitId].filter(Boolean).map(id => magazyn.find(p => p.id === id)?.nazwa).filter(Boolean);
                        const isAchieved = getSavedDecks().some(deck => deck.sets.some(set => nazwyCzesci(set).some(czesc => klasyki.includes(czesc))));
                        return { current: isAchieved ? 1 : 0, max: 1 };
                    }
                },
                czy_to_legalne: {
                    title: "Czy to jest legalne?", description: "PrÃ³bowaÅ‚eÅ› uÅ¼yÄ‡ legendarnej, zakazanej czÄ™Å›ci...", icon: 'img/PucharEnigma.png',
                    progress: () => {
                        const trypioId = getMagazyn().find(p => p.nazwa === 'Trypio')?.id;
                        if (!trypioId) return { current: 0, max: 1 };
                        const isAchieved = getSavedDecks().some(deck => deck.sets.some(set => set.bladeId === trypioId || set.ratchetId === trypioId || set.bitId === trypioId));
                        return { current: isAchieved ? 1 : 0, max: 1 };
                    }
                },
                tecza_mocy: {
                    title: "TÄ™cza Mocy", description: "Zapisz deck, w ktÃ³rym jest kaÅ¼dy typ.", icon: 'img/osiagniecie.png',
                    progress: () => {
                        const magazyn = getMagazyn();
                        const getSetType = (set) => {
                            if (!set) return null;
                            const ratchet = set.ratchetId ? magazyn.find(p => p.id === set.ratchetId) : null;
                            const bit = set.bitId ? magazyn.find(p => p.id === set.bitId) : null;
                            return ((ratchet && ratchet.integrujeBit) ? ratchet : bit)?.rodzaj || null;
                        };
                        const isAchieved = getSavedDecks().some(deck => {
                            if (deck.sets.length < 4) return false;
                            const typy = new Set(deck.sets.slice(0, 4).map(getSetType).filter(Boolean));
                            return typy.size === 4 && typy.has('atak') && typy.has('obrona') && typy.has('wytrzymalosc') && typy.has('balans');
                        });
                        return { current: isAchieved ? 1 : 0, max: 1 };
                    },
                },
                };

                // --- OsiÄ…gniÄ™cia "Mistrzowskie" (zaleÅ¼ne od innych) ---


            // --- GÅ‚Ã³wne funkcje zarzÄ…dzajÄ…ce, dostosowane do nowej struktury ---

            function unlockAchievement(id) {
                const unlocked = getUnlockedAchievements();
                if (!unlocked[id]) {
                    unlocked[id] = { unlockedAt: Date.now() };
                    localStorage.setItem(ACHIEVEMENTS_KEY, JSON.stringify(unlocked));
                    if (allAchievements[id]) {
                        showNotification(`OsiÄ…gniÄ™cie odblokowane: ${allAchievements[id].title}!`, 4000, 'success');
                    }
                }
            }

            function checkAllAchievements() {
                console.log("Sprawdzanie, czy odblokowano NOWE osiÄ…gniÄ™cia...");
                const unlocked = getUnlockedAchievements();
                for (const id in allAchievements) {
                    if (!allAchievements[id].progress) continue;
                    const postep = allAchievements[id].progress();
                    if (!unlocked[id] && postep.current >= postep.max) {
                        unlockAchievement(id);
                    }
                }
            }

            function displayAchievements() {
                const container = document.getElementById('achievementsContainer');
                if (!container) return;
                container.innerHTML = '';

                const achievementIds = Object.keys(allAchievements);

                // Sortowanie (pozostaje bez zmian)
                achievementIds.sort((a, b) => {
                    const progressA = allAchievements[a].progress ? allAchievements[a].progress() : { current: 0, max: 1 };
                    const progressB = allAchievements[b].progress ? allAchievements[b].progress() : { current: 0, max: 1 };
                    const isAUnlocked = progressA.current >= progressA.max;
                    const isBUnlocked = progressB.current >= progressB.max;

                    if (isAUnlocked && !isBUnlocked) return -1;
                    if (!isAUnlocked && isBUnlocked) return 1;

                    const percentA = progressA.max > 0 ? progressA.current / progressA.max : 0;
                    const percentB = progressB.max > 0 ? progressB.current / progressB.max : 0;
                    return percentB - percentA;
                });

                achievementIds.forEach(id => {
                    const achievement = allAchievements[id];
                    if (!achievement.progress) return;

                    const postep = achievement.progress();
                    const isUnlocked = postep.current >= postep.max;
                    const percentage = postep.max > 0 ? Math.min(Math.floor((postep.current / postep.max) * 100), 100) : 0;

                    const card = document.createElement('div');
                    card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;

                    // Przenosimy logikÄ™ paska postÄ™pu tutaj, aby umieÅ›ciÄ‡ go wewnÄ…trz .achievement-info
                    const progressBarHTML = isUnlocked ? '' : `
                        <div class="achievement-progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%;"></div>
                            <div class="progress-text">${postep.current} / ${postep.max}</div>
                        </div>
                    `;

                    // === KLUCZOWA ZMIANA: Nowa struktura HTML z paskiem postÄ™pu pod opisem ===
                    card.innerHTML = `
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-card-content">
                            <img src="${achievement.icon}" class="achievement-icon" alt="${achievement.title}">
                            <div class="achievement-info">
                                <p class="achievement-description">${achievement.description}</p>
                                ${progressBarHTML}
                            </div>
                        </div>
                    `;
                    // === KONIEC ZMIANY STRUKTURY ===

                    container.appendChild(card);

                    // Logika odblokowywania (bez zmian)
                    if (isUnlocked) {
                        const unlocked = getUnlockedAchievements();
                        if (!unlocked[id]) {
                             unlockAchievement(id);
                        }
                    }
                });
            }

            // =================================
            // Logika Licznika PunktÃ³w
            // =================================
            let scores = { player1: 0, player2: 0 };
            let playerNames = { player1: "Gracz 1", player2: "Gracz 2" };
            /* ===>>> FUNKCJA JS DO WKLEJENIA W SEKCJI <script> <<<=== */

            function zmienLauncher(typ, kierunek) {
                // Definiujemy elementy, ktÃ³re bÄ™dziemy zmieniaÄ‡
                const imgElement = document.getElementById(`${typ}-launcher-img`);
                const titleElement = document.getElementById(`${typ}-launcher-title`);
                const lButton = document.getElementById(`${typ}-l-btn`);
                const rButton = document.getElementById(`${typ}-r-btn`);

                if (!imgElement || !titleElement || !lButton || !rButton) {
                    console.error(`BÅ‚Ä…d: Nie znaleziono elementÃ³w dla typu launchera: ${typ}`);
                    return;
                }

                // Aktualizujemy przyciski
                lButton.classList.remove('active');
                rButton.classList.remove('active');

                // Ustalamy Å›cieÅ¼kÄ™ do obrazka i nowy tytuÅ‚
                if (kierunek === 'l') {
                    imgElement.src = `img/${typ}l.png`; // np. 'img//winderl_launcher.png'
                    titleElement.textContent = `${typ.charAt(0).toUpperCase() + typ.slice(1)} Launcher (LewoskrÄ™tny)`;
                    lButton.classList.add('active');
                } else { // DomyÅ›lnie prawoskrÄ™tny
                    imgElement.src = `img/${typ}.png`; // np. 'img/poradnik/winder_launcher.png'
                    titleElement.textContent = `${typ.charAt(0).toUpperCase() + typ.slice(1)} Launcher (PrawoskrÄ™tny)`;
                    rButton.classList.add('active');
                }
            }

            function displayScores() {
                const scoreP1 = document.getElementById('scorePlayer1');
                const scoreP2 = document.getElementById('scorePlayer2');
                if (scoreP1) scoreP1.textContent = scores.player1;
                if (scoreP2) scoreP2.textContent = scores.player2;
            }
            function displayPlayerNames() {
                const nameP1Display = document.getElementById('playerName1');
                const nameP2Display = document.getElementById('playerName2');
                const nameP1Input = document.getElementById('inputPlayerName1');
                const nameP2Input = document.getElementById('inputPlayerName2');
                if (nameP1Display) nameP1Display.textContent = playerNames.player1;
                if (nameP2Display) nameP2Display.textContent = playerNames.player2;
                if (nameP1Input) nameP1Input.value = playerNames.player1 === "Gracz 1" ? "" : playerNames.player1;
                if (nameP2Input) nameP2Input.value = playerNames.player2 === "Gracz 2" ? "" : playerNames.player2;
            }
            let backgroundResetTimeouts = { player1: null, player2: null };
            const finishBackgroundClasses = ['has-background-spin_finish', 'has-background-over_finish', 'has-background-burst_finish', 'has-background-xtreme_finish']; // Pomocnicza tablica klas

            function updateScore(player, points, finishType = null) {
                console.log("updateScore called for:", player, "points:", points, "finishType:", finishType);

                if (!scores || !scores.hasOwnProperty(player)) {
                    console.error("BÅ‚Ä…d: Obiekt 'scores' lub wÅ‚aÅ›ciwoÅ›Ä‡ dla gracza nie istnieje.", player);
                    return;
                }

                scores[player] += points;
                if (typeof displayScores === 'function') displayScores();
                if (typeof saveScoresToLocalStorage === 'function') saveScoresToLocalStorage();

                const overlayElement = document.getElementById('fullscreenFinishOverlay');
                const imageElement = document.getElementById('fullscreenFinishImage');

                if (overlayElement && imageElement) {
                    // WyczyÅ›Ä‡ poprzedni timeout ukrywania nakÅ‚adki, jeÅ›li istnieje
                    if (fullscreenOverlayHideTimeout) {
                        clearTimeout(fullscreenOverlayHideTimeout);
                        fullscreenOverlayHideTimeout = null;
                    }

                    if (finishType && points > 0) {
                        const imagePath = `img/${finishType}.png`;
                        console.log("Setting fullscreen image path to:", imagePath);
                        imageElement.src = imagePath;
                        imageElement.alt = finishType.replace('_', ' ') + " Finish";

                        overlayElement.classList.add('visible'); // PokaÅ¼ nakÅ‚adkÄ™ z przejÅ›ciem

                        // Timeout do ukrycia nakÅ‚adki
                        fullscreenOverlayHideTimeout = setTimeout(() => {
                            console.log("Timeout: Hiding fullscreen overlay");
                            overlayElement.classList.remove('visible');
                            // MoÅ¼na dodaÄ‡ opÃ³Åºnienie na wyczyszczenie src, aby uniknÄ…Ä‡ "migniÄ™cia"
                            setTimeout(() => {
                                if (!overlayElement.classList.contains('visible')) { // SprawdÅº, czy nadal jest ukryta
                                    imageElement.src = '#';
                                }
                            }, 300); // Czas trwania przejÅ›cia opacity
                            fullscreenOverlayHideTimeout = null;
                        }, 1000); // NakÅ‚adka zniknie po 2.8 sekundach (dostosuj)

                    } else {
                        // JeÅ›li punkty sÄ… odejmowane lub brak finishType, upewnij siÄ™, Å¼e nakÅ‚adka jest ukryta
                        // (chociaÅ¼ normalnie powinna byÄ‡ juÅ¼ ukryta po timeout'cie)
                        if (overlayElement.classList.contains('visible')) {
                             overlayElement.classList.remove('visible');
                             setTimeout(() => { imageElement.src = '#'; }, 300);
                        }
                    }
                } else {
                    console.warn(`Nie znaleziono elementu nakÅ‚adki (#fullscreenFinishOverlay) lub obrazka (#fullscreenFinishImage)`);
                }
            }

            function resetScoresAndImages() {
                scores.player1 = 0;
                scores.player2 = 0;
                if (typeof displayScores === 'function') displayScores();
                if (typeof saveScoresToLocalStorage === 'function') saveScoresToLocalStorage();

                const overlayElement = document.getElementById('fullscreenFinishOverlay');
                const imageElement = document.getElementById('fullscreenFinishImage');

                if (overlayElement && imageElement) {
                    if (overlayElement.classList.contains('visible')) {
                        overlayElement.classList.remove('visible');
                        setTimeout(() => { imageElement.src = '#'; }, 300); // Dopasuj do czasu przejÅ›cia opacity
                    }
                }

                if (fullscreenOverlayHideTimeout) {
                    clearTimeout(fullscreenOverlayHideTimeout);
                    fullscreenOverlayHideTimeout = null;
                }

                if (typeof showNotification === 'function') {
                    showNotification("Wyniki zostaÅ‚y zresetowane.", 2000, 'info');
                }
            }


            function updatePlayerName(player) {
                const inputElement = document.getElementById(`inputPlayerName${player === 'player1' ? '1' : '2'}`);
                if (inputElement && playerNames.hasOwnProperty(player)) {
                    const newName = inputElement.value.trim();
                    playerNames[player] = newName !== '' ? newName : (player === 'player1' ? "Gracz 1" : "Gracz 2");
                    displayPlayerNames();
                    saveScoresToLocalStorage();
                }
            }


            function saveScoresToLocalStorage() {
                try {
                    localStorage.setItem(SCORES_KEY, JSON.stringify({ scores, playerNames }));
                } catch (e) { console.error("BÅ‚Ä…d zapisu wynikÃ³w do localStorage:", e); }
            }
            function loadScoresFromLocalStorage() {
                try {
                    const savedDataString = localStorage.getItem(SCORES_KEY);
                    if (savedDataString) {
                        const savedData = JSON.parse(savedDataString);
                        if (savedData.scores) scores = savedData.scores;
                        if (savedData.playerNames) playerNames = savedData.playerNames;
                        scores.player1 = parseInt(scores.player1, 10) || 0;
                        scores.player2 = parseInt(scores.player2, 10) || 0;
                        playerNames.player1 = playerNames.player1 || "Gracz 1";
                        playerNames.player2 = playerNames.player2 || "Gracz 2";
                    }
                } catch (e) {
                    console.error("BÅ‚Ä…d odczytu wynikÃ³w z localStorage:", e);
                    scores = { player1: 0, player2: 0 };
                    playerNames = { player1: "Gracz 1", player2: "Gracz 2" };
                }
                displayScores(); displayPlayerNames();
            }
            // =================================
            // Funkcje Pomocnicze i Nawigacyjne
            // =================================
            function showNotification(message, duration = 3000, type = 'info') {
                const bar = document.getElementById("notification-bar");
                if (!bar) { console.error("Element #notification-bar nie znaleziony!"); return; }
                bar.textContent = message;
                bar.className = 'notification-show';
                let bgColor = 'rgba(138, 43, 226, 0.9)'; let textColor = '#fff';
                if (type === 'error') bgColor = 'rgba(220, 53, 69, 0.9)';
                else if (type === 'success') bgColor = 'rgba(40, 167, 69, 0.9)';
                else if (type === 'warning') { bgColor = 'rgba(255, 193, 7, 0.9)'; textColor = '#333'; }
                bar.style.backgroundColor = bgColor; bar.style.color = textColor;
                bar.style.backdropFilter = 'blur(5px)'; bar.style.webkitBackdropFilter = 'blur(5px)';
                bar.style.display = "block"; bar.style.opacity = "1";
                if (bar._hideTimeout) clearTimeout(bar._hideTimeout);
                bar._hideTimeout = setTimeout(() => {
                    bar.style.opacity = "0";
                    setTimeout(() => { bar.style.display = "none"; }, 300);
                }, duration);
            }

            function toggleSidebar() {
                sidebarExpanded = !sidebarExpanded;
                if (sidebar) sidebar.classList.toggle('expanded', sidebarExpanded);
                if (appContainer) appContainer.style.marginLeft = (sidebarExpanded ? sidebarWidthExpanded : sidebarWidthCollapsed) + 'px';
                if (menuIcon && menuBtnText) {
                    if (sidebarExpanded) {
                        menuIcon.src = 'menu2.png'; menuIcon.alt = "Zamknij"; menuBtnText.textContent = 'ZAMKNIJ MENU';
                        if(sidebarToggleBtn) sidebarToggleBtn.title = "ZwiÅ„ menu";
                    } else {
                        menuIcon.src = 'menu.png'; menuIcon.alt = "Menu"; menuBtnText.textContent = 'MENU';
                        if(sidebarToggleBtn) sidebarToggleBtn.title = "RozwiÅ„ menu";
                    }
                }
            }

            function navigateTo(pageId, clickedLinkElement) {
                console.log(`Nawigacja do: ${pageId}`);
                document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active-link'));
                if (clickedLinkElement) clickedLinkElement.classList.add('active-link');
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                const page = document.getElementById(pageId);
                if (page) {
                    page.classList.add('active');
                } else {
                    console.error(`Strona ID '${pageId}' nie znaleziona.`);
                    const fallbackLink = document.querySelector('.sidebar a[onclick*="navigateTo(\'generator"]');
                    if (fallbackLink && pageId !== 'generator') {
                        navigateTo('generator', fallbackLink);
                    }
                    return;
                }

                if (pageId !== 'deck' && currentEditingDeckId) {
                    const deckNameInput = document.getElementById('deckName');
                    if (deckNameInput) deckNameInput.value = '';
                    currentEditingDeckId = null;
                    const saveBtn = document.getElementById('saveDeckButton');
                    if (saveBtn) saveBtn.textContent = 'Zapisz Aktualny Deck';
                    console.log("Zresetowano stan edycji decku po opuszczeniu strony 'deck'.");
                }

                // ==================================================
                // === TUTAJ ZNAJDUJE SIÄ˜ CAÅA LOGIKA WYWOÅAÅƒ FUNKCJI ===
                // ==================================================

                if (pageId === 'magazyn') {
                    wyswietlMagazyn();
            } else if (pageId === 'poradnik') { // <<<--- NOWY BLOK
                wygenerujListeBitowPoradnik();
                // Upewnij siÄ™, Å¼e domyÅ›lna zakÅ‚adka jest pokazywana poprawnie
                pokazZakladkePoradnika('bity', document.querySelector('#poradnik-tabs .tab-button'));
            } else if (pageId === 'deck') {
                    if (!currentEditingDeckId) {
                         initializeOrResetCurrentDeck();
                    }
                    renderDeckBuilderAndParts();
                } else if (pageId === 'galeriaDeckow') {
                    displaySavedDecks();
                } else if (pageId === 'osiagniecia') { // <-- TO JEST NOWY, POPRAWNIE WSTAWIONY FRAGMENT
                    displayAchievements();
                } else if (pageId === 'licznikPunktow') {
                    loadScoresFromLocalStorage();
      
                if (sidebarExpanded && window.innerWidth < 768) {
                    toggleSidebar();
                }
            }

            // =================================
            // WyÅ›wietlanie Magazynu
            // =================================
            function wyswietlMagazyn() {
                const magazynPelny = getMagazyn();
                const lista = document.getElementById('lista-magazyn');
                if (!lista) { console.error("Element #lista-magazyn nie istnieje."); return; }
                lista.innerHTML = '';

                if (!Array.isArray(magazynPelny)) {
                    lista.innerHTML = '<div class="card" style="grid-column: 1 / -1; text-align:center;"><p>BÅ‚Ä…d wczytywania.</p></div>';
                    return;
                }

                // Pobieramy wartoÅ›ci z WSZYSTKICH trzech filtrÃ³w
                const filtrKategorii = document.getElementById('filterKategoria')?.value || 'all';
                const filtrPosiadania = document.getElementById('filterPosiadane')?.value || 'posiadane';

                // === NOWY KOD: Pobranie wartoÅ›ci z pola wyszukiwania ===
                const frazaWyszukiwania = (document.getElementById('searchMagazynByName')?.value || '').trim().toLowerCase();
                // ========================================================

                let czesciDoWyswietlenia = [...magazynPelny];

                // 1. Filtr posiadania (bez zmian)
                if (filtrPosiadania === 'posiadane') {
                    czesciDoWyswietlenia = czesciDoWyswietlenia.filter(c => c && (parseInt(c.ilosc, 10) || 0) > 0);
                } else if (filtrPosiadania === 'nieposiadane') {
                    czesciDoWyswietlenia = czesciDoWyswietlenia.filter(c => c && (parseInt(c.ilosc, 10) || 0) === 0);
                }

                // 2. Filtr kategorii (bez zmian)
                if (filtrKategorii !== 'all' && filtrKategorii) {
                    czesciDoWyswietlenia = czesciDoWyswietlenia.filter(c => c && c.typ === filtrKategorii);
                }

                // === NOWY KOD: Filtrowanie po nazwie ===
                if (frazaWyszukiwania) {
                    czesciDoWyswietlenia = czesciDoWyswietlenia.filter(c =>
                        c && c.nazwa && c.nazwa.toLowerCase().includes(frazaWyszukiwania)
                    );
                }
                // =======================================

                // Reszta funkcji pozostaje taka sama
                if (czesciDoWyswietlenia.length === 0) {
                    lista.innerHTML = '<div class="card" style="grid-column: 1 / -1; text-align:center;"><p>Brak czÄ™Å›ci pasujÄ…cych do filtrÃ³w.</p></div>';
                    return;
                }

                // Sortowanie (bez zmian)
                czesciDoWyswietlenia.sort((a, b) => {
                    const typA = (a?.typ || "").toLowerCase(); const typB = (b?.typ || "").toLowerCase();
                    const nazwaA = (a?.nazwa || "").toLowerCase(); const nazwaB = (b?.nazwa || "").toLowerCase();
                    if (typA < typB) return -1; if (typA > typB) return 1;
                    if (nazwaA < nazwaB) return -1; if (nazwaA > nazwaB) return 1;
                    return 0;
                });

                // PÄ™tla renderujÄ…ca karty (bez zmian, jest w porzÄ…dku)
                czesciDoWyswietlenia.forEach((czesc) => {
                    if (!czesc || !czesc.typ || typeof czesc.nazwa !== 'string') return;
                    const ilosc = parseInt(czesc.ilosc, 10) || 0;

                    let statyString = '';
                    let isBeta = false;


                // ===>>> OSTATECZNA POPRAWKA: INTERAKTYWNY PRZYCISK W MAGAZYNIE <<<===
                let infoHTML = '';
                const aktywnyIndex = czesc.aktywnyTrybIndex || 0;
                const aktywnyTryb = (czesc.maTryby && Array.isArray(czesc.tryby)) ? czesc.tryby[aktywnyIndex] : null;

                if (czesc.maTryby && czesc.tryby && czesc.tryby.length > 1) {
                    const nazwaTrybu = aktywnyTryb?.nazwaTrybu || 'BÅ‚Ä…d Trybu';
                    infoHTML = `
                        <div style="margin-top: 10px;">
                            <button
                                class="mode-switch-btn"
                                onclick="przelaczTrybMagazynu('${czesc.id}')"
                                title="ZmieÅ„ aktywny tryb dla tej czÄ™Å›ci. Aktualny: ${nazwaTrybu}">
                                ZmieÅ„ Tryb ðŸ”„
                            </button>
                        </div>
                    `;
                }
                // ===>>> KONIEC OSTATECZNEJ POPRAWKI <<<===

                // ===>>> KONIEC NOWEJ LOGIKI <<<===

                    const obrazekDoWyswietlenia = aktywnyTryb?.img || czesc.img;
                    const nazwaDoWyswietlenia = aktywnyTryb ? `${czesc.nazwa} <span style="color:#a25ff0;">(${aktywnyTryb.nazwaTrybu})</span>` : czesc.nazwa;

                    const daneStatystyk = aktywnyTryb || czesc;
                    const maStat = (statName) => typeof daneStatystyk[statName] === 'number';
                    const jestZeroLubBrak = (statName) => !maStat(statName) || daneStatystyk[statName] === 0;

                    if (czesc.typ === 'blade' || czesc.typ === 'ux-blade' || czesc.typ === 'rachet' || czesc.typ === 'cx-main-blade' || czesc.typ === 'cx-assist-blade') {
                        if (jestZeroLubBrak('ATK') || jestZeroLubBrak('DEF') || jestZeroLubBrak('STM') || jestZeroLubBrak('waga')) isBeta = true;
                        statyString = `ATK:${maStat('ATK') ? daneStatystyk.ATK : 'N/A'}, DEF:${maStat('DEF') ? daneStatystyk.DEF : 'N/A'}, STM:${maStat('STM') ? daneStatystyk.STM : 'N/A'}, Waga:${maStat('waga') ? daneStatystyk.waga : 'N/A'}g`;
                    } else if (czesc.typ === 'bit') {
                        if (jestZeroLubBrak('ATK') || jestZeroLubBrak('DEF') || jestZeroLubBrak('STM') || jestZeroLubBrak('waga') || jestZeroLubBrak('DASH') || jestZeroLubBrak('BURST_RES')) isBeta = true;
                        statyString = `ATK:${maStat('ATK') ? daneStatystyk.ATK : 'N/A'}, DEF:${maStat('DEF') ? daneStatystyk.DEF : 'N/A'}, STM:${maStat('STM') ? daneStatystyk.STM : 'N/A'}, Waga:${maStat('waga') ? daneStatystyk.waga : 'N/A'}g, DASH:${maStat('DASH') ? daneStatystyk.DASH : 'N/A'}, B-RES:${maStat('BURST_RES') ? daneStatystyk.BURST_RES : 'N/A'}`;
                    } else if (czesc.typ === 'cx-lock-chip') {
                        if (jestZeroLubBrak('waga')) isBeta = true;
                        statyString = `Waga:${maStat('waga') ? daneStatystyk.waga : 'N/A'}g`;
                        if (maStat('cx_lc_wytrz')) statyString += `, Wytrz:${daneStatystyk.cx_lc_wytrz}`;
                        if (maStat('cx_lc_atk_bonus')) statyString += `, ATK+:${daneStatystyk.cx_lc_atk_bonus}`;
                        if (maStat('cx_lc_def_bonus')) statyString += `, DEF+:${daneStatystyk.cx_lc_def_bonus}`;
                    }
                    statyString = `<p style="font-size:0.85em; line-height:1.4;">${statyString}</p>`;

                    const imgHTML = obrazekDoWyswietlenia ? `<img class="part-img" src="${obrazekDoWyswietlenia}" alt="${czesc.nazwa}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"><div class="part-img-placeholder" style="display:none;">Brak<br>obr.</div>` : `<div class="part-img-placeholder">Brak<br>obr.</div>`;
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    if (ilosc === 0) cardDiv.classList.add('part-not-owned');
                    if (isBeta) cardDiv.classList.add('part-beta-item');
                    const typNazwaFormatowana = czesc.typ.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                  let quantityControlsHTML = '';
            // Sprawdzamy, czy tryb edycji hurtowej jest aktywny
            if (isBulkEditMode) {
                quantityControlsHTML = `
                    <div class="item-quantity-controls" style="flex-direction: column; gap: 8px;">
                        <label for="qty-input-${czesc.id}" style="font-size: 0.8em; margin-bottom: 0;">IloÅ›Ä‡:</label>
                        <input
                            type="number"
                            id="qty-input-${czesc.id}"
                            class="bulk-quantity-input"
                            style="width: 80px; padding: 8px; text-align: center; margin: 0;"
                            value="${ilosc}"
                            min="0"
                            onchange="ustawIloscCzesci('${czesc.id}', this.value)"
                            onfocus="this.select()"
                        >
                    </div>`;
            } else {
                // JeÅ›li tryb jest wyÅ‚Ä…czony, pokazujemy stare przyciski +/-
                quantityControlsHTML = `
                    <div class="item-quantity-controls">
                        <button class="quantity-btn" onclick="zmienIloscCzesci('${czesc.id}', -1)" title="Zmniejsz iloÅ›Ä‡ ${czesc.nazwa}" ${ilosc === 0 ? 'disabled' : ''}>-</button>
                        <span class="quantity-display" title="Aktualna iloÅ›Ä‡: ${ilosc}">${ilosc}</span>
                        <button class="quantity-btn" onclick="zmienIloscCzesci('${czesc.id}', 1)" title="ZwiÄ™ksz iloÅ›Ä‡ ${czesc.nazwa}">+</button>
                    </div>`;
            }


                    cardDiv.innerHTML = `${imgHTML}<h3>${nazwaDoWyswietlenia}${isBeta ? '<span class="beta-label"> BETA</span>' : ''}</h3><p style="font-size:0.8em; color:#bbb; margin-top:-10px; margin-bottom:8px;"><em>${typNazwaFormatowana}</em></p>${statyString}${infoHTML}${quantityControlsHTML}`;

                    lista.appendChild(cardDiv);
                });
            }

            function zmienIloscCzesci(idCzesci, zmiana) {
                const magazyn = getMagazyn();
                const indexCzesci = magazyn.findIndex(c => c && c.id === idCzesci);
                if (indexCzesci === -1) { showNotification("BÅ‚Ä…d: Nie znaleziono czÄ™Å›ci.", 3000, 'error'); return; }
                const czesc = magazyn[indexCzesci];
                let nowaIlosc = (parseInt(czesc.ilosc, 10) || 0) + zmiana;
                if (nowaIlosc < 0) nowaIlosc = 0;
                if (czesc.ilosc === nowaIlosc && zmiana !== 0) return;
                czesc.ilosc = nowaIlosc;
                magazyn[indexCzesci] = czesc;
                setMagazyn(magazyn);
                const aktywnaStronaId = document.querySelector('.page.active')?.id;
                if (aktywnaStronaId === 'magazyn') wyswietlMagazyn();
                if (aktywnaStronaId === 'deck') renderAvailablePartsList();
                 checkAllAchievements();
            }
            function toggleBulkEditMode() {
                isBulkEditMode = !isBulkEditMode; // ZmieÅ„ stan
                const btn = document.getElementById('toggleBulkEditBtn');

                if (isBulkEditMode) {
                    btn.textContent = 'WyÅ‚Ä…cz Tryb Edycji Hurtowej';
                    btn.style.backgroundColor = 'rgba(190, 50, 50, 0.7)'; // Czerwony kolor, by wskazaÄ‡ aktywny tryb
                } else {
                    btn.textContent = 'WÅ‚Ä…cz Tryb Edycji Hurtowej';
                    btn.style.backgroundColor = ''; // WrÃ³Ä‡ do domyÅ›lnego stylu
                }

                // Prerenderuj magazyn, aby pokazaÄ‡ odpowiednie kontrolki
                wyswietlMagazyn();
            }

            // Nowa funkcja do ustawiania konkretnej iloÅ›ci z pola input
            function ustawIloscCzesci(idCzesci, nowaWartosc) {
                const magazyn = getMagazyn();
                const indexCzesci = magazyn.findIndex(c => c && c.id === idCzesci);
                if (indexCzesci === -1) { return; }

                let nowaIlosc = parseInt(nowaWartosc, 10);

                // Walidacja - upewnij siÄ™, Å¼e iloÅ›Ä‡ nie jest ujemna lub nie jest liczbÄ…
                if (isNaN(nowaIlosc) || nowaIlosc < 0) {
                    nowaIlosc = 0;
                    // Opcjonalnie: zaktualizuj pole input, jeÅ›li uÅ¼ytkownik wpisaÅ‚ coÅ› nieprawidÅ‚owego
                    const inputElement = document.getElementById(`qty-input-${idCzesci}`);
                    if (inputElement) inputElement.value = nowaIlosc;
                }

                const czesc = magazyn[indexCzesci];
                if (czesc.ilosc === nowaIlosc) return; // Nic siÄ™ nie zmieniÅ‚o, nie rÃ³b nic

                czesc.ilosc = nowaIlosc;
                setMagazyn(magazyn);
                checkAllAchievements(); // SprawdÅº osiÄ…gniÄ™cia po zmianie

                // Nie ma potrzeby odÅ›wieÅ¼ania caÅ‚ego magazynu, zmiana jest juÅ¼ widoczna
                // JeÅ›li jednak chcesz, Å¼eby np. sortowanie siÄ™ zaktualizowaÅ‚o, moÅ¼esz odkomentowaÄ‡ poniÅ¼szÄ… liniÄ™:
                // wyswietlMagazyn();
            }

            function addAllPartsByOne() {


                const magazyn = getMagazyn();
                let iloscZmienionychCzesci = 0;

                // PrzejdÅº przez kaÅ¼dÄ… czÄ™Å›Ä‡ w magazynie i zwiÄ™ksz jej iloÅ›Ä‡
                magazyn.forEach(czesc => {
                    if (czesc) { // Upewnij siÄ™, Å¼e obiekt czÄ™Å›ci istnieje
                        czesc.ilosc = (parseInt(czesc.ilosc, 10) || 0) + 1;
                        iloscZmienionychCzesci++;
                    }
                });

                setMagazyn(magazyn); // Zapisz zaktualizowany magazyn
                checkAllAchievements(); // SprawdÅº osiÄ…gniÄ™cia po masowej zmianie

                showNotification(`ZwiÄ™kszono iloÅ›Ä‡ dla ${iloscZmienionychCzesci} czÄ™Å›ci o 1.`, 3000, 'success');

                // OdÅ›wieÅ¼ widok magazynu, aby pokazaÄ‡ nowe iloÅ›ci
                wyswietlMagazyn();
            }
            function subtractAllPartsByOne() {


                const magazyn = getMagazyn();
                let iloscZmienionychCzesci = 0;

                // Przechodzimy przez kaÅ¼dÄ… czÄ™Å›Ä‡ i modyfikujemy jej iloÅ›Ä‡.
                magazyn.forEach(czesc => {
                    if (czesc) { // Upewnij siÄ™, Å¼e obiekt czÄ™Å›ci istnieje
                        let obecnaIlosc = parseInt(czesc.ilosc, 10) || 0;

                        // Odejmujemy 1, tylko jeÅ›li iloÅ›Ä‡ jest wiÄ™ksza od 0.
                        if (obecnaIlosc > 0) {
                            czesc.ilosc = obecnaIlosc - 1;
                            iloscZmienionychCzesci++;
                        }
                    }
                });

                // JeÅ›li nic siÄ™ nie zmieniÅ‚o (np. wszystkie czÄ™Å›ci miaÅ‚y 0), nie robimy nic wiÄ™cej.
                if (iloscZmienionychCzesci === 0) {
                    showNotification("Å»adna czÄ™Å›Ä‡ nie zostaÅ‚a zmodyfikowana (wszystkie miaÅ‚y iloÅ›Ä‡ 0).", 3000, 'info');
                    return;
                }

                setMagazyn(magazyn); // Zapisz zaktualizowany magazyn
                checkAllAchievements(); // SprawdÅº osiÄ…gniÄ™cia

                showNotification(`Zmniejszono iloÅ›Ä‡ dla ${iloscZmienionychCzesci} czÄ™Å›ci o 1.`, 3000, 'success');

                // OdÅ›wieÅ¼ widok magazynu, aby pokazaÄ‡ nowe iloÅ›ci
                wyswietlMagazyn();
            }

            // =================================
            // Obliczanie Statystyk Zestawu
            // =================================
            function obliczSumeStatystykZestawu(czesciZestawu, seria) { // czesciZestawu to obiekt z czÄ™Å›ciami, np. {blade: objBlade, rachet: objRatchet, ...}
                const suma = { ATK: 0, DEF: 0, STM: 0, WAGA: 0, DASH: 0, B_RES: 0, CX_LC_WYTRZ: 0 };
                const getStat = (czesc, statName, defaultValue = 0) => {
                    if (!czesc || typeof czesc[statName] === 'undefined' || czesc[statName] === null) return defaultValue;
                    const val = parseFloat(czesc[statName]);
                    return isNaN(val) ? defaultValue : val;
                };

                if (seria === 'bx_ux') {
                    const { blade, rachet, bit } = czesciZestawu;
                    if (blade) { suma.ATK += getStat(blade, 'ATK'); suma.DEF += getStat(blade, 'DEF'); suma.STM += getStat(blade, 'STM'); suma.WAGA += getStat(blade, 'waga'); }
                    if (rachet) {
                        suma.ATK += getStat(rachet, 'ATK'); suma.DEF += getStat(rachet, 'DEF'); suma.STM += getStat(rachet, 'STM'); suma.WAGA += getStat(rachet, 'waga');
                        if (String(rachet.id) === "205" || rachet.integrujeBit === true) { // Specjalny Ratchet Turbo
                            suma.DASH = getStat(rachet, 'DASH'); suma.B_RES = getStat(rachet, 'BURST_RES');
                        }
                    }
                    const jestSpecjalnyRatchet = rachet && (String(rachet.id) === "205" || rachet.integrujeBit === true);
                    if (bit && !jestSpecjalnyRatchet) {
                        suma.DASH += getStat(bit, 'DASH'); suma.B_RES += getStat(bit, 'BURST_RES'); suma.WAGA += getStat(bit, 'waga');
                    }
                } else if (seria === 'cx') {
                    const { cx_lock_chip, cx_main_blade, cx_assist_blade, rachet, bit } = czesciZestawu;
                    if (cx_lock_chip) { suma.WAGA += getStat(cx_lock_chip, 'waga'); suma.CX_LC_WYTRZ += getStat(cx_lock_chip, 'cx_lc_wytrz'); suma.ATK += getStat(cx_lock_chip, 'cx_lc_atk_bonus'); suma.DEF += getStat(cx_lock_chip, 'cx_lc_def_bonus'); }
                    if (cx_main_blade) { suma.ATK += getStat(cx_main_blade, 'ATK'); suma.DEF += getStat(cx_main_blade, 'DEF'); suma.STM += getStat(cx_main_blade, 'STM'); suma.WAGA += getStat(cx_main_blade, 'waga'); }
                    if (cx_assist_blade) { suma.ATK += getStat(cx_assist_blade, 'ATK'); suma.DEF += getStat(cx_assist_blade, 'DEF'); suma.STM += getStat(cx_assist_blade, 'STM'); suma.WAGA += getStat(cx_assist_blade, 'waga'); }
                    if (rachet) {
                        suma.ATK += getStat(rachet, 'ATK'); suma.DEF += getStat(rachet, 'DEF'); suma.STM += getStat(rachet, 'STM'); suma.WAGA += getStat(rachet, 'waga');
                         if (String(rachet.id) === "205" || rachet.integrujeBit === true) { // Specjalny Ratchet Turbo
                            suma.DASH = getStat(rachet, 'DASH'); suma.B_RES = getStat(rachet, 'BURST_RES');
                        }
                    }
                    const jestSpecjalnyRatchetCX = rachet && (String(rachet.id) === "205" || rachet.integrujeBit === true);
                    if (bit && !jestSpecjalnyRatchetCX) {
                        suma.DASH += getStat(bit, 'DASH'); suma.B_RES += getStat(bit, 'BURST_RES'); suma.WAGA += getStat(bit, 'waga');
                    }
                }

                for (const key in suma) {
                    if (typeof suma[key] === 'number') suma[key] = parseFloat(suma[key].toFixed(1));
                }
                return suma;
            }

            // =================================
            // Generator Losowych ZestawÃ³w
            // =================================
            function generujHTMLDlaKartyZestawu(zestaw, indexZestawu) {
                const { seria, czesci, statystyki, idZestawu } = zestaw;
                const getPartAndHTML = (partObj, partTypeDefaultName) => {
                    const imgHTML = partObj?.img ? `<img src="${partObj.img}" alt="${partObj.nazwa || partTypeDefaultName}" class="deck-part-img">` : `<div class="deck-part-placeholder">${partTypeDefaultName.substring(0,3).toUpperCase()}</div>`;
                    const nameText = partObj ? (partObj.nazwa || `<i>${partTypeDefaultName} N/A</i>`) : `<i>Brak ${partTypeDefaultName}</i>`;
                    return { html: imgHTML, name: nameText };
                };

                let setImagesHTML = ''; let setNameParts = [];
                const ratchetWylosowany = czesci.rachet;
                const czySpecjalnyRatchetZostalWylosowany = ratchetWylosowany && (String(ratchetWylosowany.id) === "205" || ratchetWylosowany.integrujeBit === true);

                if (seria === 'bx_ux') {
                    const bladeInfo = getPartAndHTML(czesci.blade, 'Blade');
                    const ratchetInfo = getPartAndHTML(ratchetWylosowany, 'Ratchet');
                    // === ZMIANA TUTAJ: UÅ¼ywamy nowego obrazka dla zintegrowanego bita ===
                    let bitInfo = czySpecjalnyRatchetZostalWylosowany ?
                        { html: `<img src="img/bitturbo.png" alt="Bit Zintegrowany" class="deck-part-img" title="Bit zintegrowany w ${ratchetWylosowany.nazwa}">`, name: `<em>(Bit zint. w ${ratchetWylosowany.nazwa})</em>` } :
                        getPartAndHTML(czesci.bit, 'Bit');
                    // === KONIEC ZMIANY ===
                    setImagesHTML = `<div class="wynik-zestaw-obrazki">${bladeInfo.html} ${ratchetInfo.html} ${bitInfo.html}</div>`;
                    setNameParts = [`<strong>Blade:</strong> ${bladeInfo.name}`, `<strong>Ratchet:</strong> ${ratchetInfo.name}`, `<strong>Bit:</strong> ${bitInfo.name}`];
                } else if (seria === 'cx') {
                    const lockChipInfo = getPartAndHTML(czesci.cx_lock_chip, 'LockChip');
                    const mainBladeInfo = getPartAndHTML(czesci.cx_main_blade, 'MainBlade');
                    const assistBladeInfo = getPartAndHTML(czesci.cx_assist_blade, 'AssistBlade');
                    const ratchetInfo = getPartAndHTML(ratchetWylosowany, 'Ratchet');
                    // === ZMIANA TUTAJ: UÅ¼ywamy nowego obrazka dla zintegrowanego bita ===
                    let bitInfo = czySpecjalnyRatchetZostalWylosowany ?
                        { html: `<img src="img/bitturbo.png" alt="Bit Zintegrowany" class="deck-part-img" title="Bit zintegrowany w ${ratchetWylosowany.nazwa}">`, name: `<em>(Bit zint. w ${ratchetWylosowany.nazwa})</em>` } :
                        getPartAndHTML(czesci.bit, 'Bit');
                    // === KONIEC ZMIANY ===
                    setImagesHTML = `<div class="cx-images-container"><div class="cx-blade-row wynik-zestaw-obrazki">${lockChipInfo.html} ${mainBladeInfo.html} ${assistBladeInfo.html}</div><div class="cx-drive-row wynik-zestaw-obrazki" style="margin-top: 5px;">${ratchetInfo.html} ${bitInfo.html}</div></div>`;
                    setNameParts = [`<strong>LockChip:</strong> ${lockChipInfo.name}`, `<strong>Main Blade:</strong> ${mainBladeInfo.name}`, `<strong>Assist Blade:</strong> ${assistBladeInfo.name}`, `<strong>Ratchet:</strong> ${ratchetInfo.name}`, `<strong>Bit:</strong> ${bitInfo.name}`];
                }

                let setNameHTML = setNameParts.join('<br>');
                let statySumaryczneHTML = '<div class="stat-grid">';
                statySumaryczneHTML += `<span>ATK: ${(statystyki.ATK || 0).toFixed(1)}</span>`;
                statySumaryczneHTML += `<span>DEF: ${(statystyki.DEF || 0).toFixed(1)}</span>`;
                statySumaryczneHTML += `<span>STM: ${(statystyki.STM || 0).toFixed(1)}</span>`;
                statySumaryczneHTML += `<span>Waga: ${(statystyki.WAGA || 0).toFixed(1)}g</span>`;
                if ((statystyki.DASH || 0) !== 0) statySumaryczneHTML += `<span>DASH: ${(statystyki.DASH || 0).toFixed(1)}</span>`;
                if ((statystyki.B_RES || 0) !== 0) statySumaryczneHTML += `<span>B-RES: ${(statystyki.B_RES || 0).toFixed(1)}</span>`;
                if (seria === 'cx' && (statystyki.CX_LC_WYTRZ || 0) !== 0) statySumaryczneHTML += `<span>LC-W: ${parseInt((statystyki.CX_LC_WYTRZ || 0).toFixed(0))}</span>`;
                statySumaryczneHTML += `</div>`;

                let zmienneStatyRatchetHTML = '';

                return `
                    <div class="card saved-deck-card generated-set-card ${seria === 'cx' ? 'wylosowany-zestaw-cx' : ''}" data-zestaw-id="${idZestawu}">
                        <h4 style="text-align:center; color:#d1b3ff; margin-bottom: 10px;">Wylosowany Zestaw ${seria.toUpperCase().replace('_','/')} #${indexZestawu + 1}</h4>
                        ${setImagesHTML}
                        <div style="font-size:0.85em; color:#ddd; margin-top: 8px; margin-bottom:12px; word-break: break-word; text-align:center; line-height: 1.4;">${setNameHTML}</div>
                        <div style="margin-top:10px; padding-top:10px; border-top: 1px solid rgba(255,255,255,0.1);"><strong style="display:block; text-align:center; font-size:0.9em; margin-bottom:5px; color:#c080ff;">SUMA STATYSTYK:</strong>${statySumaryczneHTML}</div>
                        ${zmienneStatyRatchetHTML}
                    </div>`;
            }

            function wyczyscLosowanie() {
                if (wynikiDivGenerator) wynikiDivGenerator.innerHTML = '';
                if (placeholderActualImgGenerator) placeholderActualImgGenerator.style.display = 'block';
                ostatnioWylosowaneZestawyGlobalnie = [];
                const zapiszGlownyControls = document.getElementById('zapisz-glowny-zestaw-controls');
                if (zapiszGlownyControls) zapiszGlownyControls.style.display = 'none';
                const nazwaDeckuInput = document.getElementById('nazwa-glownego-decku');
                if(nazwaDeckuInput) nazwaDeckuInput.value = ""; // CzyÅ›cimy teÅ¼ pole nazwy
                showNotification('Wyniki losowania wyczyszczone.', 2000, 'info');
            }

           function LOSUJ() {
    if (!wynikiDivGenerator) {
        showNotification("BÅ‚Ä…d: Element wynikÃ³w generatora nie istnieje.", 3000, 'error');
        return;
    }
    if (placeholderActualImgGenerator) placeholderActualImgGenerator.style.display = 'none';
    wynikiDivGenerator.innerHTML = '';
    ostatnioWylosowaneZestawyGlobalnie = [];

    const iloscZestawowDoWylosowania = parseInt(document.getElementById('ilosc')?.value) || 1;
    let wybranaSeria = document.getElementById('seriaLosowania')?.value;

    if (!wybranaSeria) {
        showNotification("BÅ‚Ä…d: Nie wybrano serii.", 3000, 'warning');
        if (placeholderActualImgGenerator) placeholderActualImgGenerator.style.display = 'block';
        return;
    }

    const magazyn = getMagazyn();
    if (!magazyn || magazyn.length === 0) {
        wynikiDivGenerator.innerHTML = '<div class="card"><p>Magazyn jest pusty! Dodaj czÄ™Å›ci w zakÅ‚adce "Magazyn".</p></div>';
        if (placeholderActualImgGenerator) placeholderActualImgGenerator.style.display = 'block';
        return;
    }

    const dostepneCzesciDoLosowania = {
        blade: [], 'ux-blade': [], rachet: [], bit: [], 'cx-lock-chip': [], 'cx-main-blade': [], 'cx-assist-blade': []
    };
    magazyn.forEach(czesc => {
        const ilosc = parseInt(czesc.ilosc) || 0;
        if (ilosc > 0 && dostepneCzesciDoLosowania.hasOwnProperty(czesc.typ)) {
            for (let j = 0; j < ilosc; j++) {
                dostepneCzesciDoLosowania[czesc.typ].push({ ...czesc, _uniqueDragId: `${czesc.id}_instance_${j}_${Date.now()}_${Math.random()}` });
            }
        }
    });

    const wylosowaneZestawyFragment = document.createDocumentFragment();
    const serieDoWyboru = ['bx_ux', 'cx'];

    for (let i = 0; i < iloscZestawowDoWylosowania; i++) {
        let seriaDoWylosowania = (wybranaSeria === 'all') ? serieDoWyboru[Math.floor(Math.random() * serieDoWyboru.length)] : wybranaSeria;

        // Sprawdzenie, czy w ogÃ³le moÅ¼na zbudowaÄ‡ cokolwiek z tej serii
        let czyMoznaZbudowac = (seria) => {
            if (seria === 'bx_ux') {
                return (dostepneCzesciDoLosowania.blade.length + dostepneCzesciDoLosowania['ux-blade'].length) > 0 &&
                       dostepneCzesciDoLosowania.rachet.length > 0 &&
                       (dostepneCzesciDoLosowania.bit.length > 0 || dostepneCzesciDoLosowania.rachet.some(r => r.integrujeBit));
            } else if (seria === 'cx') {
                return dostepneCzesciDoLosowania['cx-lock-chip'].length > 0 &&
                       dostepneCzesciDoLosowania['cx-main-blade'].length > 0 &&
                       dostepneCzesciDoLosowania['cx-assist-blade'].length > 0 &&
                       dostepneCzesciDoLosowania.rachet.length > 0 &&
                       (dostepneCzesciDoLosowania.bit.length > 0 || dostepneCzesciDoLosowania.rachet.some(r => r.integrujeBit));
            }
            return false;
        };

        if (!czyMoznaZbudowac(seriaDoWylosowania)) {
            if (wybranaSeria === 'all') { // JeÅ›li w trybie 'all' pierwszy los siÄ™ nie uda, sprÃ³buj drugiej serii
                const innaSeria = seriaDoWylosowania === 'bx_ux' ? 'cx' : 'bx_ux';
                if (czyMoznaZbudowac(innaSeria)) {
                    seriaDoWylosowania = innaSeria;
                } else {
                    showNotification(`NiewystarczajÄ…ca iloÅ›Ä‡ czÄ™Å›ci w magazynie, by losowaÄ‡ zestawy.`, 4000, 'warning');
                    break;
                }
            } else {
                showNotification(`NiewystarczajÄ…ca iloÅ›Ä‡ czÄ™Å›ci w magazynie do wylosowania zestawu ${seriaDoWylosowania.toUpperCase()}.`, 4000, 'warning');
                break;
            }
        }

        let wylosowanyZestawCzesci = {};
        let czyZestawKompletny = true;
        let wylosowanoSpecjalnyRatchet = false;
        const maxProb = 10; // Maksymalna liczba prÃ³b znalezienia kompatybilnej czÄ™Å›ci

        const losujCzescZPulli = (typCzesci, filtrKompatybilnosci = null) => {
            let pulaFiltrwana = [...(dostepneCzesciDoLosowania[typCzesci] || [])];
            if (filtrKompatybilnosci) pulaFiltrwana = pulaFiltrwana.filter(filtrKompatybilnosci);

            if (pulaFiltrwana.length > 0) {
                const randomIndex = Math.floor(Math.random() * pulaFiltrwana.length);
                const wylosowanaCzescZKopii = pulaFiltrwana[randomIndex];
                const indexWOryginalnejPuli = dostepneCzesciDoLosowania[typCzesci].findIndex(c => c._uniqueDragId === wylosowanaCzescZKopii._uniqueDragId);
                if (indexWOryginalnejPuli > -1) {
                    const finalnieWylosowanaCzesc = dostepneCzesciDoLosowania[typCzesci].splice(indexWOryginalnejPuli, 1)[0];
                    if (finalnieWylosowanaCzesc.maTryby && Array.isArray(finalnieWylosowanaCzesc.tryby) && finalnieWylosowanaCzesc.tryby.length > 0) {
                        const wylosowanyTrybIndex = Math.floor(Math.random() * finalnieWylosowanaCzesc.tryby.length);
                        const wylosowanyTryb = finalnieWylosowanaCzesc.tryby[wylosowanyTrybIndex];
                        const czescZTrybem = { ...finalnieWylosowanaCzesc };
                        delete czescZTrybem.tryby;
                        Object.assign(czescZTrybem, wylosowanyTryb);
                        czescZTrybem.aktywnyTrybIndex = wylosowanyTrybIndex;
                        czescZTrybem.nazwa = `${finalnieWylosowanaCzesc.nazwa} (${wylosowanyTryb.nazwaTrybu})`;
                        return czescZTrybem;
                    }
                    return finalnieWylosowanaCzesc;
                }
            }
            return null;
        };
        
        // --- START NOWEJ LOGIKI LOSOWANIA ZESTAWU BX/UX ---
        if (seriaDoWylosowania === 'bx_ux') {
            let probaLosowania = 0;
            while (probaLosowania < maxProb) {
                const pulaBlade = [...dostepneCzesciDoLosowania.blade, ...dostepneCzesciDoLosowania['ux-blade']];
                if (pulaBlade.length === 0) { czyZestawKompletny = false; break; }

                const losowyIndexBlade = Math.floor(Math.random() * pulaBlade.length);
                const potencjalnyBlade = pulaBlade[losowyIndexBlade];

                if (potencjalnyBlade.id === ID_CLOCK_MIRAGE) {
                    const pulaKompatybilnychRatchetow = dostepneCzesciDoLosowania.rachet.filter(r => r.nazwa.match(/-\d*5$/) || r.nazwa.match(/^M-\d*5$/));
                    if (pulaKompatybilnychRatchetow.length > 0) {
                        wylosowanyZestawCzesci.blade = losujCzescZPulli(potencjalnyBlade.typ, c => c._uniqueDragId === potencjalnyBlade._uniqueDragId);
                        wylosowanyZestawCzesci.rachet = losujCzescZPulli('rachet', r => r.nazwa.match(/-\d*5$/) || r.nazwa.match(/^M-\d*5$/));
                        break; // Znaleziono kompatybilny zestaw, przerwij pÄ™tlÄ™ prÃ³b
                    }
                } else {
                    wylosowanyZestawCzesci.blade = losujCzescZPulli(potencjalnyBlade.typ, c => c._uniqueDragId === potencjalnyBlade._uniqueDragId);
                    wylosowanyZestawCzesci.rachet = losujCzescZPulli('rachet');
                    break; // Wylosowano standardowy blade, przerwij pÄ™tlÄ™ prÃ³b
                }
                probaLosowania++;
            }
            
            if (!wylosowanyZestawCzesci.blade || !wylosowanyZestawCzesci.rachet) {
                czyZestawKompletny = false;
            } else {
                if (wylosowanyZestawCzesci.rachet.integrujeBit === true) {
                    wylosowanoSpecjalnyRatchet = true;
                    wylosowanyZestawCzesci.bit = null;
                } else {
                    wylosowanyZestawCzesci.bit = losujCzescZPulli('bit');
                    if (!wylosowanyZestawCzesci.bit) czyZestawKompletny = false;
                }
            }
        }
        // --- KONIEC NOWEJ LOGIKI DLA BX/UX ---

        else if (seriaDoWylosowania === 'cx') {
            wylosowanyZestawCzesci.cx_lock_chip = losujCzescZPulli('cx-lock-chip');
            wylosowanyZestawCzesci.cx_main_blade = losujCzescZPulli('cx-main-blade');
            wylosowanyZestawCzesci.cx_assist_blade = losujCzescZPulli('cx-assist-blade');
            wylosowanyZestawCzesci.rachet = losujCzescZPulli('rachet');
            
            if (wylosowanyZestawCzesci.rachet) {
                if (wylosowanyZestawCzesci.rachet.integrujeBit === true) {
                    wylosowanoSpecjalnyRatchet = true;
                    wylosowanyZestawCzesci.bit = null;
                } else {
                    wylosowanyZestawCzesci.bit = losujCzescZPulli('bit');
                }
            } else {
                czyZestawKompletny = false;
            }

            if (!wylosowanyZestawCzesci.cx_lock_chip || !wylosowanyZestawCzesci.cx_main_blade || !wylosowanyZestawCzesci.cx_assist_blade || !wylosowanyZestawCzesci.rachet || (!wylosowanoSpecjalnyRatchet && !wylosowanyZestawCzesci.bit)) {
                czyZestawKompletny = false;
            }
        }

        if (czyZestawKompletny) {
            const czesciDoStatystyk = {};
            for (const key in wylosowanyZestawCzesci) {
                if (wylosowanyZestawCzesci[key]) {
                    const { _uniqueDragId, ...resztaCzesci } = wylosowanyZestawCzesci[key];
                    czesciDoStatystyk[key] = resztaCzesci;
                } else {
                    czesciDoStatystyk[key] = null;
                }
            }
            const statystykiZestawu = obliczSumeStatystykZestawu(czesciDoStatystyk, seriaDoWylosowania);
            const idUnikalnyZestawu = `wylosowany-${Date.now()}-${i}-${Math.random().toString(16).slice(2)}`;
            const pelnyZestaw = { idZestawu: idUnikalnyZestawu, seria: seriaDoWylosowania, czesci: czesciDoStatystyk, statystyki: statystykiZestawu };
            ostatnioWylosowaneZestawyGlobalnie.push(pelnyZestaw);
            const kartaHTML = generujHTMLDlaKartyZestawu(pelnyZestaw, i);
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = kartaHTML.trim();
            wylosowaneZestawyFragment.appendChild(tempDiv.firstChild);
        } else {
            if (wybranaSeria !== 'all') {
                showNotification(`Nie udaÅ‚o siÄ™ wylosowaÄ‡ kompletu dla zestawu #${i + 1}.`, 3500, 'warning');
            }
        }
    }

    if (wylosowaneZestawyFragment.childNodes.length > 0) {
        wynikiDivGenerator.appendChild(wylosowaneZestawyFragment);
        showNotification(`Wylosowano ${ostatnioWylosowaneZestawyGlobalnie.length} zestaw(Ã³w)!`, 2500, 'success');
    } else {
        wynikiDivGenerator.innerHTML = '<div class="card"><p>Nie udaÅ‚o siÄ™ wylosowaÄ‡ Å¼adnego kompletnego zestawu z dostÄ™pnych czÄ™Å›ci.</p></div>';
        if (placeholderActualImgGenerator) placeholderActualImgGenerator.style.display = 'block';
    }
}

            // =================================
            // Zapisywanie Wylosowanych ZestawÃ³w
            // =================================
            function saveCurrentGeneratedDeck() {
                if (!ostatnioWylosowaneZestawyGlobalnie || ostatnioWylosowaneZestawyGlobalnie.length === 0) {
                    showNotification("Brak wylosowanych zestawÃ³w do zapisania jako deck.", 3000, 'warning'); return;
                }
                // DomyÅ›lnie zapisujemy pierwszy wylosowany zestaw jako deck jednosetowy
                const zestawDoZapisu = ostatnioWylosowaneZestawyGlobalnie[0];
                if (!zestawDoZapisu || !zestawDoZapisu.czesci || !zestawDoZapisu.seria) {
                    showNotification("BÅ‚Ä…d: Dane wylosowanego zestawu sÄ… niekompletne.", 3000, 'error'); return;
                }

                const nazwaInput = document.getElementById('nazwa-glownego-decku');
                let nazwaDecku = `Wylosowany ${zestawDoZapisu.seria.toUpperCase().replace('_','/')} ${new Date().toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' })}`;
                if (nazwaInput && nazwaInput.value.trim() !== '') nazwaDecku = nazwaInput.value.trim();

                const pojedynczyZestawKonfiguracja = {
                    seria: zestawDoZapisu.seria,
                    statystykiObliczone: zestawDoZapisu.statystyki
                };

                if (zestawDoZapisu.seria === 'bx_ux') {
                    pojedynczyZestawKonfiguracja.bladeId = zestawDoZapisu.czesci.blade?.id || null;
                    pojedynczyZestawKonfiguracja.ratchetId = zestawDoZapisu.czesci.rachet?.id || null;
                    pojedynczyZestawKonfiguracja.bitId = zestawDoZapisu.czesci.bit?.id || null;
                } else if (zestawDoZapisu.seria === 'cx') {
                    pojedynczyZestawKonfiguracja.cx_lock_chipId = zestawDoZapisu.czesci.cx_lock_chip?.id || null;
                    pojedynczyZestawKonfiguracja.cx_main_bladeId = zestawDoZapisu.czesci.cx_main_blade?.id || null;
                    pojedynczyZestawKonfiguracja.cx_assist_bladeId = zestawDoZapisu.czesci.cx_assist_blade?.id || null;
                    pojedynczyZestawKonfiguracja.ratchetId = zestawDoZapisu.czesci.rachet?.id || null; // Rachet i Bit sÄ… teÅ¼ w CX
                    pojedynczyZestawKonfiguracja.bitId = zestawDoZapisu.czesci.bit?.id || null;
                } else { showNotification("BÅ‚Ä…d: Nieznana seria wylosowanego zestawu.", 3000, 'error'); return; }

                const nowyDeck = {
                    id: `deck_${Date.now()}_${Math.random().toString(36).substring(2, 7)}`,
                    name: nazwaDecku,
                    timestamp: Date.now(),
                    lastModified: Date.now(),
                    sets: [pojedynczyZestawKonfiguracja] // Deck skÅ‚ada siÄ™ z jednego, wylosowanego zestawu
                };

                const zapisaneDecki = getSavedDecks();
                zapisaneDecki.push(nowyDeck);
                setSavedDecks(zapisaneDecki);
                showNotification(`Deck "${nowyDeck.name}" (z jednego zestawu) zapisany!`, 3000, 'success');
                if (nazwaInput) nazwaInput.value = ''; // CzyÅ›cimy pole nazwy po zapisie

                // Opcjonalnie: Zaktualizuj przycisk zapisu, aby pokazaÄ‡, Å¼e zapisano
                const zapiszGlownyButton = document.querySelector('#zapisz-glowny-zestaw-controls button');
                if(zapiszGlownyButton) {
                    zapiszGlownyButton.textContent = 'Zapisano!';
                    zapiszGlownyButton.disabled = true;
                    setTimeout(() => {
                        zapiszGlownyButton.textContent = 'Zapisz Ten Wylosowany Zestaw';
                        zapiszGlownyButton.disabled = false;
                    }, 2500);
                }
            }

            // =================================
            // Drag and Drop Deck Builder - Funkcje RenderujÄ…ce
            // =================================

                function renderDeckBuilderAndParts() {
                    console.log("renderDeckBuilderAndParts (tabs) wywoÅ‚ane. Aktywny zestaw index:", currentlyActiveSetIndexInBuilder, "Dane:", JSON.parse(JSON.stringify(currentDeckBeingBuilt)));
                    renderAvailablePartsList();
                    renderDeckSetTabs(); // Nowa funkcja do renderowania zakÅ‚adek
                    renderActiveDeckSetSlots(); // Nowa funkcja do renderowania slotÃ³w tylko aktywnego zestawu

                    // Statystyki sÄ… teraz aktualizowane w renderActiveDeckSetSlots dla aktywnego zestawu
                }

                function renderDeckSetTabs() {
                    const tabsContainer = document.getElementById('deck-set-tabs-container');
                    if (!tabsContainer) {
                        console.error("Kontener zakÅ‚adek #deck-set-tabs-container nie znaleziony");
                        return;
                    }
                    tabsContainer.innerHTML = ''; // WyczyÅ›Ä‡ stare zakÅ‚adki

                    for (let i = 0; i < 4; i++) {
                        const tabButton = document.createElement('button');
                        tabButton.className = 'tab-button';
                        tabButton.textContent = `Zestaw ${i + 1}`;
                        tabButton.dataset.setIndex = i; // Przechowujemy indeks 0-3

                        if (i === currentlyActiveSetIndexInBuilder) {
                            tabButton.classList.add('active');
                        }

                        tabButton.addEventListener('click', (event) => {
                            const newActiveIndex = parseInt(event.currentTarget.dataset.setIndex);
                            if (newActiveIndex !== currentlyActiveSetIndexInBuilder) {
                                currentlyActiveSetIndexInBuilder = newActiveIndex;
                                renderDeckBuilderAndParts(); // Prerenderuj wszystko, aby odÅ›wieÅ¼yÄ‡ zakÅ‚adki i sloty
                            }
                        });
                        tabsContainer.appendChild(tabButton);
                    }
                }

            function renderActiveDeckSetSlots() {
                const activeSlotsContainer = document.getElementById('deck-builder-active-set-slots');
                if (!activeSlotsContainer) {
                    console.error("Kontener slotÃ³w aktywnego zestawu #deck-builder-active-set-slots nie znaleziony");
                    return;
                }
                activeSlotsContainer.innerHTML = '';

                if (!currentDeckBeingBuilt || !currentDeckBeingBuilt.sets || !currentDeckBeingBuilt.sets[currentlyActiveSetIndexInBuilder]) {
                    console.warn("currentDeckBeingBuilt lub aktywny zestaw nie jest poprawnie zainicjalizowany.");
                    initializeOrResetCurrentDeck();
                    if (!currentDeckBeingBuilt.sets[currentlyActiveSetIndexInBuilder]) {
                        currentDeckBeingBuilt.sets[currentlyActiveSetIndexInBuilder] = { seria: 'bx_ux', bladeId: null, ratchetId: null, bitId: null, cx_lock_chipId: null, cx_main_bladeId: null, cx_assist_bladeId: null, statystykiObliczone: {} };
                    }
                    renderDeckSetTabs();
                }

                const setIndex = currentlyActiveSetIndexInBuilder;
                const displaySetNumber = setIndex + 1;
                const setConfig = currentDeckBeingBuilt.sets[setIndex];

                const deckSetCard = document.createElement("div");
                deckSetCard.className = "deck-set card";
                deckSetCard.style.marginBottom = "20px";
                deckSetCard.style.padding = "15px";

                const seriaSelectDiv = document.createElement('div');
                seriaSelectDiv.style.marginBottom = "10px";
                const seriaLabel = document.createElement('label');
                seriaLabel.htmlFor = `deck-seria-${displaySetNumber}`;
                seriaLabel.textContent = `Seria dla Zestawu ${displaySetNumber}: `;
                seriaLabel.style.marginRight = "5px";
                const seriaSelect = document.createElement('select');
                seriaSelect.id = `deck-seria-${displaySetNumber}`;
                seriaSelect.innerHTML = `
                    <option value="bx_ux" ${setConfig.seria === 'bx_ux' ? 'selected' : ''}>BX / UX</option>
                    <option value="cx" ${setConfig.seria === 'cx' ? 'selected' : ''}>CX</option>
                `;
                seriaSelect.dataset.setIndex = setIndex;
                seriaSelect.addEventListener('change', handleSeriaChangeForSet);
                seriaSelectDiv.appendChild(seriaLabel);
                seriaSelectDiv.appendChild(seriaSelect);
                deckSetCard.appendChild(seriaSelectDiv);

                const partTypes = getPartTypesForSeria(setConfig.seria);
                const magazyn = getMagazyn();

                let jestTurboRatchetWAktywnymZestawie = false;
                if (setConfig.ratchetId) {
                    const aktywnyRatchet = magazyn.find(p => p.id === setConfig.ratchetId && p.typ === 'rachet');
                    if (aktywnyRatchet && (String(aktywnyRatchet.id) === "205" || aktywnyRatchet.integrujeBit === true)) {
                        jestTurboRatchetWAktywnymZestawie = true;
                    }
                }

                if (jestTurboRatchetWAktywnymZestawie && setConfig.bitId !== null) {
                    setConfig.bitId = null;
                }

                partTypes.forEach(partTypeInfo => {
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'deck-part-slot';
                    slotDiv.dataset.setIndex = setIndex;
                    slotDiv.dataset.slotType = partTypeInfo.type;

                    const partIdKey = getPartIdKeyForSlot(partTypeInfo.type, setConfig.seria);
                    const partId = partIdKey ? setConfig[partIdKey] : null;

                    // === ZMIANA TUTAJ: UÅ¼ywamy nowego obrazka dla zintegrowanego bita ===
                    if (partTypeInfo.type === 'bit' && jestTurboRatchetWAktywnymZestawie) {
                        slotDiv.classList.add('filled'); // Dodajemy klasÄ™ filled, aby wyglÄ…daÅ‚o jak zajÄ™ty slot
                        slotDiv.innerHTML = `
                             <div class="part-info-container">
                                <img src="img/bitturbo.png" alt="Bit Zintegrowany" style="width: 50px; height: 50px; object-fit: contain; border-radius: 4px;">
                                <span class="part-name" style="font-style: italic; color: #aaa;">Bit zintegrowany</span>
                            </div>
                        `;
                    // === KONIEC ZMIANY ===
                    } else {
                        if (partId) {
                            const partDetails = magazyn.find(p => p.id === partId);
                            if (partDetails) {
                                const trybIndexKey = partIdKey.replace('Id', 'AktywnyTrybIndex');
                                const aktywnyTrybIndex = setConfig[trybIndexKey] || 0;
                                const trybAktywny = (partDetails.maTryby && partDetails.tryby) ? partDetails.tryby[aktywnyTrybIndex] : null;

                                const obrazek = trybAktywny?.img || partDetails.img;
                                let slotImageHTML = obrazek ? `<img src="${obrazek}" alt="${partDetails.nazwa}" style="width: 50px; height: 50px; object-fit: contain; border-radius: 4px;">` : `<div class="dnd-slot-placeholder">Brak<br>Obr.</div>`;

                                let modeSwitcherHTML = '';
                                if (partDetails.maTryby && Array.isArray(partDetails.tryby) && partDetails.tryby.length > 1) {
                                    const nazwaAktywnegoTrybu = trybAktywny?.nazwaTrybu || 'Tryb 1';
                                    modeSwitcherHTML = `
                                        <button class="mode-switch-btn" onclick="przelaczTrybCzesci(${setIndex}, '${partTypeInfo.type}')" title="ZmieÅ„ tryb: ${nazwaAktywnegoTrybu}">
                                            ${nazwaAktywnegoTrybu}
                                        </button>
                                    `;
                                }

                                slotDiv.innerHTML = `
                                    <div class="part-info-container">
                                        ${slotImageHTML}
                                        <span class="part-name">${partDetails.nazwa}</span>
                                    </div>
                                    <div class="part-controls">
                                        ${modeSwitcherHTML}
                                        <button class="remove-part-btn" title="UsuÅ„ czÄ™Å›Ä‡">&times;</button>
                                    </div>
                                `;
                                slotDiv.classList.add('filled');
                                slotDiv.dataset.currentPartId = partId;
                                slotDiv.querySelector('.remove-part-btn').addEventListener('click', () => removePartFromSlot(setIndex, partTypeInfo.type));
                            } else {
                                slotDiv.innerHTML = `<span>UpuÅ›Ä‡ ${partTypeInfo.label} tutaj (ID: ${partId} nie znalezione)</span>`;
                                if (partIdKey) setConfig[partIdKey] = null;
                            }
                        } else {
                            slotDiv.innerHTML = `<span>UpuÅ›Ä‡ ${partTypeInfo.label} tutaj</span>`;
                        }

                        slotDiv.addEventListener('dragover', handleDragOver);
                        slotDiv.addEventListener('dragenter', handleDragEnter);
                        slotDiv.addEventListener('dragleave', handleDragLeave);
                        slotDiv.addEventListener('drop', handleDrop);
                    }
                    deckSetCard.appendChild(slotDiv);
                });

                const statsDiv = document.createElement('div');
                statsDiv.id = `deck-stats-${displaySetNumber}`;
                statsDiv.className = "deck-stats";
                statsDiv.style.cssText = "margin-top: 15px; font-weight: normal; font-size: 0.9em; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 6px; text-align: left; line-height: 1.5;";
                deckSetCard.appendChild(statsDiv);

                activeSlotsContainer.appendChild(deckSetCard);
                updateDeckStatsForSetInBuilder(displaySetNumber);
            }

            function przelaczTrybCzesci(setIndex, partType) {
                if (!currentDeckBeingBuilt || !currentDeckBeingBuilt.sets[setIndex]) return;
                const set = currentDeckBeingBuilt.sets[setIndex];

                const partId = set[`${partType}Id`];
                if (!partId) return;

                // Pobierz dane czÄ™Å›ci z magazynu
                const magazyn = getMagazyn();
                const part = magazyn.find(c => c.id === partId);
                if (!part || !part.maTryby) return;

                // Ustal nazwÄ™ klucza w decku (np. bladeAktywnyTrybIndex)
                const keyIndex = `${partType}AktywnyTrybIndex`;

                // ZmieÅ„ tryb w decku
                set[keyIndex] = ((set[keyIndex] || 0) + 1) % part.tryby.length;

                // ZmieÅ„ teÅ¼ w magazynie, Å¼eby byÅ‚o spÃ³jnie
                const idxMagazyn = magazyn.findIndex(c => c.id === partId);
                if (idxMagazyn !== -1) {
                    magazyn[idxMagazyn].aktywnyTrybIndex = set[keyIndex];
                    setMagazyn(magazyn);
                }

                renderDeckBuilderAndParts(); // odÅ›wieÅ¼ widok slotÃ³w
            }

            function przelaczTrybMagazynu(idCzesci) {
                const magazyn = getMagazyn();
                const idx = magazyn.findIndex(c => c.id === idCzesci);
                if (idx === -1) return;

                const czesc = magazyn[idx];
                if (!czesc.maTryby || !czesc.tryby || czesc.tryby.length < 2) return;

                czesc.aktywnyTrybIndex = ((czesc.aktywnyTrybIndex || 0) + 1) % czesc.tryby.length;
                setMagazyn(magazyn);
                wyswietlMagazyn(); // odÅ›wieÅ¼ UI
            }


            function renderAvailablePartsList() {
                const partsListContainer = document.getElementById('parts-list-for-dnd');
                if (!partsListContainer) { return; }
                partsListContainer.innerHTML = '';
                const magazyn = getMagazyn();
                const filterValue = document.getElementById('dndPartTypeFilter')?.value;

                if (!filterValue) {
                    partsListContainer.innerHTML = '<p style="font-size:0.9em; color:#999; text-align:center;">Wybierz typ czÄ™Å›ci.</p>';
                    return;
                }

                // --- KLUCZOWA POPRAWKA LOGIKI FILTROWANIA ---
                // UÅ¼ywamy prostego i niezawodnego porÃ³wnania 'czesc.typ === filterValue'
                const czesciDoWyswietlenia = magazyn
                    .filter(czesc => czesc && czesc.ilosc > 0 && czesc.typ === filterValue)
                    .sort((a, b) => a.nazwa.localeCompare(b.nazwa));
                // --- KONIEC POPRAWKI ---

                if (czesciDoWyswietlenia.length === 0) {
                    partsListContainer.innerHTML = `<p style="font-size:0.9em; color:#999; text-align:center;">Brak posiadanych czÄ™Å›ci tego typu.</p>`;
                    return;
                }

                czesciDoWyswietlenia.forEach(czesc => {
                    const aktywnyIndex = czesc.aktywnyTrybIndex || 0;
                    const trybAktywny = (czesc.maTryby && czesc.tryby) ? czesc.tryby[aktywnyIndex] : null;

                    const obrazek = trybAktywny?.img || czesc.img;
                    const nazwa = trybAktywny ? `${czesc.nazwa} (${trybAktywny.nazwaTrybu})` : czesc.nazwa;

                    const partItem = document.createElement('div');
                    partItem.className = 'available-part-item';
                    partItem.draggable = true;
                   // ===>>> POPRAWKA: Przekazujemy aktywnyTrybIndex do danych czÄ™Å›ci <<<===
            partItem.dataset.partData = JSON.stringify({
                id: czesc.id,
                typ: czesc.typ,
                nazwa: nazwa,
                img: obrazek,
                aktywnyTrybIndex: aktywnyIndex // KLUCZOWA ZMIANA
            });


                    let modeSwitcherHTML = '';
                    if (czesc.maTryby && czesc.tryby.length > 1) {
                        modeSwitcherHTML = `
                            <button
                                class="mode-switch-btn"
                                style="margin-left: auto; flex-shrink: 0;"
                                onclick="event.stopPropagation(); przelaczTrybNaLiscie('${czesc.id}', event)">
                                 ðŸ”„
                            </button>
                        `;
                    }

                    partItem.innerHTML = `
                        <img src="${obrazek}" alt="${nazwa}" style="width: 40px; height: 40px; object-fit: contain; border-radius: 4px; flex-shrink: 0;">
                        <span style="flex-grow: 1; text-align: left;">${nazwa} (x${czesc.ilosc})</span>
                        ${modeSwitcherHTML}
                    `;

                    partItem.addEventListener('dragstart', handleDragStart);
                    partItem.addEventListener('dragend', handleDragEnd);
                    partsListContainer.appendChild(partItem);
                });
            }

            function przelaczTrybNaLiscie(idCzesci, event) {
                // Zatrzymuje "bÄ…belkowanie" eventu, aby klikniÄ™cie nie aktywowaÅ‚o przeciÄ…gania
                event.stopPropagation();

                const magazyn = getMagazyn();
                const idx = magazyn.findIndex(c => c.id === idCzesci);
                if (idx === -1) return;

                const czesc = magazyn[idx];
                if (!czesc.maTryby || !czesc.tryby || czesc.tryby.length < 2) return;

                // ZmieÅ„ indeks trybu
                czesc.aktywnyTrybIndex = ((czesc.aktywnyTrybIndex || 0) + 1) % czesc.tryby.length;
                setMagazyn(magazyn);

                // Prerenderuj listÄ™ czÄ™Å›ci, aby pokazaÄ‡ zmianÄ™
                renderAvailablePartsList();
            }


            function renderDeckSlots() {
                const slotsContainer = document.getElementById('deck-builder-slots');
                if (!slotsContainer) { console.error("Kontener #deck-builder-slots nie znaleziony"); return; }
                slotsContainer.innerHTML = ''; // CzyÅ›cimy przed renderowaniem

                if (!currentDeckBeingBuilt || !currentDeckBeingBuilt.sets || currentDeckBeingBuilt.sets.length === 0) {
                    console.warn("currentDeckBeingBuilt nie jest poprawnie zainicjalizowany do renderowania slotÃ³w.");
                    initializeOrResetCurrentDeck(); // SprÃ³buj zainicjalizowaÄ‡
                }


                for (let i = 0; i < 4; i++) {
                    const setIndex = i; // Index w tablicy (0-3)
                    const displaySetNumber = i + 1; // Numer wyÅ›wietlany uÅ¼ytkownikowi (1-4)
                    const setConfig = currentDeckBeingBuilt.sets[setIndex]; // Pobieramy konfiguracjÄ™ zestawu

                    if (!setConfig) {
                        console.error(`Brak konfiguracji dla zestawu o indeksie ${setIndex} w currentDeckBeingBuilt.`);
                        continue;
                    }

                    const deckSetCard = document.createElement("div");
                    deckSetCard.className = "deck-set card"; // UÅ¼ywamy klasy .card dla spÃ³jnoÅ›ci
                    deckSetCard.style.marginBottom = "20px";
                    deckSetCard.style.padding = "15px";

                    const heading = document.createElement('h3');
                    heading.textContent = `Zestaw ${displaySetNumber}`;
                    deckSetCard.appendChild(heading);

                    const seriaSelectDiv = document.createElement('div');
                    seriaSelectDiv.style.marginBottom = "10px";
                    const seriaLabel = document.createElement('label');
                    seriaLabel.htmlFor = `deck-seria-${displaySetNumber}`;
                    seriaLabel.textContent = `Seria: `;
                    seriaLabel.style.marginRight = "5px";
                    const seriaSelect = document.createElement('select');
                    seriaSelect.id = `deck-seria-${displaySetNumber}`;
                    seriaSelect.innerHTML = `
                        <option value="bx_ux" ${setConfig.seria === 'bx_ux' ? 'selected' : ''}>BX / UX</option>
                        <option value="cx" ${setConfig.seria === 'cx' ? 'selected' : ''}>CX</option>
                    `;
                    seriaSelect.dataset.setIndex = setIndex; // Przechowujemy index tablicy
                    seriaSelect.addEventListener('change', handleSeriaChangeForSet);

                    seriaSelectDiv.appendChild(seriaLabel);
                    seriaSelectDiv.appendChild(seriaSelect);
                    deckSetCard.appendChild(seriaSelectDiv);

                    const partTypes = getPartTypesForSeria(setConfig.seria);
                    partTypes.forEach(partType => {
                        const slotDiv = document.createElement('div');
                        slotDiv.className = 'deck-part-slot';
                        slotDiv.dataset.setIndex = setIndex; // Index tablicy 0-3
                        slotDiv.dataset.slotType = partType.type; // np. 'blade', 'cx-main-blade'
                        // Placeholder tekstowy
                        slotDiv.innerHTML = `<span>UpuÅ›Ä‡ ${partType.label} tutaj</span>`;

                        slotDiv.addEventListener('dragover', handleDragOver);
                        slotDiv.addEventListener('dragenter', handleDragEnter);
                        slotDiv.addEventListener('dragleave', handleDragLeave);
                        slotDiv.addEventListener('drop', handleDrop);
                        deckSetCard.appendChild(slotDiv);
                    });

                    const statsDiv = document.createElement('div');
                    statsDiv.id = `deck-stats-${displaySetNumber}`; // ID dla aktualizacji statystyk
                    statsDiv.className = "deck-stats"; // MoÅ¼esz dodaÄ‡ style dla .deck-stats
                    statsDiv.style.cssText = "margin-top: 15px; font-weight: normal; font-size: 0.9em; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 6px; text-align: left; line-height: 1.5;";
                    deckSetCard.appendChild(statsDiv);

                    slotsContainer.appendChild(deckSetCard);
                }
            }

            function getPartTypesForSeria(seria) {
                if (seria === 'cx') {
                    return [
                        { type: 'cx-lock-chip', label: 'Lock Chip' },
                        { type: 'cx-main-blade', label: 'Main Blade' },
                        { type: 'cx-assist-blade', label: 'Assist Blade' },
                        { type: 'rachet', label: 'Ratchet' },
                        { type: 'bit', label: 'Bit' }
                    ];
                }
                // DomyÅ›lnie BX/UX
                // Zwracamy teraz ogÃ³lnÄ… strukturÄ™ dla obu tych serii,
                // poniewaÅ¼ uÅ¼ywajÄ… tych samych slotÃ³w.
                return [
                    { type: 'blade', label: 'Blade' }, // Etykieta moÅ¼e byÄ‡ ogÃ³lna
                    { type: 'rachet', label: 'Ratchet' },
                    { type: 'bit', label: 'Bit' }
                ];
            }


            function handleSeriaChangeForSet(event) {
                    const setIndex = parseInt(event.target.dataset.setIndex); // To jest indeks 0-3
                    const nowaSeria = event.target.value;

                    if (isNaN(setIndex) || !currentDeckBeingBuilt.sets[setIndex]) return;

                    currentDeckBeingBuilt.sets[setIndex].seria = nowaSeria;

                    // WyczyÅ›Ä‡ ID czÄ™Å›ci poprzedniej serii (lub wszystkie dla bezpieczeÅ„stwa)
                    if (nowaSeria === 'bx_ux') {
                        currentDeckBeingBuilt.sets[setIndex].cx_lock_chipId = null;
                        currentDeckBeingBuilt.sets[setIndex].cx_main_bladeId = null;
                        currentDeckBeingBuilt.sets[setIndex].cx_assist_bladeId = null;
                    } else if (nowaSeria === 'cx') {
                        currentDeckBeingBuilt.sets[setIndex].bladeId = null;
                    }
                    // MoÅ¼na rozwaÅ¼yÄ‡ czyszczenie ratchetId i bitId, jeÅ›li chcesz wymusiÄ‡ ponowny wybÃ³r
                    // currentDeckBeingBuilt.sets[setIndex].ratchetId = null;
                    // currentDeckBeingBuilt.sets[setIndex].bitId = null;

                    // Prerenderuj tylko sloty aktywnego zestawu i zaktualizuj jego statystyki
                    renderActiveDeckSetSlots();
                    // updateDeckStatsForSetInBuilder jest juÅ¼ wywoÅ‚ywane w renderActiveDeckSetSlots
                    console.log(`Zmieniono seriÄ™ dla zestawu ${setIndex + 1} na ${nowaSeria}.`);
                }


            function fillDeckSlotsFromCurrentBuild() {
                const magazyn = getMagazyn();
                if (!currentDeckBeingBuilt || !currentDeckBeingBuilt.sets) {
                    console.warn("PrÃ³ba wypeÅ‚nienia slotÃ³w, ale currentDeckBeingBuilt nie jest gotowy.");
                    return;
                }

                currentDeckBeingBuilt.sets.forEach((set, setIndex) => {
                    if (!set) { // JeÅ›li zestaw jest null (co nie powinno siÄ™ zdarzyÄ‡ przy dobrej inicjalizacji)
                        console.warn(`Zestaw o indeksie ${setIndex} jest null w fillDeckSlotsFromCurrentBuild.`);
                        // MoÅ¼na by tu sprÃ³bowaÄ‡ zainicjalizowaÄ‡ ten konkretny zestaw, jeÅ›li to konieczne
                        // currentDeckBeingBuilt.sets[setIndex] = initializeOrResetCurrentDeck().sets[0]; // PrzykÅ‚adowo
                        return;
                    }

                    const partTypes = getPartTypesForSeria(set.seria);
                    partTypes.forEach(partTypeInfo => {
                        const slotSelector = `.deck-part-slot[data-set-index="${setIndex}"][data-slot-type="${partTypeInfo.type}"]`;
                        const slotDiv = document.querySelector(slotSelector);
                        if (!slotDiv) {
                            console.warn(`Nie znaleziono slotu w DOM: ${slotSelector}`);
                            return;
                        }

                        let partId = null;
                        const partIdKey = getPartIdKeyForSlot(partTypeInfo.type, set.seria);
                        if (partIdKey && set.hasOwnProperty(partIdKey)) {
                            partId = set[partIdKey];
                        }

                        if (partId) {
                            const partDetails = magazyn.find(p => p.id === partId);
                            if (partDetails) {
                                let slotImageHTML;
                                if (partDetails.img && partDetails.img.trim() !== "") {
                                    slotImageHTML = `<img src="${partDetails.img}" alt="${partDetails.nazwa}" style="width: 50px; height: 50px; object-fit: contain; border-radius: 4px;">`;
                                } else {
                                    slotImageHTML = `<div class="dnd-slot-placeholder">Brak<br>Obr.</div>`;
                                }

                                slotDiv.innerHTML = `
                                    <div class="part-info-container">
                                        ${slotImageHTML}
                                        <span class="part-name">${partDetails.nazwa}</span>
                                    </div>
                                    <button class="remove-part-btn" title="UsuÅ„ czÄ™Å›Ä‡">&times;</button>
                                `;
                                slotDiv.classList.add('filled');
                                slotDiv.dataset.currentPartId = partId;
                                slotDiv.querySelector('.remove-part-btn').addEventListener('click', () => removePartFromSlot(setIndex, partTypeInfo.type));
                            } else {
                                slotDiv.innerHTML = `<span>UpuÅ›Ä‡ ${partTypeInfo.label} tutaj (ID: ${partId} nie znalezione)</span>`;
                                slotDiv.classList.remove('filled');
                                delete slotDiv.dataset.currentPartId;
                                // Opcjonalnie: wyczyÅ›Ä‡ ID w modelu, jeÅ›li czÄ™Å›Ä‡ nie istnieje w magazynie
                                // if (partIdKey) currentDeckBeingBuilt.sets[setIndex][partIdKey] = null;
                            }
                        } else {
                            slotDiv.innerHTML = `<span>UpuÅ›Ä‡ ${partTypeInfo.label} tutaj</span>`;
                            slotDiv.classList.remove('filled');
                            delete slotDiv.dataset.currentPartId;
                        }
                    });
                });
            }


            // =================================
            // Drag and Drop - Event Handlers
            // =================================
            let draggedItemData = null; // Przechowuje dane przeciÄ…ganego elementu

            function handleDragStart(event) {
                try {
                    draggedItemData = JSON.parse(event.target.dataset.partData);
                    event.dataTransfer.setData("text/plain", draggedItemData.id); // Potrzebne dla Firefoxa
                    event.dataTransfer.effectAllowed = "move";
                    event.target.classList.add('dragging');
                    console.log("DragStart:", draggedItemData);
                } catch (e) {
                    console.error("BÅ‚Ä…d w handleDragStart podczas parsowania JSON:", e, "Dane:", event.target.dataset.partData);
                    draggedItemData = null;
                    event.preventDefault(); // Anuluj przeciÄ…ganie, jeÅ›li dane sÄ… zÅ‚e
                }
            }

            function handleDragOver(event) {
                event.preventDefault();
                event.dataTransfer.dropEffect = "move";
                event.currentTarget.classList.add('drag-over-target');
            }

            function handleDragEnter(event) {
                event.preventDefault();
                event.currentTarget.classList.add('drag-over-target');
            }

            function handleDragLeave(event) {
                event.currentTarget.classList.remove('drag-over-target');
            }
            // ===>>> OSTATECZNA I POPRAWNA WERSJA FUNKCJI handleDrop <<<===
           function handleDrop(event) {
    event.preventDefault();
    event.currentTarget.classList.remove('drag-over-target');

    if (!draggedItemData) return;

    const dropZone = event.currentTarget;
    const setArrayIndex = parseInt(dropZone.dataset.setIndex);
    const slotType = dropZone.dataset.slotType;
    const magazyn = getMagazyn();

    if (isNaN(setArrayIndex) || !currentDeckBeingBuilt.sets[setArrayIndex]) {
        draggedItemData = null;
        return;
    }

    const targetSet = currentDeckBeingBuilt.sets[setArrayIndex];
    const partActualType = draggedItemData.typ;
    const normalizedSlotType = slotType.replace(/_/g, '-');

    // --- POCZÄ„TEK NOWEJ LOGIKI WALIDACJI DLA CLOCK MIRAGE ---

    // SCENARIUSZ 1: Upuszczamy RATCHET do zestawu, w ktÃ³rym MOÅ»E BYÄ† ClockMirage
    if (normalizedSlotType === 'rachet' && targetSet.bladeId === ID_CLOCK_MIRAGE) {
        const upuszczanyRatchet = magazyn.find(p => p.id === draggedItemData.id);
        const czyRatchetKompatybilny = upuszczanyRatchet && (upuszczanyRatchet.nazwa.match(/-\d*5$/) || upuszczanyRatchet.nazwa.match(/^M-\d*5$/));

        if (!czyRatchetKompatybilny) {
            showNotification('BÅ‚Ä…d: Ten Ratchet nie jest kompatybilny z ClockMirage. UÅ¼yj Racheta "Simple" (np. 9-65).', 5000, 'error');
            draggedItemData = null; // Zresetuj, aby zakoÅ„czyÄ‡ operacjÄ™
            return; // Zablokuj upuszczenie
        }
    }

    // SCENARIUSZ 2: Upuszczamy BLADE (ktÃ³ry moÅ¼e byÄ‡ ClockMirage) do zestawu, w ktÃ³rym JEST JUÅ» Ratchet
    if ((normalizedSlotType === 'blade' || normalizedSlotType === 'ux-blade') && draggedItemData.id === ID_CLOCK_MIRAGE && targetSet.ratchetId) {
        const istniejacyRatchet = magazyn.find(p => p.id === targetSet.ratchetId);
        const czyIstniejacyRatchetKompatybilny = istniejacyRatchet && (istniejacyRatchet.nazwa.match(/-\d*5$/) || istniejacyRatchet.nazwa.match(/^M-\d*5$/));

        if (!czyIstniejacyRatchetKompatybilny) {
            showNotification(`BÅ‚Ä…d: Nie moÅ¼na tu umieÅ›ciÄ‡ ClockMirage. W zestawie jest juÅ¼ niekompatybilny Ratchet "${istniejacyRatchet.nazwa}".`, 5000, 'error');
            draggedItemData = null; // Zresetuj
            return; // Zablokuj upuszczenie
        }
    }
    // --- KONIEC NOWEJ LOGIKI WALIDACJI ---


    let isTypeValid = false;
    if (normalizedSlotType === 'blade' && (partActualType === 'blade' || partActualType === 'ux-blade')) {
        isTypeValid = true;
    } else if (normalizedSlotType === partActualType) {
        isTypeValid = true;
    }

    if (!isTypeValid) {
        const slotLabelElement = dropZone.querySelector('span');
        const slotLabel = slotLabelElement ? slotLabelElement.textContent.replace('UpuÅ›Ä‡ ', '').replace(' tutaj', '') : slotType;
        showNotification(`Nie moÅ¼na umieÅ›ciÄ‡ czÄ™Å›ci typu "${partActualType}" w slocie na "${slotLabel}".`, 4000, 'warning');
        draggedItemData = null;
        return;
    }

    const newPartId = draggedItemData.id;
    const newPartDetails = magazyn.find(p => p.id === newPartId);
    if (!newPartDetails) {
        showNotification("Nie znaleziono czÄ™Å›ci w magazynie.", 3000, 'error');
        draggedItemData = null;
        return;
    }

    const partIdKey = getPartIdKeyForSlot(normalizedSlotType, targetSet.seria);
    if (!partIdKey) {
        showNotification("NieprawidÅ‚owy typ slotu â€“ brak klucza ID.", 3000, 'error');
        draggedItemData = null;
        return;
    }
    
    // --- NOWA, DODATKOWA LOGIKA: Czyszczenie niekompatybilnych czÄ™Å›ci po udanym dropie ---
    // JeÅ›li upuÅ›ciliÅ›my ClockMirage, a w slocie Ratchet byÅ‚a czÄ™Å›Ä‡, ktÃ³ra przeszÅ‚a walidacjÄ™, to wszystko jest OK.
    // Ale jeÅ›li upuÅ›ciliÅ›my ZWYKÅY Blade, a w slocie Ratchet byÅ‚ "Simple" (np. 9-65), warto go wyczyÅ›ciÄ‡, by uniknÄ…Ä‡ pomyÅ‚ek.
    if ((normalizedSlotType === 'blade' || normalizedSlotType === 'ux-blade') && draggedItemData.id !== ID_CLOCK_MIRAGE && targetSet.ratchetId) {
        const istniejacyRatchet = magazyn.find(p => p.id === targetSet.ratchetId);
         if (istniejacyRatchet && (istniejacyRatchet.nazwa.match(/-\d*5$/) || istniejacyRatchet.nazwa.match(/^M-\d*5$/))) {
            targetSet.ratchetId = null; // WyczyÅ›Ä‡ niekompatybilny Ratchet
            showNotification(`UsuniÄ™to Ratchet "${istniejacyRatchet.nazwa}", poniewaÅ¼ nie jest on w peÅ‚ni kompatybilny ze standardowymi Blade'ami.`, 4000, 'info');
        }
    }
    
    // Zapisz ID upuszczonej czÄ™Å›ci
    targetSet[partIdKey] = newPartId;

    const trybIndexKey = partIdKey.replace('Id', 'AktywnyTrybIndex');
    targetSet[trybIndexKey] = draggedItemData.aktywnyTrybIndex ?? 0;

    console.log(`Zaktualizowano zestaw ${setArrayIndex + 1}:`, JSON.parse(JSON.stringify(targetSet)));

    renderActiveDeckSetSlots();
    draggedItemData = null;
}

            function handleDragEnd(event) {
                event.target.classList.remove('dragging');
                draggedItemData = null; // Zawsze resetuj na koÅ„cu przeciÄ…gania
            }

            function getPartIdKeyForSlot(slotType, seria) {
                // UsuniÄ™to wszystkie `if`, zastÄ…pione prostÄ… mapÄ…, ktÃ³ra jest niezawodna.
                const keyMap = {
                    'blade': 'bladeId',
                    'rachet': 'ratchetId',
                    'bit': 'bitId',
                    'cx-lock-chip': 'cx_lock_chipId',
                    'cx-main-blade': 'cx_main_bladeId',
                    'cx-assist-blade': 'cx_assist_bladeId'
                };

                // Normalizujemy wejÅ›ciowy slotType, aby upewniÄ‡ siÄ™, Å¼e nie ma w nim podkreÅ›lnikÃ³w.
                const normalizedSlotType = String(slotType).replace(/_/g, '-');

                // Zwracamy klucz z mapy. JeÅ›li nie zostanie znaleziony, zwrÃ³ci `undefined`, co jest ok.
                return keyMap[normalizedSlotType] || null;
            }


            function removePartFromSlot(setArrayIndex, slotType) {
                if (isNaN(setArrayIndex) || !currentDeckBeingBuilt || !currentDeckBeingBuilt.sets[setArrayIndex]) {
                    console.error("BÅ‚Ä…d w removePartFromSlot: NieprawidÅ‚owy indeks zestawu lub brak danych.");
                    return;
                }

                const targetSet = currentDeckBeingBuilt.sets[setArrayIndex];
                const partIdKey = getPartIdKeyForSlot(slotType, targetSet.seria);

                if (partIdKey && targetSet.hasOwnProperty(partIdKey) && targetSet[partIdKey] !== null) {
                    console.log(`Usuwanie czÄ™Å›ci (ID: ${targetSet[partIdKey]}) ze slotu ${slotType} w zestawie ${setArrayIndex + 1}`);
                    targetSet[partIdKey] = null; // UsuÅ„ ID czÄ™Å›ci z modelu

                    // Po usuniÄ™ciu czÄ™Å›ci (zwÅ‚aszcza jeÅ›li to byÅ‚ Ratchet, ktÃ³ry mÃ³gÅ‚ wpÅ‚ywaÄ‡ na stan slotu Bit),
                    // odÅ›wieÅ¼ caÅ‚e sloty aktywnego zestawu.
                    // renderActiveDeckSetSlots zajmie siÄ™ aktualizacjÄ… UI i statystyk.
                    renderActiveDeckSetSlots();

                    // Nie ma potrzeby wywoÅ‚ywaÄ‡ tu updateDeckStatsForSetInBuilder,
                    // poniewaÅ¼ renderActiveDeckSetSlots juÅ¼ to robi.
                } else {
                    console.warn(`PrÃ³ba usuniÄ™cia czÄ™Å›ci ze slotu ${slotType} w zestawie ${setArrayIndex + 1}, ale slot byÅ‚ juÅ¼ pusty lub klucz nieprawidÅ‚owy.`);
                }
            }

            // =================================
            // Deck Builder - Statystyki i Zapis
            // =================================
            function updateDeckStatsForSetInBuilder(displaySetNumber) {
                const setArrayIndex = displaySetNumber - 1;
                if (!currentDeckBeingBuilt.sets[setArrayIndex]) return;

                const setConfig = currentDeckBeingBuilt.sets[setArrayIndex];
                const magazyn = getMagazyn();

                const getPartDetailsWithMode = (partId, activeModeIndexKey) => {
                    if (!partId) return null;
                    const part = magazyn.find(p => p.id === partId);
                    if (!part) return null;

                    const activeModeIndex = setConfig[activeModeIndexKey] || 0;

                    if (part.maTryby && Array.isArray(part.tryby) && part.tryby[activeModeIndex]) {
                        const basePart = { ...part };
                        delete basePart.tryby;
                        const activeModeData = part.tryby[activeModeIndex];
                        return { ...basePart, ...activeModeData };
                    }
                    return part;
                };

                let czesciDoObliczen = {};
                if (setConfig.seria === 'bx_ux') {
                    czesciDoObliczen.blade = getPartDetailsWithMode(setConfig.bladeId, 'bladeAktywnyTrybIndex');
                    czesciDoObliczen.rachet = getPartDetailsWithMode(setConfig.ratchetId, 'ratchetAktywnyTrybIndex');
                    czesciDoObliczen.bit = getPartDetailsWithMode(setConfig.bitId, 'bitAktywnyTrybIndex');
                } else if (setConfig.seria === 'cx') {
                    czesciDoObliczen.cx_lock_chip = getPartDetailsWithMode(setConfig.cx_lock_chipId, 'cx_lock_chipAktywnyTrybIndex');
                    czesciDoObliczen.cx_main_blade = getPartDetailsWithMode(setConfig.cx_main_bladeId, 'cx_main_bladeAktywnyTrybIndex');
                    czesciDoObliczen.cx_assist_blade = getPartDetailsWithMode(setConfig.cx_assist_bladeId, 'cx_assist_bladeAktywnyTrybIndex');
                    czesciDoObliczen.rachet = getPartDetailsWithMode(setConfig.ratchetId, 'ratchetAktywnyTrybIndex');
                    czesciDoObliczen.bit = getPartDetailsWithMode(setConfig.bitId, 'bitAktywnyTrybIndex');
                }

                const obliczoneStatystyki = obliczSumeStatystykZestawu(czesciDoObliczen, setConfig.seria);
                currentDeckBeingBuilt.sets[setArrayIndex].statystykiObliczone = obliczoneStatystyki;

                const statsDiv = document.getElementById(`deck-stats-${displaySetNumber}`);
                if (statsDiv) {
                    let statsTextHTML = ``;
                    statsTextHTML += `<b>SUMA (${setConfig.seria.toUpperCase().replace('_','/')}):</b> `;
                    statsTextHTML += `ATK: ${obliczoneStatystyki.ATK}, DEF: ${obliczoneStatystyki.DEF}, STM: ${obliczoneStatystyki.STM}, Waga: ${obliczoneStatystyki.WAGA}g`;
                    const jestSpecjalnyRatchet = czesciDoObliczen.rachet && (String(czesciDoObliczen.rachet.id) === "205" || czesciDoObliczen.rachet.integrujeBit === true);
                    if ((setConfig.seria === 'bx_ux' && !jestSpecjalnyRatchet && czesciDoObliczen.bit) || (setConfig.seria === 'cx' && !jestSpecjalnyRatchet && czesciDoObliczen.bit) || jestSpecjalnyRatchet) {
                        if (obliczoneStatystyki.DASH !== 0) statsTextHTML += `, DASH: ${obliczoneStatystyki.DASH}`;
                        if (obliczoneStatystyki.B_RES !== 0) statsTextHTML += `, B-RES: ${obliczoneStatystyki.B_RES}`;
                    }
                    if (setConfig.seria === 'cx' && obliczoneStatystyki.CX_LC_WYTRZ !== 0) {
                        statsTextHTML += `, LC-W: ${obliczoneStatystyki.CX_LC_WYTRZ}`;
                    }
                    statsDiv.innerHTML = statsTextHTML;
                }
                return obliczoneStatystyki;
            }

            function saveCurrentDeck() {
                const deckNameInput = document.getElementById('deckName');
                const deckName = deckNameInput ? deckNameInput.value.trim() : (currentDeckBeingBuilt.name || '');

                if (!deckName && !currentEditingDeckId) {
                    showNotification("Wpisz nazwÄ™ dla nowego decku.", 3000, 'warning');
                    deckNameInput?.focus();
                    return;
                }

                const nonEmptySets = currentDeckBeingBuilt.sets.filter(set => {
                    if (!set) return false;
                    return set.bladeId || set.ratchetId || set.bitId || set.cx_lock_chipId || set.cx_main_bladeId || set.cx_assist_bladeId;
                });

                if (nonEmptySets.length === 0 && !currentEditingDeckId) {
                    showNotification("Nie skonfigurowano Å¼adnych czÄ™Å›ci w Å¼adnym zestawie.", 3000, 'warning');
                    return;
                }

                // ==========================================================
                // === OSTATECZNA, POPRAWIONA WALIDACJA DUPLIKATÃ“W (v3) ===
                // ==========================================================
                const magazyn = getMagazyn();
                let bladWalidacji = '';

                // --- Krok 1: Walidacja Clock Mirage (bez zmian) ---
                for (const set of nonEmptySets) {
                    if (set.seria === 'bx_ux' && set.bladeId === ID_CLOCK_MIRAGE && set.ratchetId) {
                        const ratchetDetails = magazyn.find(p => p.id === set.ratchetId);
                        if (ratchetDetails && !(ratchetDetails.nazwa.match(/-\d*5$/) || ratchetDetails.nazwa.match(/^M-\d*5$/))) {
                            bladWalidacji = `BÅ‚Ä…d w zestawie: Clock Mirage jest poÅ‚Ä…czony z niekompatybilnym Ratchetem.`;
                            break;
                        }
                    }
                }
                if (bladWalidacji) {
                    showNotification(bladWalidacji, 6000, 'error');
                    return;
                }

                // --- Krok 2: Uproszczona walidacja duplikatÃ³w ---
                const czesciPodlegajaceReguleUnikalnosci = [];
                nonEmptySets.forEach(set => {
                    const czesciWzestawie = [
                        set.bladeId, set.ratchetId, set.bitId, set.cx_lock_chipId,
                        set.cx_main_bladeId, set.cx_assist_bladeId
                    ];

                    czesciWzestawie.forEach(partId => {
                        if (!partId) return; // PomiÅ„ puste sloty

                        const partDetails = magazyn.find(p => p.id === partId);
                        if (!partDetails) return; // PomiÅ„, jeÅ›li czÄ™Å›Ä‡ nie istnieje

                        // DODAJ DO LISTY TYLKO TE CZÄ˜ÅšCI, KTÃ“RE MUSZÄ„ BYÄ† UNIKALNE
                        // Ignorujemy zwykÅ‚e Lock Chipy (te, ktÃ³re nie majÄ… flagi 'jestMetalowy')
                        const isRegularLockChip = partDetails.typ === 'cx-lock-chip' && !partDetails.jestMetalowy;

                        if (!isRegularLockChip) {
                            czesciPodlegajaceReguleUnikalnosci.push(partDetails);
                        }
                    });
                });

                // --- Krok 3: Sprawdzenie, czy na przefiltrowanej liÅ›cie sÄ… duplikaty ---
                const idList = czesciPodlegajaceReguleUnikalnosci.map(p => p.id);
                const uniqueIds = new Set(idList);

                if (uniqueIds.size < idList.length) {
                    // ZnajdÅº pierwszy duplikat, aby go wyÅ›wietliÄ‡ w komunikacie
                    const duplikat = idList.find((id, index) => idList.indexOf(id) !== index);
                    const nazwaDuplikatu = magazyn.find(p => p.id === duplikat)?.nazwa || 'Nieznana czÄ™Å›Ä‡';
                    bladWalidacji = `BÅ‚Ä…d reguÅ‚: CzÄ™Å›Ä‡ "${nazwaDuplikatu}" nie moÅ¼e siÄ™ powtarzaÄ‡ w decku.`;
                }

                if (bladWalidacji) {
                    showNotification(bladWalidacji, 4000, 'error');
                    return;
                }
                // ==========================================================
                // === KONIEC OSTATECZNEJ WALIDACJI ===
                // ==========================================================

                // Reszta funkcji zapisu pozostaje bez zmian
                const setsToSave = nonEmptySets.map(set => {
                    const cleanSet = { ...set };
                    const originalIndex = currentDeckBeingBuilt.sets.findIndex(s => s === set);
                    if (originalIndex !== -1) {
                        cleanSet.statystykiObliczone = updateDeckStatsForSetInBuilder(originalIndex + 1);
                    }
                    return cleanSet;
                });

                let savedDecks = getSavedDecks();
                const finalDeckName = deckName || (currentEditingDeckId ? savedDecks.find(d => d.id === currentEditingDeckId)?.name : `Deck ${new Date().toLocaleTimeString('pl-PL')}`);

                const deckToSave = {
                    id: currentEditingDeckId || currentDeckBeingBuilt.id,
                    name: finalDeckName,
                    sets: setsToSave,
                    timestamp: currentEditingDeckId ? (savedDecks.find(d => d.id === currentEditingDeckId)?.timestamp || Date.now()) : Date.now(),
                    lastModified: Date.now()
                };

                if (currentEditingDeckId) {
                    const deckIndex = savedDecks.findIndex(d => d.id === currentEditingDeckId);
                    if (deckIndex > -1) {
                        savedDecks[deckIndex] = deckToSave;
                        showNotification(`Deck "${finalDeckName}" zaktualizowany!`, 3000, 'success');
                    } else {
                        savedDecks.push(deckToSave);
                        showNotification(`Deck "${finalDeckName}" zapisany (jako nowy)!`, 3000, 'success');
                    }
                } else {
                    savedDecks.push(deckToSave);
                    showNotification(`Deck "${finalDeckName}" zapisany!`, 3000, 'success');
                }

                setSavedDecks(savedDecks);
                checkAllAchievements();
                clearCurrentDeckForBuilder();
            }

            // ======================================================================
            // ======================================================================
            // === OSTATECZNA, KOMPLETNA I POPRAWNA WERSJA displaySavedDecks() ===
            // ======================================================================
            function displaySavedDecks() {
                const container = document.getElementById('savedDecksContainer');
                if (!container) return;
                container.innerHTML = '';
                const savedDecks = getSavedDecks();
                if (!savedDecks || savedDecks.length === 0) {
                    container.innerHTML = '<div class="card" style="grid-column: 1 / -1; text-align: center;"><p>Nie masz zapisanych deckÃ³w.</p></div>';
                    return;
                }

                savedDecks.sort((a, b) => (b.lastModified || b.timestamp || 0) - (a.lastModified || a.timestamp || 0));
                const magazynCzesci = getMagazyn();
                const iconMap = {
                    seria: { 'bx_ux': 'img/bx.webp', 'cx': 'img/cx.webp' },
                    rodzaj: { 'atak': 'img/attack.webp', 'obrona': 'img/defence.webp', 'wytrzymalosc': 'img/stamina.webp', 'balans': 'img/balance.webp' },
                    kierunek: { 'prawy': 'img/prawo.png', 'lewy': 'img/lewo.png', 'oba': 'img/dual.png' }
                };
                const backgroundSymbolMap = { 'bx': 'img/bx.webp', 'ux': 'img/ux.webp', 'cx': 'img/cx.webp' };

                savedDecks.forEach(deck => {
                    if (!deck || !deck.id || !Array.isArray(deck.sets)) return;
                    const deckCard = document.createElement('div');
                    deckCard.className = 'card saved-deck-card';
                    deckCard.dataset.deckId = deck.id;

                    let setsHTML = '';
                    deck.sets.forEach((set, index) => {
                        if (!set) return;

                        const seriaZestawu = set.seria || 'bx_ux';
                        const blade = set.bladeId ? magazynCzesci.find(p => p.id === set.bladeId) : null;
                        let bgSymbolUrl = (seriaZestawu === 'cx') ? backgroundSymbolMap['cx'] : ((blade && blade.typ === 'ux-blade') ? backgroundSymbolMap['ux'] : backgroundSymbolMap['bx']);

                        let ikonaSeriiHTML = '', ikonaSeriiUX_HTML = '', ikonaRodzajuHTML = '', ikonaKierunkuHTML = '';
                        if (seriaZestawu === 'bx_ux') { if (blade && blade.typ === 'ux-blade') ikonaSeriiUX_HTML = `<img src="img/ux.webp" class="set-icon" title="Seria: UX">`; else ikonaSeriiHTML = `<img src="${iconMap.seria['bx_ux']}" class="set-icon" title="Seria: BX">`; } else if (seriaZestawu === 'cx') ikonaSeriiHTML = `<img src="${iconMap.seria['cx']}" class="set-icon" title="Seria: CX">`;
                        const ratchet = set.ratchetId ? magazynCzesci.find(p => p.id === set.ratchetId) : null;
                        const bit = set.bitId ? magazynCzesci.find(p => p.id === set.bitId) : null;
                        let partWithRodzaj = (ratchet && ratchet.integrujeBit === true) ? ratchet : bit;
                        if (partWithRodzaj && partWithRodzaj.rodzaj) ikonaRodzajuHTML = `<img src="${iconMap.rodzaj[partWithRodzaj.rodzaj] || ''}" class="set-icon" title="Typ: ${partWithRodzaj.rodzaj}">`;
                        let ostrze = (seriaZestawu === 'cx') ? (set.cx_main_bladeId ? magazynCzesci.find(p => p.id === set.cx_main_bladeId) : null) : blade;
                        if (ostrze && ostrze.kierunek) ikonaKierunkuHTML = `<img src="${iconMap.kierunek[ostrze.kierunek] || ''}" class="set-icon" title="Obroty: ${ostrze.kierunek}">`;

                        const naglowekHTML = `<div class="set-header-container"><strong style="text-transform: capitalize;">Zestaw ${index + 1}</strong><div class="set-icons-container">${ikonaSeriiHTML}${ikonaSeriiUX_HTML}${ikonaRodzajuHTML}${ikonaKierunkuHTML}</div></div>`;

                        const getPartDetailsAndHTML = (partId, partType, partTypeDefaultName) => {
                            const part = partId ? magazynCzesci.find(p => String(p.id) == String(partId)) : null;
                            let obrazekDoWyswietlenia = part?.img, nazwaDoWyswietlenia = part?.nazwa;
                            if (part && part.maTryby && Array.isArray(part.tryby)) {
                                const partIdKey = getPartIdKeyForSlot(partType, seriaZestawu), trybIndexKey = partIdKey ? partIdKey.replace('Id', 'AktywnyTrybIndex') : null;
                                const zapisanyIndex = (trybIndexKey && set[trybIndexKey] !== undefined) ? set[trybIndexKey] : 0;
                                const aktywnyTryb = part.tryby[zapisanyIndex];
                                if (aktywnyTryb) { obrazekDoWyswietlenia = aktywnyTryb.img || part.img; nazwaDoWyswietlenia = `${part.nazwa} (${aktywnyTryb.nazwaTrybu})`; }
                            }
                            const imgHTML = obrazekDoWyswietlenia ? `<img src="${obrazekDoWyswietlenia}" alt="${part?.nazwa || partTypeDefaultName}" class="deck-part-img">` : `<div class="deck-part-placeholder">${partTypeDefaultName.substring(0,3).toUpperCase()}</div>`;
                            return `<div class="part-with-name">${imgHTML}<span class="part-name-label">${nazwaDoWyswietlenia || 'Brak czÄ™Å›ci'}</span></div>`;
                        };

                        const czySpecjalnyRatchetWDecku = ratchet && (String(ratchet.id) === "205" || ratchet.integrujeBit === true);
                        let setImagesAndNamesHTML = '';
                        if (seriaZestawu === 'bx_ux') {
                            setImagesAndNamesHTML = `<div class="wynik-zestaw-obrazki">${getPartDetailsAndHTML(set.bladeId, 'blade', 'Blade')}${getPartDetailsAndHTML(set.ratchetId, 'rachet', 'Ratchet')}${czySpecjalnyRatchetWDecku ? `<div class="part-with-name"><img src="img/bitturbo.png" alt="Bit Zintegrowany" class="deck-part-img" title="Bit zintegrowany"><span class="part-name-label">(Bit zint.)</span></div>` : getPartDetailsAndHTML(set.bitId, 'bit', 'Bit')}</div>`;
                        } else if (seriaZestawu === 'cx') {
                            setImagesAndNamesHTML = `<div class="cx-images-container"><div class="cx-blade-row wynik-zestaw-obrazki">${getPartDetailsAndHTML(set.cx_lock_chipId, 'cx-lock-chip', 'LockChip')}${getPartDetailsAndHTML(set.cx_main_bladeId, 'cx-main-blade', 'MainBlade')}${getPartDetailsAndHTML(set.cx_assist_bladeId, 'cx-assist-blade', 'AssistBlade')}</div><div class="cx-drive-row wynik-zestaw-obrazki">${getPartDetailsAndHTML(set.ratchetId, 'rachet', 'Ratchet')}${czySpecjalnyRatchetWDecku ? `<div class="part-with-name"><img src="img/bitturbo.png" alt="Bit Zintegrowany" class="deck-part-img" title="Bit zintegrowany"><span class="part-name-label">(Bit zint.)</span></div>` : getPartDetailsAndHTML(set.bitId, 'bit', 'Bit')}</div></div>`;
                        }

                        let setStatsSummaryHTML = '<div class="stat-grid">';
                        const stats = set.statystykiObliczone;
                        if (stats) {
                            setStatsSummaryHTML += `<span>ATK: ${stats.ATK || 0}</span><span>DEF: ${stats.DEF || 0}</span><span>STM: ${stats.STM || 0}</span><span>Waga: ${(stats.WAGA || 0)}g</span>`;
                            if ((stats.DASH || 0) !== 0) setStatsSummaryHTML += `<span>DASH: ${stats.DASH || 0}</span>`;
                            if ((stats.B_RES || 0) !== 0) setStatsSummaryHTML += `<span>B-RES: ${stats.B_RES || 0}</span>`;
                            if (seriaZestawu === 'cx' && (stats.CX_LC_WYTRZ || 0) !== 0) setStatsSummaryHTML += `<span>LC-W: ${stats.CX_LC_WYTRZ || 0}</span>`;
                        } else {
                            setStatsSummaryHTML += '<span>Brak danych statystyk</span>';
                        }
                        setStatsSummaryHTML += `</div>`;
                        const chartCanvasId = `chart-deck-${deck.id}-set-${index}`;

                        // --- KLUCZOWA POPRAWKA STRUKTURY HTML ---
                        setsHTML += `
                            <div class="deck-card-set-preview" style="--bg-symbol-url: url('${bgSymbolUrl}');">
                                ${naglowekHTML}
                                ${setImagesAndNamesHTML}
                                <div class="set-preview-with-chart">
                                    <div class="set-info-wrapper">
                                        ${setStatsSummaryHTML}
                                    </div>
                                    <div class="set-chart-container">
                                        <canvas id="${chartCanvasId}"></canvas>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    const actionsHTML = `<div class="item-actions"><button onclick="edytujDeck('${deck.id}')">Edytuj</button><button onclick="eksportujDeckDoPNG('${deck.id}')">PNG</button><button class="danger-btn" onclick="usunZapisanyDeck('${deck.id}')">UsuÅ„</button></div>`;
                    deckCard.innerHTML = `<h4>${deck.name || 'Deck bez nazwy'}</h4><p style="font-size: 0.75em; color: #aaa; margin-top: 0; margin-bottom:15px;">${deck.lastModified ? `Modyfikacja: ${new Date(deck.lastModified).toLocaleDateString('pl-PL')}` : `Zapisano: ${new Date(deck.timestamp || Date.now()).toLocaleDateString('pl-PL')}`}</p>${setsHTML}${actionsHTML}`;
                    container.appendChild(deckCard);
                });

                initializeChartsForSavedDecks(savedDecks);
            }

            // ======================================================================
            // === NOWA, OSOBNA FUNKCJA DO TWORZENIA WYKRESÃ“W ===
            // ======================================================================
            function initializeChartsForSavedDecks(decks) {
                if (typeof Chart === 'undefined') {
                    console.error("Chart.js nie jest zaÅ‚adowany!");
                    return;
                }

                decks.forEach(deck => {
                    if (!deck || !Array.isArray(deck.sets)) return;

                    deck.sets.forEach((set, index) => {
                        const chartId = `chart-deck-${deck.id}-set-${index}`;
                        const ctx = document.getElementById(chartId);
                        if (!ctx) { return; }

                        const stats = set.statystykiObliczone || {};

                        const labels = ['ATK', 'DEF', 'STM', 'Waga', 'DASH', 'B-RES'];
                        const dataValues = [
                            stats.ATK || 0,
                            stats.DEF || 0,
                            stats.STM || 0,
                            stats.WAGA || 0,
                            stats.DASH || 0,
                            stats.B_RES || 0
                        ];

                        const chartConfig = {
                            type: 'radar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Statystyki',
                                    data: dataValues,
                                    backgroundColor: 'rgba(162, 95, 240, 0.3)',
                                    borderColor: 'rgba(180, 120, 255, 1)',
                                    pointBackgroundColor: 'rgba(210, 180, 255, 1)',
                                    pointBorderColor: '#fff',
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                elements: { line: { borderWidth: 2 } },
                                scales: {
                                    r: {
                                        angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                                        grid: { color: 'rgba(255, 255, 255, 0.2)' },
                                        pointLabels: {
                                            color: '#ddd',
                                            font: { family: "'Kode Mono', monospace", size: 10 }
                                        },
                                        ticks: { display: false, stepSize: 25 },
                                        suggestedMin: 0,
                                        suggestedMax: 100
                                    }
                                },
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        bodyFont: { family: "'Kode Mono', monospace" }
                                     }
                                }
                            }
                        };
                        new Chart(ctx, chartConfig);
                    });
                });
            }

            function eksportujDeckDoPNG(deckId) {
                const kartaDecku = document.querySelector(`.saved-deck-card[data-deck-id="${deckId}"]`);
                if (!kartaDecku) {
                    showNotification("BÅ‚Ä…d: Nie znaleziono karty decku do eksportu.", 3000, 'error');
                    return;
                }

                const przyciskiAkcji = kartaDecku.querySelector('.item-actions');
                const nazwaDecku = kartaDecku.querySelector('h4')?.textContent || 'deck_bez_nazwy';
                const nazwaPliku = `${nazwaDecku.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.png`;

                showNotification("PrzygotowujÄ™ obraz PNG...", 2500, 'info');

                // Krok 1: Przygotowanie do eksportu (ukrycie niepotrzebnych elementÃ³w)
                if (przyciskiAkcji) {
                    przyciskiAkcji.style.display = 'none';
                }

                const zestawyWDecku = kartaDecku.querySelectorAll('.deck-card-set-preview');
                // === KLUCZOWA POPRAWKA #1: Inicjalizujemy pustÄ… tablicÄ™ ===
                const dodaneObrazkiTla = [];

                zestawyWDecku.forEach(zestawNode => {
                    // Ukrywamy tÅ‚o z CSS, aby uniknÄ…Ä‡ dublowania
                    zestawNode.classList.add('exporting-png');

                    const stylZestawu = zestawNode.getAttribute('style');
                    if (!stylZestawu) return;

                    const urlMatch = stylZestawu.match(/--bg-symbol-url:\s*url\(['"]?([^'"]+)['"]?\)/);

                    if (urlMatch && urlMatch[1]) {
                        const urlObrazka = urlMatch[1];
                        if (urlObrazka.trim() !== "") {
                            const bgImage = document.createElement('img');
                            bgImage.src = urlObrazka;
                            // Dodajemy klasÄ™, aby CSS mÃ³gÅ‚ nadaÄ‡ style (pozycja, rozmiar)
                            bgImage.className = 'background-symbol-img';

                            // Ustawiamy przezroczystoÅ›Ä‡ bezpoÅ›rednio w JS - to najwaÅ¼niejszy krok wizualny
                            bgImage.style.opacity = '0.15';

                            zestawNode.prepend(bgImage);

                            // === KLUCZOWA POPRAWKA #2: Poprawiona nazwa zmiennej ===
                            // Teraz poprawnie dodajemy obrazek do tablicy, aby go pÃ³Åºniej usunÄ…Ä‡.
                            dodaneObrazkiTla.push(bgImage);
                        }
                    }
                });

                const opcjeRenderowania = {
                    bgcolor: '#101018',
                    cacheBust: true
                };

                // Krok 2: Generowanie obrazu (z opÃ³Åºnieniem)
                setTimeout(() => {
                    domtoimage.toPng(kartaDecku, opcjeRenderowania)
                        .then(function (dataUrl) {
                            // Logika zapisu pliku (bez zmian)
                            if (window.Android && typeof window.Android.zapiszObrazPNG === 'function') {
                                const base64Data = dataUrl.split(',')[1];
                                window.Android.zapiszObrazPNG(base64Data, nazwaPliku);
                                showNotification("Przekazano obraz do zapisu...", 2500, 'success');
                            } else {
                                const link = document.createElement('a');
                                link.download = nazwaPliku;
                                link.href = dataUrl;
                                link.click();
                                showNotification("Eksport do PNG zakoÅ„czony!", 2500, 'success');
                            }
                        })
                        .catch(function (error) {
                            console.error('BÅ‚Ä…d podczas generowania obrazu:', error);
                            showNotification("WystÄ…piÅ‚ bÅ‚Ä…d podczas eksportu do PNG.", 4000, 'error');
                        })
                        .finally(() => {
                            // Krok 3: SprzÄ…tanie po eksporcie (zawsze siÄ™ wykonuje)
                            console.log(`SprzÄ…tanie po eksporcie. Znaleziono ${dodaneObrazkiTla.length} obrazkÃ³w do usuniÄ™cia.`);

                            // Usuwamy dynamicznie dodane obrazki
                            dodaneObrazkiTla.forEach(img => img.remove());

                            // Pokazujemy z powrotem przyciski
                            if (przyciskiAkcji) {
                                przyciskiAkcji.style.display = 'flex';
                            }

                            // Przywracamy widocznoÅ›Ä‡ tÅ‚a z CSS
                            zestawyWDecku.forEach(zestawNode => {
                                zestawNode.classList.remove('exporting-png');
                            });
                        });
                }, 500);
            }

            function edytujDeck(deckId) {
                const savedDecks = getSavedDecks(); // Pobierz najÅ›wieÅ¼szÄ… listÄ™ deckÃ³w
                const deckToEdit = savedDecks.find(d => d.id === deckId);

                if (!deckToEdit) {
                    showNotification("Nie znaleziono decku do edycji.", 3000, 'error');
                    return;
                }

                // Ustaw currentEditingDeckId PRZED nawigacjÄ…, aby navigateTo wiedziaÅ‚o, Å¼e edytujemy
                currentEditingDeckId = deckId;

                // Inicjalizuj currentDeckBeingBuilt z danymi decku do edycji
                // Ta funkcja powinna gÅ‚Ä™boko skopiowaÄ‡ deckToEdit i upewniÄ‡ siÄ™, Å¼e struktura jest kompletna (np. 4 sety)
                initializeOrResetCurrentDeck(deckToEdit);

                // Zawsze zaczynaj edycjÄ™ od wyÅ›wietlenia pierwszej zakÅ‚adki/zestawu
                currentlyActiveSetIndexInBuilder = 0;

                // Ustaw nazwÄ™ decku w polu input
                const deckNameInput = document.getElementById('deckName');
                if (deckNameInput) {
                    deckNameInput.value = deckToEdit.name || '';
                }

                // Nawiguj do strony Deck Buildera
                const linkDoDeckBuildera = document.querySelector('.sidebar a[onclick*="navigateTo(\'deck"]');
                if(linkDoDeckBuildera) {
                    // navigateTo('deck', linkDoDeckBuildera) samo wywoÅ‚a renderDeckBuilderAndParts,
                    // ktÃ³re z kolei uÅ¼yje currentlyActiveSetIndexInBuilder do wyrenderowania odpowiedniej zakÅ‚adki i slotÃ³w.
                    navigateTo('deck', linkDoDeckBuildera);
                } else {
                    showNotification("BÅ‚Ä…d krytyczny: Brak linku nawigacyjnego do Deck Generatora.", 3000, 'error');
                    currentEditingDeckId = null; // Zresetuj tryb edycji, bo nawigacja nieudana
                    initializeOrResetCurrentDeck(); // WyczyÅ›Ä‡ builder
                    return;
                }

                // Po nawigacji i renderowaniu (ktÃ³re dzieje siÄ™ asynchronicznie w navigateTo),
                // zaktualizuj tekst przycisku zapisu i pokaÅ¼ powiadomienie.
                // UÅ¼ywamy setTimeout, aby daÄ‡ DOM czas na aktualizacjÄ™ po wywoÅ‚aniu navigateTo.
                setTimeout(() => {
                    const saveButton = document.getElementById('saveDeckButton');
                    if (saveButton) {
                        saveButton.textContent = 'Zapisz Zmiany w Decku';
                    }
                    showNotification(`Edytujesz deck: "${deckToEdit.name || 'Bez nazwy'}". WyÅ›wietlono Zestaw 1.`, 3500, 'info');

                    // Opcjonalnie: przewiÅ„ do gÃ³ry strony deck buildera lub do nazwy decku
                    const deckBuilderSection = document.getElementById('deck');
                    if (deckBuilderSection) {
                        deckBuilderSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } else if (deckNameInput) {
                        deckNameInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 150); // MaÅ‚e opÃ³Åºnienie, moÅ¼na dostosowaÄ‡ w razie potrzeby
            }

                function usunZapisanyDeck(deckId) {
                    if (!deckId) { showNotification("BÅ‚Ä…d: Brak ID decku.", 3000, 'info'); return; }
                    const savedDecks = getSavedDecks();
                    const deckToDelete = savedDecks.find(deck => deck.id === deckId);

                    if (!deckToDelete) {
                        showNotification("Nie znaleziono decku do usuniÄ™cia.", 3000, 'info');
                        // displaySavedDecks(); // MoÅ¼na odÅ›wieÅ¼yÄ‡, jeÅ›li podejrzewamy niespÃ³jnoÅ›Ä‡ stanu
                        return;
                    }

                    // Logika usuwania wykonywana jest teraz bezpoÅ›rednio:
                    const updatedDecks = savedDecks.filter(deck => deck.id !== deckId);
                    setSavedDecks(updatedDecks);
                    showNotification(`Deck "${deckToDelete.name || 'Bez nazwy'}" usuniÄ™ty.`, 3000, 'info');

                    // OdÅ›wieÅ¼ listÄ™, jeÅ›li jesteÅ›my na stronie galerii
                    if (document.getElementById('galeriaDeckow')?.classList.contains('active')) {
                        displaySavedDecks();
                    }

                    // JeÅ›li edytowany deck zostaÅ‚ usuniÄ™ty, wyczyÅ›Ä‡ builder
                    if (currentEditingDeckId === deckId) {
                        clearCurrentDeckForBuilder();
                    }
                }


            // =================================
            // Import/Eksport Magazynu
            // =================================
            function eksportujDaneDoPolaTekstowego() {
                const magazyn = getMagazyn();
                const poleTekstowe = document.getElementById('poleDanychJsonMagazyn');
                if (poleTekstowe) {
                    if (magazyn && magazyn.length > 0) {
                        try {
                            poleTekstowe.value = JSON.stringify(magazyn, null, 2);
                            showNotification('Dane magazynu skopiowane do pola.', 3000, 'success');
                            poleTekstowe.focus(); poleTekstowe.select();
                        } catch (e) { showNotification('BÅ‚Ä…d konwersji magazynu do JSON.', 3000, 'error'); poleTekstowe.value = 'BÅ‚Ä…d JSON.';}
                    } else { poleTekstowe.value = ''; showNotification('Magazyn jest pusty.', 3000, 'info'); }
                } else showNotification('BÅ‚Ä…d: Pole tekstowe magazynu nie znalezione.', 3000, 'error');
            }

            function importujDaneZPolaTekstowego() {
                const poleTekstowe = document.getElementById('poleDanychJsonMagazyn');
                if (!poleTekstowe || !poleTekstowe.value.trim()) {
                    showNotification('Pole danych magazynu jest puste.', 3000, 'warning'); return;
                }
                let daneDoImportu;
                try { daneDoImportu = JSON.parse(poleTekstowe.value); }
                catch (e) { showNotification('BÅ‚Ä…d importu: NieprawidÅ‚owy JSON w danych magazynu.', 3000, 'error'); console.error("BÅ‚Ä…d parsowania JSON (magazyn):", e); return; }
                przetworzIDopiszDaneMagazynu(daneDoImportu, 'Pole Tekstowe JSON', false); // false = nie zeruj iloÅ›ci
            }

            // Zmodyfikuj sygnaturÄ™ funkcji:
            function przetworzIDopiszDaneMagazynu(daneDoImportu, zrodloDanychOpis, ustawDomyslnaIloscDlaNowychNaZero = false, trybCichy = false) {
                if (!Array.isArray(daneDoImportu)) {
                    if (!trybCichy) showNotification(`BÅ‚Ä…d importu z '${zrodloDanychOpis}': NieprawidÅ‚owy format (oczekiwano tablicy).`, 3000, 'error');
                    console.error(`[IMPORT ERROR] Dane wejÅ›ciowe z '${zrodloDanychOpis}' nie sÄ… tablicÄ…:`, daneDoImportu);
                    return false;
                }

                // Prosta funkcja do tworzenia czystego obiektu czÄ™Å›ci z pliku JSON
                const stworzObiektCzesci = (item) => {
                    if (!item || typeof item !== 'object' || !item.id) return null;

                    const ilosc = ustawDomyslnaIloscDlaNowychNaZero ? 0 : (parseInt(item.ilosc, 10) || 0);

                    // --- NOWA, UPROSZCZONA LOGIKA ---
                    // Zawsze bierzemy wszystkie dane z pliku ÅºrÃ³dÅ‚owego, bez skomplikowanego wypeÅ‚niania.
                    const nowaCzesc = { ...item }; // Kopiujemy wszystkie wÅ‚aÅ›ciwoÅ›ci
                    nowaCzesc.ilosc = ilosc; // Ustawiamy tylko poprawnÄ… iloÅ›Ä‡
                    // --- KONIEC NOWEJ LOGIKI ---

                    return nowaCzesc;
                };

                const czesciImportowaneMap = new Map(
                    daneDoImportu.map(item => stworzObiektCzesci(item)).filter(Boolean).map(czesc => [String(czesc.id), czesc])
                );

                let aktualnyMagazyn = getMagazyn();
                let dodanoNowychCzesci = 0;
                let zaktualizowanoDaneCzesci = 0;

                // PrzejdÅº przez istniejÄ…cy magazyn, zaktualizuj go danymi z importu
                aktualnyMagazyn.forEach(istniejacaCzesc => {
                    const id = String(istniejacaCzesc.id);
                    if (czesciImportowaneMap.has(id)) {
                        const importowanaCzesc = czesciImportowaneMap.get(id);
                        const iloscDoZachowania = ustawDomyslnaIloscDlaNowychNaZero ? istniejacaCzesc.ilosc : importowanaCzesc.ilosc;

                        const finalnaCzesc = { ...importowanaCzesc, ilosc: iloscDoZachowania };

                        // Sprawdzamy, czy dane (oprÃ³cz iloÅ›ci) siÄ™ zmieniÅ‚y
                        if (JSON.stringify({ ...istniejacaCzesc, ilosc: null }) !== JSON.stringify({ ...finalnaCzesc, ilosc: null })) {
                            zaktualizowanoDaneCzesci++;
                        }

                        // Nadpisujemy starÄ… czÄ™Å›Ä‡ w magazynie
                        const index = aktualnyMagazyn.findIndex(c => String(c.id) === id);
                        if (index !== -1) {
                            aktualnyMagazyn[index] = finalnaCzesc;
                        }
                        czesciImportowaneMap.delete(id); // Usuwamy, aby nie dodawaÄ‡ jej ponownie
                    }
                });

                // Dodaj pozostaÅ‚e (nowe) czÄ™Å›ci z mapy importu do magazynu
                if (czesciImportowaneMap.size > 0) {
                    dodanoNowychCzesci = czesciImportowaneMap.size;
                    aktualnyMagazyn.push(...czesciImportowaneMap.values());
                }

                setMagazyn(aktualnyMagazyn);

                // Logika powiadomieÅ„ (bez zmian)
                let msg = '';
                if (dodanoNowychCzesci > 0) msg += `Dodano ${dodanoNowychCzesci} nowych czÄ™Å›ci. `;
                if (zaktualizowanoDaneCzesci > 0) msg += `Zaktualizowano dane dla ${zaktualizowanoDaneCzesci} istniejÄ…cych czÄ™Å›ci. `;

                if (!trybCichy) {
                    if (msg) showNotification(`Import z '${zrodloDanychOpis}' zakoÅ„czony! ${msg.trim()}`, 4500, 'success');
                    else showNotification(`Magazyn jest aktualny.`, 3000, 'info');
                } else {
                    if (msg) console.log(`[TRYB CICHY] Import z '${zrodloDanychOpis}': ${msg.trim()}`);
                    else console.log(`[TRYB CICHY] Magazyn aktualny.`);
                }

                const aktywnaStronaId = document.querySelector('.page.active')?.id;
                if (aktywnaStronaId === 'magazyn') wyswietlMagazyn();
                if (aktywnaStronaId === 'deck') renderDeckBuilderAndParts();

                return (dodanoNowychCzesci > 0 || zaktualizowanoDaneCzesci > 0);
            }

            // Zmodyfikuj sygnaturÄ™ funkcji:
            function importujMagazynZBazyDomyslnejHTML(trybCichy = false) {
                const nazwaZrodla = 'DomyÅ›lna Baza (z HTML)';
                try {
                    const scriptTag = document.getElementById('domyslnaBazaDanychJson');
                    if (!scriptTag) {
                        if (!trybCichy) showNotification("BÅ‚Ä…d: Brak ÅºrÃ³dÅ‚a danych domyÅ›lnych (#domyslnaBazaDanychJson).", 4000, 'error');
                        return false; // Dodano zwracanie wartoÅ›ci
                    }
                    // ... (reszta kodu pobierania JSONa - bez zmian) ...
                    const jsonString = scriptTag.textContent;
                    if (!jsonString || jsonString.trim() === '') {
                        if (!trybCichy) showNotification("BÅ‚Ä…d: DomyÅ›lna baza danych w HTML jest pusta.", 4000, 'error');
                        return false;
                    }
                    let daneDoImportu;
                    try { daneDoImportu = JSON.parse(jsonString); }
                    catch (parseError) {
                        if (!trybCichy) showNotification("BÅ‚Ä…d: NieprawidÅ‚owy JSON w domyÅ›lnej bazie danych.", 5000, 'error');
                        console.error("BÅ‚Ä…d parsowania JSON (baza domyÅ›lna):", parseError);
                        return false;
                    }

                    // true = ustaw iloÅ›Ä‡ na 0 dla nowych czÄ™Å›ci, nie nadpisuj iloÅ›ci istniejÄ…cych na te z bazy (bo tam jest 0)
                    // przekazujemy trybCichy do przetworzIDopiszDaneMagazynu
                    const wynikPrzetwarzania = przetworzIDopiszDaneMagazynu(daneDoImportu, nazwaZrodla, true, trybCichy);
                    return wynikPrzetwarzania; // ZwrÃ³Ä‡ wynik z przetworzIDopiszDaneMagazynu

                } catch (error) {
                    if (!trybCichy) showNotification(`Krytyczny bÅ‚Ä…d importu z domyÅ›lnej bazy: ${error.message}`, 4000, 'error');
                    console.error(error);
                    return false;
                }
            }


            // =================================
            // Import/Eksport DeckÃ³w
            // =================================
            function eksportujDeckiDoPolaTekstowego() {
                const savedDecks = getSavedDecks();
                const poleTekstoweDecki = document.getElementById('poleDanychJsonDecki');
                if (poleTekstoweDecki) {
                    if (savedDecks && savedDecks.length > 0) {
                        try {
                            const jsonString = JSON.stringify(savedDecks, null, 2);
                            poleTekstoweDecki.value = jsonString;
                            showNotification('Zapisane decki skopiowane do pola.', 3000, 'success');
                            poleTekstoweDecki.focus(); poleTekstoweDecki.select();
                        } catch (e) { showNotification('BÅ‚Ä…d konwersji deckÃ³w do JSON.', 3000, 'error'); poleTekstoweDecki.value = 'BÅ‚Ä…d JSON.'; }
                    } else { poleTekstoweDecki.value = ''; showNotification('Brak deckÃ³w do eksportu.', 3000, 'info'); }
                } else showNotification('BÅ‚Ä…d: Pole tekstowe deckÃ³w nie znalezione.', 3000, 'error');
            }

            function walidujIPrzygotujPojedynczyDeckDoDodania(deckObj, defaultNamePrefix = "Importowany Deck") {
                if (!deckObj || typeof deckObj !== 'object') {
                    console.warn("[VALIDATE_DECK_WARN] Dane wejÅ›ciowe nie sÄ… obiektem.", deckObj); return null;
                }
                if (typeof deckObj.id !== 'string' || !deckObj.id.trim() ||
                    !(typeof deckObj.name === 'string' || deckObj.name === null || deckObj.name === undefined) ||
                    !Array.isArray(deckObj.sets)) {
                    console.warn("[VALIDATE_DECK_WARN] NieprawidÅ‚owa struktura decku (ID, nazwa lub zestawy).", deckObj); return null;
                }

                const gotowyDeck = {
                    id: deckObj.id.trim(),
                    name: String(deckObj.name || `${defaultNamePrefix}_${Date.now() % 10000}`).trim(),
                    timestamp: parseInt(deckObj.timestamp, 10) || Date.now(),
                    lastModified: parseInt(deckObj.lastModified, 10) || (parseInt(deckObj.timestamp, 10) || Date.now()),
                    sets: []
                };

                const parseFloatOrZero = (val) => { const num = parseFloat(val); return isNaN(num) ? 0 : num; };
                const parseIntOrZero = (val) => { const num = parseInt(val, 10); return isNaN(num) ? 0 : num; };

                deckObj.sets.forEach((set) => {
                    if (!set || typeof set.seria !== 'string' || !['bx_ux', 'cx'].includes(set.seria)) {
                        console.warn(`[VALIDATE_DECK_WARN_SET] NieprawidÅ‚owy lub brak serii w zestawie decku ID: ${gotowyDeck.id}. Pomijam zestaw.`);
                        return;
                    }

                    const przygotowanyZestaw = {
                        seria: set.seria,
                        bladeId: set.bladeId === undefined ? null : String(set.bladeId || '').trim() || null,
                        ratchetId: set.ratchetId === undefined ? null : String(set.ratchetId || '').trim() || null,
                        bitId: set.bitId === undefined ? null : String(set.bitId || '').trim() || null,
                        cx_lock_chipId: set.cx_lock_chipId === undefined ? null : String(set.cx_lock_chipId || '').trim() || null,
                        cx_main_bladeId: set.cx_main_bladeId === undefined ? null : String(set.cx_main_bladeId || '').trim() || null,
                        cx_assist_bladeId: set.cx_assist_bladeId === undefined ? null : String(set.cx_assist_bladeId || '').trim() || null,
                        statystykiObliczone: {}
                    };

                    if (set.seria === 'bx_ux') {
                        przygotowanyZestaw.cx_lock_chipId = null;
                        przygotowanyZestaw.cx_main_bladeId = null;
                        przygotowanyZestaw.cx_assist_bladeId = null;
                    } else if (set.seria === 'cx') {
                        przygotowanyZestaw.bladeId = null;
                    }

                    if (set.statystykiObliczone && typeof set.statystykiObliczone === 'object') {
                        const stats = set.statystykiObliczone;
                        przygotowanyZestaw.statystykiObliczone = {
                            ATK: parseFloatOrZero(stats.ATK), DEF: parseFloatOrZero(stats.DEF), STM: parseFloatOrZero(stats.STM),
                            WAGA: parseFloatOrZero(stats.WAGA || stats.waga), DASH: parseFloatOrZero(stats.DASH),
                            B_RES: parseFloatOrZero(stats.B_RES || stats.BURST_RES), CX_LC_WYTRZ: parseIntOrZero(stats.CX_LC_WYTRZ)
                        };
                    }
                    gotowyDeck.sets.push(przygotowanyZestaw);
                });

                if (deckObj.sets.length > 0 && gotowyDeck.sets.length === 0) {
                    console.warn(`[VALIDATE_DECK_WARN_NO_VALID_SETS] Deck ID: ${gotowyDeck.id} nie zawieraÅ‚ poprawnych zestawÃ³w. Odrzucam.`);
                    return null;
                }

                console.log(`[VALIDATE_DECK_SUCCESS] Deck ID: ${gotowyDeck.id} zwalidowany z ${gotowyDeck.sets.length} zestawami.`);
                return gotowyDeck;
            }

            function importujDeckiZPolaTekstowego() {
                console.log("[IMPORT_DECK_FIELD_1] RozpoczÄ™to import deckÃ³w z pola tekstowego.");
                const poleTekstoweDecki = document.getElementById('poleDanychJsonDecki');
                if (!poleTekstoweDecki || !poleTekstoweDecki.value.trim()) {
                    showNotification('Pole danych deckÃ³w jest puste.', 3000, 'warning'); return;
                }
                let daneSuroweZInputu;
                try { daneSuroweZInputu = JSON.parse(poleTekstoweDecki.value); }
                catch (e) { showNotification('BÅ‚Ä…d importu: NieprawidÅ‚owy JSON w danych deckÃ³w.', 3000, 'error'); console.error("BÅ‚Ä…d parsowania JSON (decki z pola):", e); return; }

                let deckiDoSprawdzenia;
                if (daneSuroweZInputu && typeof daneSuroweZInputu === 'object' && !Array.isArray(daneSuroweZInputu)) {
                    deckiDoSprawdzenia = [daneSuroweZInputu];
                } else if (Array.isArray(daneSuroweZInputu)) {
                    deckiDoSprawdzenia = daneSuroweZInputu;
                } else {
                    showNotification('BÅ‚Ä…d importu: Dane muszÄ… byÄ‡ listÄ… deckÃ³w lub pojedynczym obiektem decku.', 3000, 'error'); return;
                }

                const istniejaceDecki = getSavedDecks();
                let nowoDodaneDecki = []; let pominieteDuplikatyCount = 0; let bledneFormatyCount = 0;

                deckiDoSprawdzenia.forEach((potencjalnyDeck, index) => {
                    const zwalidowanyDeck = walidujIPrzygotujPojedynczyDeckDoDodania(potencjalnyDeck, `Import z pola #${index + 1}`);
                    if (zwalidowanyDeck) {
                        const indexIstniejacego = istniejaceDecki.findIndex(d => d.id === zwalidowanyDeck.id);
                        if (indexIstniejacego > -1) {
                            pominieteDuplikatyCount++;
                            console.warn(`[IMPORT_DECK_FIELD_WARN_DUPLICATE] Deck ID '${zwalidowanyDeck.id}' ("${zwalidowanyDeck.name}") juÅ¼ istnieje. Pomijam.`);
                        } else {
                            istniejaceDecki.push(zwalidowanyDeck);
                            nowoDodaneDecki.push(zwalidowanyDeck);
                        }
                    } else {
                        bledneFormatyCount++;
                    }
                });

                setSavedDecks(istniejaceDecki);

                let komunikatKoncowy = "";
                if (nowoDodaneDecki.length > 0) komunikatKoncowy += `Dodano ${nowoDodaneDecki.length} nowych deck(Ã³w). `;
                if (pominieteDuplikatyCount > 0) komunikatKoncowy += `${pominieteDuplikatyCount} deck(Ã³w) pominiÄ™to (duplikaty ID). `;
                if (bledneFormatyCount > 0) komunikatKoncowy += `PominiÄ™to ${bledneFormatyCount} nieprawidÅ‚owych deckÃ³w. `;

                if (komunikatKoncowy.trim() === "" && deckiDoSprawdzenia.length > 0) {
                    showNotification('Å»adne nowe decki nie zostaÅ‚y dodane (mogÄ… byÄ‡ duplikatami lub bÅ‚Ä™dami formatu).', 3000, 'info');
                } else if (komunikatKoncowy.trim() === "" && deckiDoSprawdzenia.length === 0) {
                    showNotification('Pole nie zawieraÅ‚o danych deckÃ³w do importu.', 3000, 'info');
                } else {
                    showNotification(`Import deckÃ³w zakoÅ„czony! ${komunikatKoncowy.trim()}`, 4500, 'success');
                }

                if (nowoDodaneDecki.length > 0 && poleTekstoweDecki) poleTekstoweDecki.value = '';

                if (document.getElementById('galeriaDeckow')?.classList.contains('active')) {
                    displaySavedDecks();
                }
                console.log(`[IMPORT_DECK_FIELD_5] ZakoÅ„czono import deckÃ³w. Dodano: ${nowoDodaneDecki.length}, Duplikaty: ${pominieteDuplikatyCount}, BÅ‚Ä™dne: ${bledneFormatyCount}`);
            }

            // =================================
            // Czyszczenie Danych i Inicjalizacja
            // =================================
            function wykonajWyczyszczenieDanych() {
                console.log("Rozpoczynanie peÅ‚nego czyszczenia danych aplikacji...");

                // Czyszczenie localStorage
                localStorage.removeItem(MAGAZYN_KEY);
                localStorage.removeItem(SAVED_DECKS_KEY);
                localStorage.removeItem(SCORES_KEY);
                localStorage.removeItem(DOMYSLNA_BAZA_ZALADOWANA_KEY); // Upewnij siÄ™, Å¼e ta flaga teÅ¼ jest usuwana

                console.log("Klucze localStorage usuniÄ™te.");

                // Resetowanie zmiennych globalnych przechowujÄ…cych stan
                // Magazyn (jeÅ›li jest jakaÅ› zmienna globalna oprÃ³cz localStorage)
                // JeÅ›li np. masz globalnÄ… zmiennÄ… `let aktualnyMagazynGlobalny = []`, zresetuj jÄ…:
                // aktualnyMagazynGlobalny = []; // PrzykÅ‚ad

                // Zapisane Decki (jeÅ›li jest zmienna globalna)
                // np. ostatnioWylosowaneZestawyGlobalnie juÅ¼ jest resetowane w wyczyscLosowanie

                // Wyniki licznika punktÃ³w
                scores = { player1: 0, player2: 0 };
                playerNames = { player1: "Gracz 1", player2: "Gracz 2" };
                // WyczyÅ›Ä‡ ewentualne timeouty zwiÄ…zane z licznikiem (masz to juÅ¼ dla fullscreenOverlayHideTimeout)
                if (imageHideTimeouts.player1) clearTimeout(imageHideTimeouts.player1);
                if (imageHideTimeouts.player2) clearTimeout(imageHideTimeouts.player2);
                imageHideTimeouts = { player1: null, player2: null };
                if (fullscreenOverlayHideTimeout) {
                    clearTimeout(fullscreenOverlayHideTimeout);
                    fullscreenOverlayHideTimeout = null;
                }
                console.log("Zmienne globalne wynikÃ³w zresetowane.");

                // Stan Deck Buildera
                initializeOrResetCurrentDeck(); // To powinno resetowaÄ‡ currentDeckBeingBuilt do pustego stanu
                currentEditingDeckId = null;
                currentlyActiveSetIndexInBuilder = 0;
                const deckNameInput = document.getElementById('deckName');
                if (deckNameInput) deckNameInput.value = "";
                const saveBtn = document.getElementById('saveDeckButton');
                if (saveBtn) saveBtn.textContent = 'Zapisz Aktualny Deck';
                console.log("Stan Deck Buildera zresetowany.");


                // Stan Generatora Losowych ZestawÃ³w
                ostatnioWylosowaneZestawyGlobalnie = [];
                if (wynikiDivGenerator) wynikiDivGenerator.innerHTML = '';
                if (placeholderActualImgGenerator) placeholderActualImgGenerator.style.display = 'block';
                const zapiszGlownyControls = document.getElementById('zapisz-glowny-zestaw-controls');
                if (zapiszGlownyControls) zapiszGlownyControls.style.display = 'none';
                const nazwaDeckuInputGenerator = document.getElementById('nazwa-glownego-decku');
                if (nazwaDeckuInputGenerator) nazwaDeckuInputGenerator.value = "";
                console.log("Stan Generatora Losowych ZestawÃ³w zresetowany.");

                // Czyszczenie pÃ³l tekstowych na stronie Import/Eksport (jeÅ›li jest aktywna)
                // Robimy to tutaj, bo odÅ›wieÅ¼enie widoku moÅ¼e nie nastÄ…piÄ‡ od razu,
                // a chcemy, Å¼eby uÅ¼ytkownik widziaÅ‚, Å¼e pola sÄ… czyste.
                const poleJsonMagazyn = document.getElementById('poleDanychJsonMagazyn');
                const poleJsonDecki = document.getElementById('poleDanychJsonDecki');
                if (poleJsonMagazyn) poleJsonMagazyn.value = '';
                if (poleJsonDecki) poleJsonDecki.value = '';
                console.log("Pola tekstowe Import/Eksport wyczyszczone.");


                // Ukryj peÅ‚noekranowÄ… nakÅ‚adkÄ™ licznika, jeÅ›li byÅ‚a widoczna
                const overlayElement = document.getElementById('fullscreenFinishOverlay');
                const imageElement = document.getElementById('fullscreenFinishImage');
                if (overlayElement && imageElement && overlayElement.classList.contains('visible')) {
                    overlayElement.classList.remove('visible');
                    // OpÃ³Åºnione czyszczenie src, aby uniknÄ…Ä‡ migniÄ™cia, jeÅ›li przejÅ›cie trwa
                    setTimeout(() => {
                        if (!overlayElement.classList.contains('visible')) { // SprawdÅº ponownie na wszelki wypadek
                            imageElement.src = '#';
                        }
                    }, 300); // Dopasuj do czasu przejÅ›cia opacity
                    console.log("NakÅ‚adka licznika ukryta.");
                }


                console.log("PeÅ‚ne czyszczenie danych aplikacji (zmiennych i UI powiÄ…zanych) zakoÅ„czone.");
                // UWAGA: Ta funkcja NIE powinna odÅ›wieÅ¼aÄ‡ caÅ‚ych widokÃ³w (jak wyswietlMagazyn),
                // to zadanie dla funkcji nadrzÄ™dnej po zaÅ‚adowaniu nowej bazy.
                // Powinna jednak resetowaÄ‡ stan UI, ktÃ³ry jest bezpoÅ›rednio powiÄ…zany ze zmiennymi globalnymi,
                // np. wyÅ›wietlacze wynikÃ³w, inputy.
            }

            function wykonajPelnyResetAplikacji() {
                console.log("Rozpoczynanie peÅ‚nego resetu aplikacji...");

                // Krok 1: Wykonaj czyszczenie wszystkich danych
                wykonajWyczyszczenieDanych(); // Upewnij siÄ™, Å¼e ta funkcja jest teraz kompletna

                console.log("PeÅ‚ne czyszczenie danych aplikacji (localStorage i zmienne globalne) zakoÅ„czone.");

                // Krok 2: ZaÅ‚aduj domyÅ›lnÄ… bazÄ™ danych
                console.log("PrÃ³ba zaÅ‚adowania domyÅ›lnej bazy danych po resecie...");
                let czyBazaZaladowanaPoprawnieLubNieWymagalaZmian = false;
                try {
                    // WywoÅ‚ujemy z trybemCichy=false, aby uÅ¼ytkownik widziaÅ‚ ewentualne komunikaty z importu.
                    // `ustawDomyslnaIloscDlaNowychNaZero = true` jest przekazywane wewnÄ…trz importujMagazynZBazyDomyslnejHTML
                    // do przetworzIDopiszDaneMagazynu.
                    const importWynik = importujMagazynZBazyDomyslnejHTML(false); // false = nie tryb cichy

                    // importWynik to true, jeÅ›li byÅ‚y zmiany; false, jeÅ›li nie byÅ‚o zmian lub bÅ‚Ä…d w danych importu.
                    // Dla resetu uznajemy za sukces, jeÅ›li sama funkcja importu nie rzuciÅ‚a krytycznego bÅ‚Ä™du.
                    czyBazaZaladowanaPoprawnieLubNieWymagalaZmian = true;

                    if (importWynik) {
                        console.log("DomyÅ›lna baza danych zaÅ‚adowana i dokonano zmian w magazynie.");
                    } else {
                        console.log("PrÃ³ba zaÅ‚adowania domyÅ›lnej bazy danych nie wprowadziÅ‚a nowych zmian (magazyn mÃ³gÅ‚ byÄ‡ juÅ¼ zgodny lub pusty po czyszczeniu, lub dane bazy byÅ‚y niepoprawne i przetworz... zwrÃ³ciÅ‚o false).");
                    }
                    localStorage.setItem(DOMYSLNA_BAZA_ZALADOWANA_KEY, 'true'); // Ustaw flagÄ™ po udanej prÃ³bie
                    showNotification("Aplikacja zostaÅ‚a zresetowana. DomyÅ›lna baza czÄ™Å›ci zaÅ‚adowana (lub podjÄ™to prÃ³bÄ™).", 4000, 'success');

                } catch (error) { // Ten catch Å‚apie bÅ‚Ä™dy rzucone przez importujMagazynZBazyDomyslnejHTML (np. brak skryptu)
                    console.error("Krytyczny bÅ‚Ä…d podczas prÃ³by Å‚adowania domyÅ›lnej bazy danych po resecie:", error);
                    showNotification("Dane zostaÅ‚y wyczyszczone, ale wystÄ…piÅ‚ KRYTYCZNY bÅ‚Ä…d podczas Å‚adowania domyÅ›lnej bazy czÄ™Å›ci. SprawdÅº konsolÄ™.", 6000, 'error');
                    // Flaga DOMYSLNA_BAZA_ZALADOWANA_KEY nie jest ustawiana, co jest poprawne.
                }

                console.log("Proces Å‚adowania domyÅ›lnej bazy zakoÅ„czony.");

                // Krok 3: OdÅ›wieÅ¼ widoki, ktÃ³re mogÅ‚y byÄ‡ aktywne, aby odzwierciedliÅ‚y nowy, czysty stan
                // oraz ewentualnie nowo zaÅ‚adowanÄ… bazÄ™.
                console.log("OdÅ›wieÅ¼anie aktywnych widokÃ³w po resecie...");
                const aktywnaStronaId = document.querySelector('.page.active')?.id;
                if (aktywnaStronaId) {
                    console.log(`Aktywna strona to: ${aktywnaStronaId}. OdÅ›wieÅ¼am...`);
                    if (aktywnaStronaId === 'magazyn') wyswietlMagazyn();
                    else if (aktywnaStronaId === 'generator') {
                         // wyczyscLosowanie jest juÅ¼ czÄ™Å›ciÄ… wykonajWyczyszczenieDanych,
                         // ale moÅ¼na tu upewniÄ‡ siÄ™, Å¼e UI jest czyste
                        if (wynikiDivGenerator) wynikiDivGenerator.innerHTML = '';
                        if (placeholderActualImgGenerator) placeholderActualImgGenerator.style.display = 'block';
                    } else if (aktywnaStronaId === 'deck') {
                        // clearCurrentDeckForBuilder jest juÅ¼ w wykonajWyczyszczenieDanych,
                        // ale renderDeckBuilderAndParts odÅ›wieÅ¼y listÄ™ dostÄ™pnych czÄ™Å›ci z nowej bazy.
                        renderDeckBuilderAndParts();
                    } else if (aktywnaStronaId === 'galeriaDeckow') displaySavedDecks();
                    else if (aktywnaStronaId === 'licznikPunktow') {
                        if (typeof displayScores === 'function') displayScores();
                        if (typeof displayPlayerNames === 'function') displayPlayerNames();
                    }
                    // Strona 'importexport' powinna mieÄ‡ juÅ¼ wyczyszczone pola przez wykonajWyczyszczenieDanych.
                } else {
                    console.log("Brak aktywnej strony do odÅ›wieÅ¼enia.");
                }
                console.log("PeÅ‚ny reset aplikacji zakoÅ„czony.");
            }


            window.addEventListener('load', function() {
                console.log("Wydarzenie 'load': Strona i wszystkie zasoby (w tym obrazki) zaÅ‚adowane.");

                // ZnajdÅº kluczowe elementy DOM do odsÅ‚oniÄ™cia
                const loaderOverlay = document.getElementById('loader-overlay');
                const localAppContainer = document.getElementById('app-container');
                const localSidebar = document.getElementById('sidebar');

                // === OdsÅ‚oniÄ™cie strony ===
                if (loaderOverlay) {
                    loaderOverlay.classList.add('hidden');
                    // Po zakoÅ„czeniu animacji usuÅ„ go z DOM, aby nie przeszkadzaÅ‚
                    setTimeout(() => {
                        loaderOverlay.remove();
                    }, 800); // Czas musi byÄ‡ nieco dÅ‚uÅ¼szy niÅ¼ transition w CSS
                }

                // PokaÅ¼ pÅ‚ynnie gÅ‚Ã³wnÄ… zawartoÅ›Ä‡ aplikacji
                if (localAppContainer && localSidebar) {
                    localAppContainer.classList.add('loaded');
                    localSidebar.classList.add('loaded');
                }

                // === POPRAWKA: Inicjalizujemy zmienne globalne, a nie tworzymy nowych ===
                // Usuwamy 'const' i 'let' z tych linii, aby przypisaÄ‡ wartoÅ›Ä‡ do zmiennych zdefiniowanych na gÃ³rze skryptu
                sidebar = document.getElementById('sidebar');
                appContainer = document.getElementById('app-container');
                sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
                menuIcon = document.getElementById('menu-icon');
                menuBtnText = document.getElementById('menu-btn-text');
                wynikiDivGenerator = document.getElementById('wyniki');
                placeholderActualImgGenerator = document.getElementById('placeholder-img');
                // === KONIEC POPRAWKI ===

                // Inicjalizacja danych aplikacji
                initializeOrResetCurrentDeck();

                // ---- AUTOMATYCZNA SYNCHRONIZACJA BAZY DANYCH ----
                try {
                    console.log("Rozpoczynanie automatycznej synchronizacji magazynu z domyÅ›lnÄ… bazÄ…...");
                    const czyCosSieZmienilo = importujMagazynZBazyDomyslnejHTML(true);
                    checkAllAchievements();
                    if (czyCosSieZmienilo) {
                        console.log("Magazyn zostaÅ‚ zsynchronizowany z domyÅ›lnÄ… bazÄ….");
                    } else {
                        console.log("Magazyn jest aktualny wzglÄ™dem domyÅ›lnej bazy.");
                    }
                } catch (e) {
                    console.error("BÅ‚Ä…d podczas automatycznej synchronizacji magazynu:", e);
                    showNotification("WystÄ…piÅ‚ bÅ‚Ä…d przy aktualizacji bazy czÄ™Å›ci.", 3000, 'error');
                }

                // ---- INICJALIZACJA TÅA VANTA ----
                if (typeof VANTA !== 'undefined' && VANTA.NET && typeof THREE !== 'undefined') {
                    const vantaContainer = document.getElementById('vanta-background');
                    if (vantaContainer) {
                        try {
                            window.vantaEffect = VANTA.NET({
                                el: "#vanta-background",
                                mouseControls: true,
                                touchControls: true,
                                gyroControls: false,
                                minHeight: 200.00,
                                minWidth: 200.00,
                                scale: 1.00,
                                scaleMobile: 1.00,
                                backgroundColor: 0x101018,
                                color: 0x8a2be2,
                                points: 11.00,
                                maxDistance: 20.00,
                                spacing: 16.00,
                                showDots: true
                            });
                            console.log("Vanta.NET zainicjalizowana pomyÅ›lnie.");
                        } catch (e) {
                            console.error("BÅ‚Ä…d podczas inicjalizacji VANTA:", e);
                            showNotification("Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ animowanego tÅ‚a.", 3000, 'warning');
                        }
                    }
                }

                // Ustawienie marginesu kontenera aplikacji (teraz `appContainer` jest zdefiniowany)
                if (appContainer) {
                    appContainer.style.marginLeft = sidebarWidthCollapsed + 'px';
                }

                // DomyÅ›lna nawigacja (teraz `navigateTo` ma dostÄ™p do poprawnych zmiennych)
                const domyslnyLink = document.querySelector('.sidebar a[onclick*="navigateTo(\'info"]');
                if (domyslnyLink) {
                    navigateTo('info', domyslnyLink);
                } else {
                    console.error("Brak linku nawigacyjnego do strony 'Info'.");
                    navigateTo('info', null);
                }

                // Listener dla przycisku sidebar (teraz `toggleSidebar` ma dostÄ™p do poprawnych zmiennych)
                if (sidebarToggleBtn) {
                    sidebarToggleBtn.addEventListener('click', toggleSidebar);
                }
            });
                function pokazZakladkePoradnika(zakladkaId, kliknietyPrzycisk) {
                    // Ukryj wszystkie zakÅ‚adki
                    document.querySelectorAll('.poradnik-zakladka').forEach(zakladka => {
                        zakladka.style.display = 'none';
                        zakladka.classList.remove('active');
                    });

                    // UsuÅ„ klasÄ™ 'active' ze wszystkich przyciskÃ³w
                    document.querySelectorAll('#poradnik-tabs .tab-button').forEach(przycisk => {
                        przycisk.classList.remove('active');
                    });

                    // PokaÅ¼ wybranÄ… zakÅ‚adkÄ™
                    const aktywnaZakladka = document.getElementById(`poradnik-${zakladkaId}`);
                    if (aktywnaZakladka) {
                        aktywnaZakladka.style.display = 'block';
                        aktywnaZakladka.classList.add('active');
                    }

                    // Dodaj klasÄ™ 'active' do klikniÄ™tego przycisku
                    if (kliknietyPrzycisk) {
                        kliknietyPrzycisk.classList.add('active');
                    }
                }
              function wygenerujListeBitowPoradnik() {
                const kontener = document.querySelector('#poradnik-bity h4:last-of-type');
                if (!kontener) return;

                let listaDiv = document.getElementById('lista-bitow-poradnik-div');
                if (!listaDiv) {
                    listaDiv = document.createElement('div');
                    listaDiv.id = 'lista-bitow-poradnik-div';
                    kontener.parentNode.insertBefore(listaDiv, kontener.nextSibling);
                }
                listaDiv.innerHTML = '';

                const magazyn = getMagazyn();
                const bity = magazyn.filter(p => p.typ === 'bit' || p.integrujeBit === true);

                // ===>>> KLUCZOWA ZMIANA #1: Tworzymy "sÅ‚ownik" do tÅ‚umaczenia nazw <<<===
                // Mapuje polskie nazwy z bazy danych na angielskie nazwy plikÃ³w obrazkÃ³w.
                const nazwyPlikowIkon = {
                    'atak': 'attack',
                    'obrona': 'defence',
                    'wytrzymalosc': 'stamina',
                    'balans': 'balance'
                };

                // Obiekt do wyÅ›wietlania skrÃ³tÃ³w (ATK, DEF) pozostaje bez zmian.
                const kategorie = { 'atak': 'ATK', 'obrona': 'DEF', 'wytrzymalosc': 'STM', 'balans': 'BAL' };

                // Budujemy przyciski filtrÃ³w, uÅ¼ywajÄ…c nowego sÅ‚ownika
                const przyciskiKategoriiHTML = `
                    <div class="tabs-container" style="margin: 20px 0;">
                        ${Object.keys(kategorie).map(kat =>
                            `<button class="tab-button" onclick="filtrujBityPoradnik('${kat}')">
                                <img src="img/${nazwyPlikowIkon[kat]}.webp" class="inline-icon" alt="${kategorie[kat]}"> ${kategorie[kat]}
                            </button>`
                        ).join('')}
                         <button class="tab-button active" onclick="filtrujBityPoradnik('wszystkie')">Wszystkie</button>
                    </div>`;
                listaDiv.innerHTML += przyciskiKategoriiHTML;

                // Tworzenie tabeli (bez zmian)
                const tabela = document.createElement('table');
                tabela.style.width = '100%';
                tabela.style.borderCollapse = 'collapse';
                tabela.innerHTML = `
                    <thead>
                        <tr style="border-bottom: 2px solid rgba(255,255,255,0.2);">
                            <th style="padding: 8px; text-align: left;">Nazwa</th>
                            <th style="padding: 8px; text-align: left;">SkrÃ³t</th>
                            <th style="padding: 8px; text-align: center;">Typ</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-bitow-poradnik-cialo"></tbody>`;
                listaDiv.appendChild(tabela);

                // WypeÅ‚nianie tabeli danymi
                const tbody = document.getElementById('tabela-bitow-poradnik-cialo');
                bity.sort((a,b) => a.nazwa.localeCompare(b.nazwa)).forEach(bit => {
                    const row = document.createElement('tr');
                    row.dataset.kategoria = bit.rodzaj;
                    row.style.borderBottom = '1px solid rgba(255,255,255,0.1)';

                    let typIkona = 'N/A';
                    // ===>>> KLUCZOWA ZMIANA #2: UÅ¼ywamy "sÅ‚ownika" do zbudowania poprawnej Å›cieÅ¼ki <<<===
                    if (bit.rodzaj && nazwyPlikowIkon[bit.rodzaj]) {
                        const nazwaPliku = nazwyPlikowIkon[bit.rodzaj]; // np. 'attack'
                        typIkona = `<img src="img/${nazwaPliku}.webp" class="inline-icon" title="${bit.rodzaj}">`;
                    }

                    row.innerHTML = `
                        <td style="padding: 8px;">${bit.nazwa} ${bit.integrujeBit ? '<em style="color:#a25ff0;">(Ratchet)</em>' : ''}</td>
                        <td style="padding: 8px;">${bit.skroconaNazwa || 'B/D'}</td>
                        <td style="padding: 8px; text-align: center;">${typIkona}</td>
                    `;
                    tbody.appendChild(row);
                });

                filtrujBityPoradnik('wszystkie');
            }


                function filtrujBityPoradnik(kategoria) {
                    document.querySelectorAll('#tabela-bitow-poradnik-cialo tr').forEach(row => {
                        if (kategoria === 'wszystkie' || row.dataset.kategoria === kategoria) {
                            row.style.display = 'table-row';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                    // PodÅ›wietl aktywny przycisk
                    document.querySelectorAll('#lista-bitow-poradnik-div .tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelector(`#lista-bitow-poradnik-div .tab-button[onclick="filtrujBityPoradnik('${kategoria}')"]`).classList.add('active');
                }
				
				/* ===========================
   FIREBASE AUTH + FIRESTORE
   Integracja: login/register + sync danych
   Wklej na sam koniec Twojego gÅ‚Ã³wnego <script>
   =========================== */

/* === 1) Wstaw tutaj konfiguracjÄ™ z Firebase (z konsoli) === */
const firebaseConfig = {
  apiKey: "FIREBASE_CONFIG_PLACEHOLDER_apiKey",
  authDomain: "FIREBASE_CONFIG_PLACEHOLDER_authDomain",
  projectId: "FIREBASE_CONFIG_PLACEHOLDER_projectId",
  storageBucket: "FIREBASE_CONFIG_PLACEHOLDER_storageBucket",
  messagingSenderId: "FIREBASE_CONFIG_PLACEHOLDER_messagingSenderId",
  appId: "FIREBASE_CONFIG_PLACEHOLDER_appId"
};

/* === 2) Inicjalizacja === */
if (!window.firebase || !firebase.apps) {
  console.error("Firebase SDK nie zostaÅ‚ zaÅ‚adowany. Upewnij siÄ™, Å¼e dodaÅ‚eÅ› SDK do <head>.");
}
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ===========================
   UI: proste funkcje pokaz/ukryj (dodaj przyciski gdzie chcesz)
   MoÅ¼esz samodzielnie wstawiÄ‡ formularze rejestracji/logowania w HTML.
   PoniÅ¼ej sÄ… funkcje, ktÃ³re moÅ¼esz wywoÅ‚ywaÄ‡ z istniejÄ…cego UI.
   =========================== */

async function registerWithEmail(email, password) {
  try {
    const userCred = await auth.createUserWithEmailAndPassword(email, password);
    console.log("Zarejestrowano:", userCred.user.uid);
    // UtwÃ³rz dokument uÅ¼ytkownika w Firestore (pusty profil)
    await db.collection("users").doc(userCred.user.uid).set({
      email: email,
      createdAt: Date.now()
    }, { merge: true });
    showNotification("Zarejestrowano pomyÅ›lnie!", 2500, 'success');
  } catch (e) {
    console.error("BÅ‚Ä…d rejestracji:", e);
    showNotification("BÅ‚Ä…d rejestracji: " + (e.message || e.code), 3500, 'error');
  }
}

async function loginWithEmail(email, password) {
  try {
    const userCred = await auth.signInWithEmailAndPassword(email, password);
    console.log("Zalogowano:", userCred.user.uid);
    showNotification("Zalogowano pomyÅ›lnie!", 2000, 'success');
  } catch (e) {
    console.error("BÅ‚Ä…d logowania:", e);
    showNotification("BÅ‚Ä…d logowania: " + (e.message || e.code), 3500, 'error');
  }
}

function logoutCurrentUser() {
  auth.signOut().then(() => {
    console.log("Wylogowano.");
    showNotification("Wylogowano", 1500, 'info');
  });
}

/* ===========================
   NasÅ‚uch zmian stanu uÅ¼ytkownika
   - onAuthStateChanged wywoÅ‚a synchronizacjÄ™ po zalogowaniu
   =========================== */

let currentUserUID = null;
let cloudSyncUnsubscribes = []; // do ewentualnego wyÅ‚Ä…czania listenerÃ³w

auth.onAuthStateChanged(async (user) => {
  if (user) {
    currentUserUID = user.uid;
    console.log("Auth: zalogowany jako", currentUserUID);
    // Po zalogowaniu -> synchronizuj dane (merge local -> cloud)
    await syncLocalToCloudOnFirstLogin(user.uid);
    // nastÄ™pnie Å‚aduj dane z chmury (i renderuj)
    await loadAllFromCloud(user.uid);
    // ustaw nasÅ‚uch zmian w chmurze (opcjonalne)
    startCloudListeners(user.uid);
  } else {
    console.log("Auth: brak zalogowanego uÅ¼ytkownika.");
    currentUserUID = null;
    stopCloudListeners();
    // jeÅ›li chcesz moÅ¼esz przywrÃ³ciÄ‡ dane z localStorage (juÅ¼ sÄ…)
  }
});

/* ===========================
   Funkcje zapisu/odczytu do Firestore
   Struktura:
   collection 'users' -> doc(uid) -> subcollections:
     - decks (doc id: deck.id)
     - inventory (doc id: 'inventory') lub kolekcja items
     - achievements (doc id: 'achievements')
   =========================== */

function userDocRef(uid) { return db.collection('users').doc(uid); }
function userCollectionRef(uid, name) { return userDocRef(uid).collection(name); }

/* --- ZAPIS I ODCZYT: DECKS --- */
async function saveDecksToCloud(uid, decks) {
  if (!uid) return;
  try {
    // opcja: nadpisujemy kolekcjÄ™ decks - bezpieczniej robiÄ‡ replace per deck
    const batch = db.batch();
    const col = userCollectionRef(uid, 'decks');
    // usuwanie wszystkich istniejÄ…cych dokumentÃ³w nie jest robione tutaj (moÅ¼na dodaÄ‡)
    decks.forEach(deck => {
      const docRef = col.doc(deck.id || (`deck_${Date.now()}_${Math.random().toString(36).slice(2,8)}`));
      batch.set(docRef, deck, { merge: true });
    });
    await batch.commit();
    console.log("Zapisano decki do chmury:", decks.length);
  } catch (e) {
    console.error("saveDecksToCloud error:", e);
  }
}

async function loadDecksFromCloud(uid) {
  if (!uid) return [];
  try {
    const snap = await userCollectionRef(uid, 'decks').get();
    const arr = snap.docs.map(d => d.data());
    console.log("ZaÅ‚adowano decki z chmury:", arr.length);
    return arr;
  } catch (e) {
    console.error("loadDecksFromCloud error:", e);
    return [];
  }
}

/* --- ZAPIS I ODCZYT: MAGAZYN (inventory) --- */
async function saveInventoryToCloud(uid, inventory) {
  if (!uid) return;
  try {
    const ref = userDocRef(uid).collection('meta').doc('inventory');
    await ref.set({ items: inventory, updatedAt: Date.now() }, { merge: true });
    console.log("Zapisano magazyn do chmury.");
  } catch (e) {
    console.error("saveInventoryToCloud error:", e);
  }
}

async function loadInventoryFromCloud(uid) {
  if (!uid) return [];
  try {
    const doc = await userDocRef(uid).collection('meta').doc('inventory').get();
    if (!doc.exists) return [];
    return doc.data().items || [];
  } catch (e) {
    console.error("loadInventoryFromCloud error:", e);
    return [];
  }
}

/* --- ZAPIS I ODCZYT: ACHIEVEMENTS --- */
async function saveAchievementsToCloud(uid, achievements) {
  if (!uid) return;
  try {
    await userDocRef(uid).collection('meta').doc('achievements').set({ items: achievements, updatedAt: Date.now() }, { merge: true });
    console.log("Zapisano achievements do chmury.");
  } catch (e) {
    console.error("saveAchievementsToCloud error:", e);
  }
}

async function loadAchievementsFromCloud(uid) {
  if (!uid) return [];
  try {
    const doc = await userDocRef(uid).collection('meta').doc('achievements').get();
    if (!doc.exists) return [];
    return doc.data().items || [];
  } catch (e) {
    console.error("loadAchievementsFromCloud error:", e);
    return [];
  }
}

/* ===========================
   Kompletny flow: przy pierwszym loginie zmerguj LocalStorage -> Cloud
   Strategia: 
     - jeÅ›li cloud puste -> push local -> cloud
     - jeÅ›li cloud nie puste -> scal (unikaj duplikatÃ³w) i zapisz wynik jako cloud source-of-truth
   =========================== */

async function syncLocalToCloudOnFirstLogin(uid) {
  if (!uid) return;
  try {
    // przyjmujemy, Å¼e masz funkcje getSavedDecks(), getMagazyn(), getAchievements() w swoim kodzie
    const localDecks = typeof getSavedDecks === 'function' ? getSavedDecks() : [];
    const localInventory = typeof getMagazyn === 'function' ? getMagazyn() : [];
    const localAchievements = typeof getSavedAchievements === 'function' ? getSavedAchievements() : [];

    // pobierz z chmury
    const cloudDecks = await loadDecksFromCloud(uid);
    const cloudInventory = await loadInventoryFromCloud(uid);
    const cloudAchievements = await loadAchievementsFromCloud(uid);

    // MERGE DECKS -> prosta logika: unikaj duplikatÃ³w po id
    const mergedDecksById = {};
    cloudDecks.forEach(d => { if (d && d.id) mergedDecksById[d.id] = d; });
    localDecks.forEach(d => { if (d && d.id) mergedDecksById[d.id] = d; });

    const mergedDecks = Object.values(mergedDecksById);

    // MERGE inventory -> preferujemy sumowanie iloÅ›ci dla identycznych id
    const invById = {};
    cloudInventory.forEach(item => { if (item && item.id) invById[item.id] = item; });
    localInventory.forEach(item => {
      if (!item || !item.id) return;
      if (!invById[item.id]) invById[item.id] = item;
      else {
        // sumujemy ilosc
        invById[item.id].ilosc = (parseInt(invById[item.id].ilosc || 0,10) + parseInt(item.ilosc || 0,10));
      }
    });
    const mergedInventory = Object.values(invById);

    // MERGE achievements -> unikatowe identyfikatory
    const achById = {};
    cloudAchievements.forEach(a => { if (a && a.id) achById[a.id] = a; });
    localAchievements.forEach(a => { if (a && a.id) achById[a.id] = a; });
    const mergedAchievements = Object.values(achById);

    // zapisz scalone do chmury
    await saveDecksToCloud(uid, mergedDecks);
    await saveInventoryToCloud(uid, mergedInventory);
    await saveAchievementsToCloud(uid, mergedAchievements);

    // opcjonalnie: zapisz scalone lokalnie (nadpisanie localStorage)
    if (typeof setSavedDecks === 'function') setSavedDecks(mergedDecks);
    if (typeof setMagazyn === 'function') setMagazyn(mergedInventory);
    if (typeof setSavedAchievements === 'function') setSavedAchievements(mergedAchievements);

    showNotification("Twoje dane zostaÅ‚y zsynchronizowane z chmurÄ….", 2500, 'success');
  } catch (e) {
    console.error("syncLocalToCloudOnFirstLogin error:", e);
  }
}

/* ===========================
   Åadowanie wszystkich danych z chmury (overwrite lokalnych) 
   =========================== */
async function loadAllFromCloud(uid) {
  if (!uid) return;
  try {
    const decks = await loadDecksFromCloud(uid);
    const inventory = await loadInventoryFromCloud(uid);
    const achievements = await loadAchievementsFromCloud(uid);

    if (typeof setSavedDecks === 'function') setSavedDecks(decks);
    if (typeof setMagazyn === 'function') setMagazyn(inventory);
    if (typeof setSavedAchievements === 'function') setSavedAchievements(achievements);

    // ponowne renderowanie aktualnej strony
    const current = document.querySelector('.page.active')?.id;
    if (current === 'magazyn') wyswietlMagazyn();
    if (current === 'galeriaDeckow') displaySavedDecks();
    if (current === 'osiagniecia') displayAchievements();
    console.log("Wczytano wszystkie dane uÅ¼ytkownika z chmury i zaktualizowano UI.");
  } catch (e) {
    console.error("loadAllFromCloud error:", e);
  }
}

/* ===========================
   Nasluchiwanie zmian w chmurze (opcjonalne) - aktualizuj UI live
   =========================== */
function startCloudListeners(uid) {
  stopCloudListeners();
  // listener dla kolekcji decks -> aktualizuj lokalne i UI
  const decksUnsub = userCollectionRef(uid, 'decks').onSnapshot(snapshot => {
    const docs = [];
    snapshot.forEach(doc => docs.push(doc.data()));
    if (typeof setSavedDecks === 'function') setSavedDecks(docs);
    if (document.querySelector('.page.active')?.id === 'galeriaDeckow') displaySavedDecks();
  }, e => console.error("decks onSnapshot error:", e));
  cloudSyncUnsubscribes.push(decksUnsub);

  // listener dla inventory document
  const invUnsub = userDocRef(uid).collection('meta').doc('inventory').onSnapshot(doc => {
    if (!doc.exists) return;
    const items = doc.data().items || [];
    if (typeof setMagazyn === 'function') setMagazyn(items);
    if (document.querySelector('.page.active')?.id === 'magazyn') wyswietlMagazyn();
  }, e => console.error("inventory onSnapshot error:", e));
  cloudSyncUnsubscribes.push(invUnsub);

  // achievements
  const achUnsub = userDocRef(uid).collection('meta').doc('achievements').onSnapshot(doc => {
    if (!doc.exists) return;
    const items = doc.data().items || [];
    if (typeof setSavedAchievements === 'function') setSavedAchievements(items);
    if (document.querySelector('.page.active')?.id === 'osiagniecia') displayAchievements();
  }, e => console.error("achievements onSnapshot error:", e));
  cloudSyncUnsubscribes.push(achUnsub);
}

function stopCloudListeners() {
  cloudSyncUnsubscribes.forEach(unsub => { try { unsub(); } catch(e){} });
  cloudSyncUnsubscribes = [];
}

/* ===========================
   Hook: automatyczne wywoÅ‚ywanie sync->cloud, gdy lokalne settery sÄ… wywoÅ‚ane
   (monkey-patch istniejÄ…cych funkcji setMagazyn, setSavedDecks, setSavedAchievements)
   =========================== */

function addCloudSyncHooks() {
  // helper to wrap function if exists
  function wrap(fnName, cloudSaveFn) {
    const orig = window[fnName];
    if (typeof orig === 'function') {
      window[fnName] = function(...args) {
        try { const res = orig.apply(this, args); 
              // after local setter did its job -> jeÅ›li zalogowany -> sync
              if (currentUserUID) {
                try { cloudSaveFn(currentUserUID, args[0]); } catch(e){ console.warn("cloudSaveFn error:", e); }
              }
              return res;
        } catch(e) { console.error(fnName+" wrapper error:", e); throw e; }
      };
      console.log("Dodano hook dla", fnName);
    } else {
      console.warn("Nie znaleziono funkcji do podmienienia:", fnName);
    }
  }

  wrap('setMagazyn', saveInventoryToCloud);
  wrap('setSavedDecks', saveDecksToCloud);
  wrap('setSavedAchievements', saveAchievementsToCloud);
}

// Odpalamy hooki na starcie
setTimeout(addCloudSyncHooks, 1200); // delay by 1.2s to allow original functions to be defined

/* ===========================
   Przydatne debugowe funkcje:
   - eksport / import z chmury
   =========================== */
async function exportUserDataToJSON(uid) {
  if (!uid) return null;
  const decks = await loadDecksFromCloud(uid);
  const inventory = await loadInventoryFromCloud(uid);
  const achievements = await loadAchievementsFromCloud(uid);
  return { decks, inventory, achievements };
}

/* ===========================
   Notification helper â€” zostawiam twoje showNotification uÅ¼ywane w projekcie
   JeÅ›li go nie masz, poniÅ¼ej szybka implementacja (prosta), jednak
   TwÃ³j plik najwyraÅºniej ma showNotification, wiÄ™c uÅ¼ywamy jej.
   =========================== */
if (typeof showNotification !== 'function') {
  window.showNotification = function(msg, timeout=2000, type='info'){
    const bar = document.getElementById('notification-bar');
    if (!bar) { alert(msg); return; }
    bar.textContent = msg;
    bar.className = 'notification-show';
    bar.style.display = 'block';
    bar.style.background = (type==='error')? 'rgba(190,50,50,0.95)' : (type==='success') ? 'linear-gradient(90deg,#8a2be2,#a25ff0)' : 'rgba(40,40,40,0.9)';
    bar.style.opacity = '1';
    setTimeout(()=>{ bar.style.opacity = '0'; setTimeout(()=>bar.style.display='none',300); }, timeout);
  };
}

/* ===========================
   GOTOWE. Koniec skryptu firebase.
   =========================== */
/* ===============================
      PANEL KONTO â€” UI HANDLING
   =============================== */

function updateKontoUI(user) {
    const loggedInBox = document.getElementById("kontoLoggedIn");
    const loggedOutBox = document.getElementById("kontoLoggedOut");

    if (!loggedInBox || !loggedOutBox) return;

    if (user) {
        loggedOutBox.style.display = "none";
        loggedInBox.style.display = "block";

        document.getElementById("kontoUserEmail").textContent = user.email;
    } else {
        loggedInBox.style.display = "none";
        loggedOutBox.style.display = "block";
    }
}

/* Hook w onAuthStateChanged */
auth.onAuthStateChanged((user) => {
    updateKontoUI(user);
});
function firebaseLogin() {
    const email = document.getElementById("loginEmail").value.trim();
    const pass = document.getElementById("loginPass").value.trim();

    if (!email || !pass) {
        showNotification("Podaj email i hasÅ‚o!", 2000, "error");
        return;
    }

    loginWithEmail(email, pass);
}

function firebaseRegister() {
    const email = document.getElementById("loginEmail").value.trim();
    const pass = document.getElementById("loginPass").value.trim();

    if (!email || !pass) {
        showNotification("Podaj email i hasÅ‚o!", 2000, "error");
        return;
    }

    registerWithEmail(email, pass);
}
async function exportUserCloudData() {
    if (!currentUserUID) {
        showNotification("Zaloguj siÄ™ najpierw!", 2000, "error");
        return;
    }

    const data = await exportUserDataToJSON(currentUserUID);
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });

    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "BX_user_data_backup.json";
    a.click();
}
    // =============================================
    // === FUNKCJE SYSTEMU KONTA I FIREBASE (NOWE) ===
    // =============================================

    function toggleAccountSubmenu(element) {
        const submenu = document.getElementById('account-submenu');
        submenu.classList.toggle('expanded');
        element.classList.toggle('active-link'); // PodÅ›wietla gÅ‚Ã³wny przycisk "Konto"
    }

    function showAuthPopup(mode) {
        currentAuthMode = mode;
        const overlay = document.getElementById('auth-overlay');
        const title = document.getElementById('auth-title');
        const button = document.getElementById('auth-submit-button');
        const errorMessage = document.getElementById('auth-error-message');

        errorMessage.style.display = 'none'; // Ukryj bÅ‚Ä™dy przy otwieraniu

        if (mode === 'login') {
            title.textContent = 'Zaloguj siÄ™';
            button.textContent = 'Zaloguj siÄ™';
        } else {
            title.textContent = 'UtwÃ³rz konto';
            button.textContent = 'Zarejestruj siÄ™';
        }
        overlay.style.display = 'flex';
        setTimeout(() => overlay.classList.add('visible'), 10);
    }

    function hideAuthPopup() {
        const overlay = document.getElementById('auth-overlay');
        overlay.classList.remove('visible');
        setTimeout(() => overlay.style.display = 'none', 300);
    }

    function handleAuth() {
        const email = document.getElementById('auth-email').value;
        const password = document.getElementById('auth-password').value;
        const errorMessage = document.getElementById('auth-error-message');
        errorMessage.style.display = 'none';

        if (!email || !password) {
            errorMessage.textContent = 'WypeÅ‚nij oba pola.';
            errorMessage.style.display = 'block';
            return;
        }

        if (currentAuthMode === 'login') {
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    console.log("Zalogowano pomyÅ›lnie:", userCredential.user.email);
                    hideAuthPopup();
                })
                .catch(error => {
                    errorMessage.textContent = getFriendlyAuthError(error);
                    errorMessage.style.display = 'block';
                });
        } else {
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    console.log("Utworzono konto i zalogowano:", userCredential.user.email);
                    hideAuthPopup();
                })
                .catch(error => {
                    errorMessage.textContent = getFriendlyAuthError(error);
                    errorMessage.style.display = 'block';
                });
        }
    }
    
    function logoutUser() {
        auth.signOut().then(() => {
            console.log("UÅ¼ytkownik wylogowany.");
            showNotification("Wylogowano pomyÅ›lnie.", 2000, 'info');
        });
    }

    // NasÅ‚uchiwacz zmian stanu autentykacji
    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            updateUIForUser(user);
            fetchDataFromFirestore();
        } else {
            currentUser = null;
            updateUIForUser(null);
            // Opcjonalnie: wyczyÅ›Ä‡ dane lokalne po wylogowaniu
            // if (confirm("Czy chcesz wyczyÅ›ciÄ‡ lokalne dane (magazyn, decki) po wylogowaniu?")) {
            //     wykonajWyczyszczenieDanych();
            // }
        }
    });

    function updateUIForUser(user) {
        const loggedInView = document.getElementById('logged-in-view');
        const loggedOutView = document.getElementById('logged-out-view');
        
        if (user) {
            document.getElementById('user-email-display').textContent = `Zalogowano jako: ${user.email}`;
            loggedInView.style.display = 'block';
            loggedOutView.style.display = 'none';
        } else {
            loggedInView.style.display = 'none';
            loggedOutView.style.display = 'block';
            document.getElementById('last-sync-display').textContent = "Ostatnia synch.: Nigdy";
        }
    }

    function syncData() {
        if (!currentUser) {
            showNotification("Musisz byÄ‡ zalogowany, aby synchronizowaÄ‡ dane.", 3000, 'warning');
            return;
        }

        const magazyn = getMagazyn();
        const decks = getSavedDecks();

        showNotification("Rozpoczynam synchronizacjÄ™...", 2000, 'info');

        db.collection('userData').doc(currentUser.uid).set({
            magazyn: JSON.stringify(magazyn),
            decks: JSON.stringify(decks),
            lastSync: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            showNotification("Dane zsynchronizowane z chmurÄ…!", 3000, 'success');
            const syncTime = new Date().toLocaleString('pl-PL');
            document.getElementById('last-sync-display').textContent = `Ostatnia synch.: ${syncTime}`;
            localStorage.setItem(`lastSync_${currentUser.uid}`, syncTime);
        })
        .catch(error => {
            console.error("BÅ‚Ä…d synchronizacji:", error);
            showNotification("BÅ‚Ä…d synchronizacji z chmurÄ….", 4000, 'error');
        });
    }

    function fetchDataFromFirestore() {
        if (!currentUser) return;

        showNotification("Sprawdzam dane w chmurze...", 1500, 'info');

        db.collection('userData').doc(currentUser.uid).get().then(doc => {
            if (doc.exists) {
                const data = doc.data();
                
                const localMagazyn = getMagazyn();
                const localDecks = getSavedDecks();
                
                // Sprawdzamy czy sÄ… jakiekolwiek dane lokalnie
                const hasLocalData = localMagazyn.some(p => p.ilosc > 0) || localDecks.length > 0;

                const importData = () => {
                    try {
                        let importedSomething = false;
                        if (data.magazyn) {
                            const cloudMagazyn = JSON.parse(data.magazyn);
                            setMagazyn(cloudMagazyn);
                            importedSomething = true;
                        }
                        if (data.decks) {
                            const cloudDecks = JSON.parse(data.decks);
                            setSavedDecks(cloudDecks);
                            importedSomething = true;
                        }
                        
                        if(importedSomething) {
                            const syncTime = data.lastSync?.toDate().toLocaleString('pl-PL') || 'Niedawno';
                            document.getElementById('last-sync-display').textContent = `Ostatnia synch.: ${syncTime}`;
                            localStorage.setItem(`lastSync_${currentUser.uid}`, syncTime);

                            showNotification("Dane pomyÅ›lnie zaimportowane z chmury!", 3000, 'success');
                            // OdÅ›wieÅ¼ widoki, jeÅ›li sÄ… aktywne
                            if (document.querySelector('#magazyn.active')) wyswietlMagazyn();
                            if (document.querySelector('#galeriaDeckow.active')) displaySavedDecks();
                        }
                    } catch (e) {
                        showNotification("BÅ‚Ä…d przetwarzania danych z chmury.", 4000, 'error');
                    }
                };

                if (hasLocalData) {
                     if (confirm("Znaleziono dane w chmurze. Czy chcesz je zaimportowaÄ‡, NADPISUJÄ„C swoje obecne lokalne dane (magazyn i decki)?")) {
                        importData();
                    }
                } else {
                    // JeÅ›li nie ma danych lokalnych, importujemy automatycznie
                    importData();
                }
            } else {
                console.log("Brak danych w chmurze dla tego uÅ¼ytkownika. MoÅ¼esz je zapisaÄ‡, uÅ¼ywajÄ…c przycisku 'Synchronizuj dane'.");
            }
        }).catch(error => {
            console.error("BÅ‚Ä…d pobierania danych:", error);
            showNotification("Nie udaÅ‚o siÄ™ pobraÄ‡ danych z chmury.", 3000, 'error');
        });

        const localSyncTime = localStorage.getItem(`lastSync_${currentUser.uid}`);
        if(localSyncTime) {
            document.getElementById('last-sync-display').textContent = `Ostatnia synch.: ${localSyncTime}`;
        }
    }
    
    function getFriendlyAuthError(error) {
        switch (error.code) {
            case 'auth/wrong-password':
                return 'NieprawidÅ‚owe hasÅ‚o. SprÃ³buj ponownie.';
            case 'auth/user-not-found':
                return 'Nie znaleziono uÅ¼ytkownika o tym adresie e-mail.';
            case 'auth/email-already-in-use':
                return 'Ten adres e-mail jest juÅ¼ zajÄ™ty.';
            case 'auth/weak-password':
                return 'HasÅ‚o jest zbyt sÅ‚abe. Powinno mieÄ‡ co najmniej 6 znakÃ³w.';
            default:
                return 'WystÄ…piÅ‚ nieznany bÅ‚Ä…d. SprÃ³buj ponownie.';
        }
    }

        </script>

        <!-- DomyÅ›lna Baza Danych JSON -->
        <script id="domyslnaBazaDanychJson" type="application/json">
            [
                {
                    "id": "1", "typ": "ux-blade","kierunek": "prawy", "nazwa": "AeroPegasus", "ilosc": 0, "img":"img/BladeAeroPegasus.webp", "ATK": 70, "DEF": 30, "STM": 35, "waga": 38.3},
                {
                    "id": "2", "typ": "ux-blade","kierunek": "prawy", "nazwa": "DranBuster", "ilosc": 0, "img": "img/BladeDranBuster.webp", "ATK": 70, "DEF": 20, "STM": 10, "waga": 36.5},
                {
                    "id": "3", "typ": "ux-blade","kierunek": "prawy", "nazwa": "GhostCircle", "ilosc": 0, "img": "img/BladeGhostCircle.webp", "ATK": 5, "DEF": 40, "STM": 55, "waga": 26.7},
                {
                    "id": "4", "typ": "ux-blade","kierunek": "prawy", "nazwa": "GolemRock", "ilosc": 0, "img": "img/BladeGolemRock.webp", "ATK": 30, "DEF": 60, "STM": 10, "waga": 34},
                {
                    "id": "5", "typ": "ux-blade","kierunek": "prawy", "nazwa": "HellsHammer", "ilosc": 0, "img": "img/BladeHellsHammer.webp", "ATK": 50, "DEF": 25, "STM": 25, "waga": 33},
                {
                    "id": "6", "typ": "ux-blade","kierunek": "prawy", "nazwa": "ImpactDrake", "ilosc": 0, "img": "img/BladeImpactDrake.webp", "ATK": 75, "DEF": 25, "STM":10, "waga": 39},
                {
                    "id": "7", "typ": "ux-blade","kierunek": "prawy", "nazwa": "KnightMail", "ilosc": 0, "img": "img/BladeKnightMail.webp", "ATK": 10, "DEF": 65, "STM": 35, "waga": 36.7},
                {
                    "id": "8", "typ": "ux-blade","kierunek": "prawy", "nazwa": "LeonCrest", "ilosc": 0, "img": "img/BladeLeonCrest.webp", "ATK": 15, "DEF": 70, "STM": 15, "waga": 35},
                {
                    "id": "9", "typ": "ux-blade","kierunek": "prawy", "nazwa": "PhoenixRudder", "ilosc": 0, "img": "img/BladePhoenixRudder.webp", "ATK": 10, "DEF": 35, "STM": 55, "waga": 34.5},
                {
                    "id": "10", "typ": "ux-blade","kierunek": "prawy", "nazwa": "SamuraiSaber", "ilosc": 0, "img": "img/BladeSamuraiSaber.webp", "ATK": 65, "DEF": 20, "STM": 25, "waga": 36.5},
                {
                    "id": "11", "typ": "ux-blade","kierunek": "prawy", "nazwa": "ScorpioSpear", "ilosc": 0, "img": "img/BladeScorpioSpear.webp", "ATK": 25, "DEF": 55, "STM": 30, "waga": 39.6},
                {
                    "id": "12", "typ": "ux-blade","kierunek": "prawy", "nazwa": "SharkScale", "ilosc": 0, "img": "img/BladeSharkScale.webp", "ATK": 70, "DEF": 15, "STM": 15, "waga": 37.6},
                {
                    "id": "13", "typ": "ux-blade","kierunek": "prawy", "nazwa": "ShinobiShadow", "ilosc": 0, "img": "img/BladeShinobiShadow.webp", "ATK": 10, "DEF": 70, "STM": 20, "waga": 28.2},
                {
                    "id": "14", "typ": "ux-blade","kierunek": "prawy", "nazwa": "SilverWolf", "ilosc": 0, "img": "img/BladeSilverWolf.webp", "ATK": 15, "DEF": 30, "STM": 65, "waga": 36.8},
                {
                    "id": "15", "typ": "ux-blade","kierunek": "prawy", "nazwa": "WizardRod", "ilosc": 0, "img": "img/BladeWizardRod.webp", "ATK": 15, "DEF": 25, "STM": 60, "waga": 35.3},
                {
                    "id": "16", "typ": "ux-blade","kierunek": "prawy", "nazwa": "WyvernHover", "ilosc": 0, "img": "img/BladeWyvernHover.webp", "ATK": 13, "DEF": 60, "STM": 27, "waga": 35},
                {
                    "id": "17", "typ": "blade","kierunek": "prawy", "nazwa": "BlackShell", "ilosc": 0, "img": "img/BladeBlackShell.webp", "ATK": 10, "DEF": 65, "STM": 25, "waga": 32.4},
                {
                    "id": "18", "typ": "blade","kierunek": "lewy", "nazwa": "CobaltDragoon", "ilosc": 0, "img": "img/BladeCobaltDragoon.webp", "ATK": 60, "DEF":15, "STM": 25, "waga": 37.8},
                {
                    "id": "19", "typ": "blade","kierunek": "prawy", "nazwa": "CobaltDrake", "ilosc": 0, "img": "img/BladeCobaltDrake.webp", "ATK": 65, "DEF": 30, "STM": 20, "waga": 37.3},
                {
                    "id": "20", "typ": "blade","kierunek": "prawy", "nazwa": "CrimsonGaruda", "ilosc": 0, "img": "img/BladeCrimsonGaruda.webp", "ATK": 45, "DEF": 25, "STM": 30, "waga": 35},
                {
                    "id": "21", "typ": "blade","kierunek": "prawy", "nazwa": "DranDagger", "ilosc": 0, "img": "img/BladeDranDagger.webp", "ATK": 50, "DEF": 25, "STM": 25, "waga": 36},
                {
                    "id": "22", "typ": "blade","kierunek": "prawy", "nazwa": "DranSword", "ilosc": 0, "img": "img/BladeDranSword.webp", "ATK": 55, "DEF": 25, "STM": 20, "waga": 35.1},
                {
                    "id": "23", "typ": "blade","kierunek": "prawy", "nazwa": "HellsChain", "ilosc": 0, "img": "img/BladeHellsChain.webp", "ATK": 35, "DEF": 40, "STM": 25, "waga": 32.2},
                {
                    "id": "24", "typ": "blade","kierunek": "prawy", "nazwa": "HellsScythe", "ilosc": 0, "img": "img/BladeHellsScythe.webp", "ATK": 30, "DEF": 35, "STM": 35, "waga": 33},
                {
                    "id": "25", "typ": "blade","kierunek": "prawy", "nazwa": "KnightLance", "ilosc": 0, "img": "img/BladeKnightLance.webp", "ATK": 25, "DEF": 60, "STM": 15, "waga": 32.9},
                {
                    "id": "26", "typ": "blade","kierunek": "prawy", "nazwa": "KnightShield", "ilosc": 0, "img": "img/BladeKnightShield.webp", "ATK": 20, "DEF": 55, "STM": 25, "waga": 34.8},
                {
                    "id": "27", "typ": "blade","kierunek": "prawy", "nazwa": "LeonClaw", "ilosc": 0, "img": "img/BladeLeonClaw.webp", "ATK": 40, "DEF": 40, "STM": 20, "waga": 31.4},
                {
                    "id": "28", "typ": "blade","kierunek": "prawy", "nazwa": "PhoenixFeather", "ilosc": 0, "img": "img/BladePhoenixFeather.webp", "ATK": 50, "DEF": 20, "STM": 30, "waga": 33.3},
                {
                    "id": "29", "typ": "blade","kierunek": "prawy", "nazwa": "PhoenixWing", "ilosc": 0, "img": "img/BladePhoenixWing.webp", "ATK": 60, "DEF": 25, "STM": 15, "waga": 39},
                {
                    "id": "30", "typ": "blade","kierunek": "prawy", "nazwa": "RhinoHorn", "ilosc": 0, "img": "img/BladeRhinoHorn.webp", "ATK": 20, "DEF": 50, "STM": 30, "waga": 32.7},
                {
                    "id": "31", "typ": "blade","kierunek": "prawy", "nazwa": "SamuraiCalibur", "ilosc": 0, "img": "img/BladeSamuraiCalibur.webp", "ATK": 40, "DEF": 30, "STM": 30, "waga":36},
                {
                    "id": "32", "typ": "blade","kierunek": "prawy", "nazwa": "SharkEdge", "ilosc": 0, "img": "img/BladeSharkEdge.webp", "ATK": 60, "DEF": 25, "STM": 15, "waga": 34.5},
                {
                    "id": "33", "typ": "blade","kierunek": "prawy", "nazwa": "ShelterDrake", "ilosc": 0, "img": "img/BladeShelterDrake.webp", "ATK": 25, "DEF": 40, "STM": 35, "waga": 32.6},
                {
                    "id": "34", "typ": "blade","kierunek": "prawy", "nazwa": "SphinxCowl", "ilosc": 0, "img": "img/BladeSphinxCowl.webp", "ATK": 35, "DEF": 55, "STM": 10, "waga": 32.7},
                {
                    "id": "35", "typ": "blade","kierunek": "prawy", "nazwa": "TriceraPress", "ilosc": 0, "img": "img/BladeTriceraPress.webp", "ATK":20, "DEF": 65, "STM": 15, "waga": 36.5},
                {
                    "id": "36", "typ": "blade","kierunek": "prawy", "nazwa": "TyrannoBeat", "ilosc": 0, "img": "img/BladeTyrannoBeat.webp", "ATK": 65, "DEF": 30, "STM": 5, "waga":37},
                {
                    "id": "37", "typ": "blade","kierunek": "prawy", "nazwa": "UnicornSting", "ilosc": 0, "img": "img/BladeUnicornSting.webp", "ATK": 35, "DEF": 35, "STM": 30, "waga": 34},
                {
                    "id": "38", "typ": "blade","kierunek": "prawy", "nazwa": "ViperTail", "ilosc": 0, "img": "img/BladeViperTail.webp", "ATK": 30, "DEF": 20, "STM": 50, "waga": 34.7},
                {
                    "id": "39", "typ": "blade","kierunek": "prawy", "nazwa": "WeissTiger", "ilosc": 0, "img": "img/BladeWeissTiger.webp", "ATK": 45, "DEF": 30, "STM": 25, "waga": 34.6},
                {
                    "id": "40", "typ": "blade","kierunek": "prawy", "nazwa": "WhaleWave", "ilosc": 0, "img": "img/BladeWhaleWave.webp", "ATK": 45, "DEF": 35, "STM": 20, "waga": 38.2},
                {
                    "id": "41", "typ": "blade","kierunek": "prawy", "nazwa": "WizardArrow", "ilosc": 0, "img": "img/BladeWizardArrow.webp", "ATK": 15, "DEF": 30, "STM": 55, "waga": 31.8},
                {
                    "id": "42", "typ": "blade","kierunek": "prawy", "nazwa": "WyvernGale", "ilosc": 0, "img": "img/BladeWyvernGale.webp", "ATK": 10, "DEF": 40, "STM": 50, "waga": 31.9},
                {
                    "id": "43", "typ": "blade","kierunek": "prawy",
                    "nazwa": "Bite Croc",
                    "ilosc": 1,
                    "img": "img/BladeBite-Croc.webp",
                    "ATK": 60,
                    "DEF": 22,
                    "STM": 18,
                    "waga": 34.1
                },
                {
                    "id": "44", "typ": "blade","kierunek": "prawy", "nazwa": "GillShark", "ilosc": 0, "img": "img/BladeGill-Shark.webp", "ATK": 20, "DEF": 25, "STM": 55, "waga": 29.6},
                {
                    "id": "45", "typ": "blade","kierunek": "prawy", "nazwa": "ShinobiKnife", "ilosc": 0, "img": "img/BladeKnifeShinobi.webp", "ATK": 23, "DEF": 50, "STM": 27, "waga": 30.9},
                {
                    "id": "46", "typ": "blade","kierunek": "prawy", "nazwa": "TriceraSpiky", "ilosc": 0, "img": "img/BladeTriceraSpiky.webp", "ATK": 32, "DEF": 55, "STM": 13, "waga": 29.9},
                {
                    "id": "47", "typ": "blade","kierunek": "prawy", "nazwa": "TyrannoRoar", "ilosc": 0, "img": "img/BladeRoar-Tyranno.webp", "ATK": 60, "DEF": 28, "STM": 12, "waga": 36},
                {
                    "id": "48", "typ": "blade","kierunek": "prawy", "nazwa": "BearScratch", "ilosc": 0, "img": "img/BladeSavage-Bear.webp", "ATK": 25, "DEF": 45, "STM": 30, "waga": 29.6},
                {
                    "id": "49", "typ": "blade","kierunek": "prawy", "nazwa": "SamuraiSteel", "ilosc": 0, "img": "img/BladeSteel-Samurai.webp", "ATK": 40, "DEF": 37, "STM": 23, "waga": 31.2},
                {
                    "id": "50", "typ": "blade","kierunek": "prawy", "nazwa": "GoatTackle", "ilosc": 0, "img": "img/BladeTackle-Goat.webp", "ATK": 13, "DEF": 65, "STM": 22, "waga": 31.5},
                {
                    "id": "51", "typ": "blade","kierunek": "prawy", "nazwa": "PteraSwing", "ilosc": 0, "img": "img/BladeTalon-Ptera.webp", "ATK": 27, "DEF": 23, "STM": 50, "waga": 34.4},
                {
                    "id": "52", "typ": "blade","kierunek": "prawy", "nazwa": "MammothTusk", "ilosc": 0, "img": "img/BladeTusk-Mammoth.webp", "ATK": 33, "DEF": 35, "STM": 32, "waga": 32},
                {
                    "id": "53", "typ": "blade","kierunek": "prawy", "nazwa": "KongYell", "ilosc": 0, "img": "img/BladeYell-Kong.webp", "ATK": 13, "DEF": 37, "STM": 50, "waga": 31.1},
                {
                    "id": "54", "typ": "blade","kierunek": "lewy", "nazwa": "DragoonStorm", "ilosc": 0, "img": "img/BladeDragoon-Storm.webp", "ATK": 55, "DEF": 30, "STM": 15, "waga": 25.1},
                {
                    "id": "55", "typ": "blade","kierunek": "prawy", "nazwa": "DranzerSpiral", "ilosc": 0, "img": "img/BladeDranzerSpiral.webp", "ATK": 35, "DEF": 30, "STM": 35, "waga": 27.7},
                {
                    "id": "56", "typ": "blade","kierunek": "prawy", "nazwa": "DrigerSlash", "ilosc": 0, "img": "img/BladeDrigerSlash.webp", "ATK": 40, "DEF": 35, "STM": 25, "waga": 28.6},
                {
                    "id": "57", "typ": "blade","kierunek": "prawy", "nazwa": "DracielShield", "ilosc": 0, "img": "img/BladeDracielShield.webp", "ATK": 30, "DEF": 50, "STM": 20, "waga": 28},
                {
                    "id": "58", "typ": "blade","kierunek": "lewy", "nazwa": "Lightning L-Drago (Rapid-Hit Type)", "ilosc": 0, "img": "img/BladeLightningL_(Rapid-Hit_Type).webp", "ATK": 50, "DEF": 30, "STM": 20, "waga": 33.5},
                {
                    "id": "59", "typ": "blade","kierunek": "lewy", "nazwa": "Lightning L-Drago (Upper Type)", "ilosc": 0, "img": "img/BladeLightningL_(Upper_Type).webp", "ATK": 55, "DEF": 25, "STM": 20, "waga": 34},
                {
                    "id": "60", "typ": "blade","kierunek": "prawy", "nazwa": "Rock Leone", "ilosc": 0, "img": "img/BladeRock-Leone.webp", "ATK": 30, "DEF": 55, "STM": 15, "waga": 29.8},
                {
                    "id": "61", "typ": "blade","kierunek": "prawy", "nazwa": "StormPegasis", "ilosc": 0, "img": "img/BladeStorm-Pegasis.webp", "ATK": 55, "DEF": 15, "STM": 30, "waga": 31},
                {
                    "id": "62", "typ": "blade","kierunek": "prawy", "nazwa": "Trypio", "ilosc": 0, "img": "img/Trypio_3-60N.webp", "ATK": 0, "DEF": 0, "STM": 0, "waga": 0},
                {
                    "id": "63", "typ": "blade","kierunek": "prawy", "nazwa": "VictoryValkyrie", "ilosc": 0, "img": "img/BladeVictory-Valkyrie.webp", "ATK": 55, "DEF": 20, "STM": 25, "waga": 33.2},
                {
                    "id": "215", "typ": "blade","kierunek": "prawy", "nazwa": "XenoXcalibur", "ilosc": 0, "img": "img/BladeXenoXcalibur.webp", "ATK": 65, "DEF": 25, "STM": 10, "waga": 31},
                {
                    "id": "64", "typ": "blade","kierunek": "prawy", "nazwa": "Quetzalcoatlus", "ilosc": 0, "img": "img/BladeQuetzalcoatlus.webp", "ATK": 27, "DEF": 23, "STM": 50, "waga": 34.3},
                {
                    "id": "65", "typ": "blade","kierunek": "prawy", "nazwa": "Spinosaurus", "ilosc": 0, "img": "img/BladeSpinosaurus.webp", "ATK": 60, "DEF": 28, "STM": 12, "waga": 36},
                {
                    "id": "66", "typ": "blade","kierunek": "prawy", "nazwa": "T.Rex", "ilosc": 0, "img": "img/BladeT._Rex.webp", "ATK": 65, "DEF": 30, "STM": 5, "waga": 37},
                {
                    "id": "67", "typ": "blade","kierunek": "prawy", "nazwa": "Captain America", "ilosc": 0, "img": "img/BladeCaptainAmerica.webp", "ATK": 55, "DEF": 28, "STM": 17, "waga": 32.3},
                {
                    "id": "68", "typ": "blade","kierunek": "prawy", "nazwa": "Green Goblin", "ilosc": 0, "img": "img/BladeGreen_Goblin.webp", "ATK": 17, "DEF": 28, "STM": 55, "waga": 31.7},
                {
                    "id": "69", "typ": "blade","kierunek": "prawy", "nazwa": "Iron Man", "ilosc": 0, "img": "img/BladeIron_Man.webp", "ATK": 17, "DEF": 55, "STM": 28, "waga": 33.6},
                {
                    "id": "70", "typ": "blade","kierunek": "prawy", "nazwa": "Miles Morales", "ilosc": 0, "img": "img/BladeMiles_Morales.webp", "ATK": 12, "DEF": 33, "STM": 55, "waga": 31.7},
                {
                    "id": "71", "typ": "blade","kierunek": "prawy", "nazwa": "Red Hulk", "ilosc": 0, "img": "img/BladeRed_Hulk.webp", "ATK": 65, "DEF": 27, "STM": 8, "waga": 36.3},
                {
                    "id": "72", "typ": "blade","kierunek": "prawy", "nazwa": "Spider-Man", "ilosc": 0, "img": "img/BladeSpider-Man.webp", "ATK": 33, "DEF": 17, "STM": 50, "waga": 33.2},
                {
                    "id": "73", "typ": "blade","kierunek": "prawy", "nazwa": "Thanos", "ilosc": 0, "img": "img/BladeThanos.webp", "ATK": 22, "DEF": 60, "STM": 18, "waga": 29.5},
                {
                    "id": "74", "typ": "blade","kierunek": "prawy", "nazwa": "Venom", "ilosc": 0, "img": "img/BladeVenom.webp", "ATK": 55, "DEF": 22, "STM": 23, "waga": 34.3},
                {
                    "id": "75", "typ": "blade","kierunek": "prawy", "nazwa": "Chewbacca", "ilosc": 0, "img": "img/BladeChewbacca.webp", "ATK": 22, "DEF": 23, "STM": 55, "waga": 31.8},
                {
                    "id": "76", "typ": "blade","kierunek": "prawy", "nazwa": "Darth Vader", "ilosc": 0, "img": "img/BladeDarth_Vader.webp", "ATK": 28, "DEF": 60, "STM": 12, "waga": 30.7},
                {
                    "id": "77", "typ": "blade","kierunek": "prawy", "nazwa": "General Grievous", "ilosc": 0, "img": "img/BladeGeneral_Grievous.webp", "ATK": 22, "DEF": 55, "STM": 28, "waga": 31},
                {
                    "id": "78", "typ": "blade","kierunek": "prawy", "nazwa": "Luke Skywalker", "ilosc": 0, "img": "img/BladeLuke_Skywalker.webp", "ATK": 23, "DEF": 55, "STM": 22, "waga": 31.5},
                {
                    "id": "79", "typ": "blade","kierunek": "prawy", "nazwa": "Moff Gideon", "ilosc": 0, "img": "img/BladeMoff_Gideon.webp", "ATK": 32, "DEF": 35, "STM": 33, "waga": 30.5},
                {
                    "id": "80", "typ": "blade","kierunek": "prawy", "nazwa": "Obi-Wan Kenobi", "ilosc": 0, "img": "img/BladeObi-Wan_Kenobi.webp", "ATK": 23, "DEF": 60, "STM": 17, "waga": 30.6},
                {
                    "id": "81", "typ": "blade","kierunek": "prawy", "nazwa": "Stormtrooper", "ilosc": 0, "img": "img/BladeStormtrooper.webp", "ATK": 18, "DEF": 50, "STM": 32, "waga": 33.6},
                {
                    "id": "82", "typ": "blade","kierunek": "prawy", "nazwa": "Mandalorian", "ilosc": 0, "img": "img/BladeMandalorian.webp", "ATK": 30.3, "DEF": 40, "STM": 43, "waga": 17},
                {
                    "id": "83", "typ": "blade","kierunek": "prawy", "nazwa": "Bumblebee", "ilosc": 0, "img": "img/BladeBumblebee.webp", "ATK": 21, "DEF": 55, "STM": 24, "waga": 34.8},
                {
                    "id": "84", "typ": "blade","kierunek": "prawy", "nazwa": "Megatron", "ilosc": 0, "img": "img/BladeMegatron.webp", "ATK": 27, "DEF": 35, "STM": 38, "waga": 31.1},
                {
                    "id": "85", "typ": "blade","kierunek": "prawy", "nazwa": "Optimus Primal", "ilosc": 0, "img": "img/BladeOptimus_Primal.webp", "ATK": 60, "DEF": 27, "STM": 13, "waga": 35.7},
                {
                    "id": "86", "typ": "blade","kierunek": "prawy", "nazwa": "Optimus Prime", "ilosc": 0, "img": "img/BladeOptimus_Prime.webp", "ATK": 22, "DEF": 55, "STM": 23, "waga": 33.3},
                {
                    "id": "87", "typ": "blade","kierunek": "prawy", "nazwa": "Shockwave", "ilosc": 0, "img": "img/BladeShockwave.webp", "ATK": 32, "DEF": 18, "STM": 50, "waga": 34.7},
                {
                    "id": "88", "typ": "blade","kierunek": "prawy", "nazwa": "Starscream", "ilosc": 0, "img": "img/BladeStarscream.webp", "ATK": 18, "DEF": 27, "STM": 55, "waga": 29.5},

                {
                    "id": "96", "typ": "rachet", "nazwa": "1-70", "ilosc": 0, "img": "img/Ratchet1-70.webp", "ATK": 17, "DEF": 6, "STM": 7, "waga": 7.3},
                {
                    "id": "97", "typ": "rachet", "nazwa": "2-60", "ilosc": 0, "img": "img/Ratchet2-60.webp", "ATK": 16, "DEF": 8, "STM": 6, "waga": 6.2},
                {
                    "id": "98", "typ": "rachet", "nazwa": "2-80", "ilosc": 0, "img": "img/Ratchet2-80.webp", "ATK": 10, "DEF": 11, "STM": 9, "waga": 6.9},
                {
                    "id": "99", "typ": "rachet", "nazwa": "3-60", "ilosc": 0, "img": "img/Ratchet3-60.webp", "ATK": 15, "DEF": 9, "STM": 6, "waga": 6.4},
                {
                    "id": "100", "typ": "rachet", "nazwa": "3-80", "ilosc": 0, "img": "img/Ratchet3-80.webp", "ATK":15, "DEF": 7, "STM": 8, "waga": 7.1},
                {
                    "id": "101", "typ": "rachet", "nazwa": "4-60", "ilosc": 0, "img": "img/Ratchet4-60.webp", "ATK": 11, "DEF": 13, "STM": 6, "waga": 6.3},
                {
                    "id": "102", "typ": "rachet", "nazwa": "4-70", "ilosc": 0, "img": "img/Ratchet4-70.webp", "ATK": 11, "DEF": 12, "STM": 7, "waga": 6.4},
                {
                    "id": "103", "typ": "rachet", "nazwa": "4-80", "ilosc": 0, "img": "img/Ratchet4-80.webp", "ATK": 11, "DEF": 11, "STM": 8, "waga": 7},
                {
                    "id": "104", "typ": "rachet", "nazwa": "5-60", "ilosc": 0, "img": "img/Ratchet5-60.webp", "ATK": 12, "DEF": 9, "STM": 9, "waga": 6.6},
                {
                    "id": "105", "typ": "rachet", "nazwa": "5-80", "ilosc": 0, "img": "img/Ratchet5-80.webp", "ATK": 12, "DEF": 8, "STM": 10, "waga": 7.3},
                {
                    "id": "106", "typ": "rachet", "nazwa": "6-70", "ilosc": 0, "img": "img/Ratchet6-70.webp", "ATK": 14, "DEF": 7, "STM": 9, "waga": 7.3},
                {
                    "id": "107", "typ": "rachet", "nazwa": "7-80", "ilosc": 0, "img": "img/Ratchet7-80.webp", "ATK": 7, "DEF": 14, "STM": 9, "waga": 7.8},
                {
                    "id": "108", "typ": "rachet", "nazwa": "9-60", "ilosc": 0, "img": "img/Ratchet9-60.webp", "ATK": 13, "DEF": 10, "STM": 7, "waga": 6.2},
                {
                    "id": "109", "typ": "rachet", "nazwa": "9-80", "ilosc": 0, "img": "img/Ratchet9-80.webp", "ATK": 13, "DEF": 10, "STM": 7, "waga": 6.9},
                {
                    "id": "110", "typ": "rachet", "nazwa": "M-85", "ilosc": 0, "img": "img/RatchetM-85.webp", "ATK": 8, "DEF": 19, "STM": 13, "waga": 10.6},
                {
                    "id": "111", "typ": "rachet", "nazwa": "0-70", "ilosc": 0, "img": "img/Ratchet0-70.webp", "ATK": 3, "DEF": 13, "STM": 14, "waga": 7.0},
                {
                    "id": "112", "typ": "rachet", "nazwa": "0-80", "ilosc": 0, "img": "img/Ratchet0-80.webp", "ATK": 3, "DEF": 12, "STM": 15, "waga": 7.6},
                {
                    "id": "113", "typ": "rachet", "nazwa": "1-60", "ilosc": 0, "img": "img/Ratchet1-60.webp", "ATK": 17, "DEF": 9, "STM": 4, "waga": 6.0},
                {
                    "id": "114", "typ": "rachet", "nazwa": "1-80", "ilosc": 0, "img": "img/Ratchet1-80.webp", "ATK": 17, "DEF": 4, "STM": 9, "waga":6.7},
                {
                    "id": "115", "typ": "rachet", "nazwa": "2-70", "ilosc": 0, "img": "img/Ratchet2-70.webp", "ATK": 10, "DEF": 12, "STM": 8, "waga": 6.4},
                {
                    "id": "116", "typ": "rachet", "nazwa": "3-70", "ilosc": 0, "img": "img/Ratchet3-70.webp", "ATK": 15, "DEF": 8, "STM": 7, "waga": 6.4},
                {
                    "id": "117", "typ": "rachet", "nazwa": "3-85", "ilosc": 0, "img": "img/Ratchet3-85.webp", "ATK": 5, "DEF": 15, "STM": 10, "waga": 4.7},
                {
                    "id": "118", "typ": "rachet", "nazwa": "4-50", "ilosc": 0, "img": "img/Ratchet4-50.webp", "ATK": 12, "DEF": 13, "STM": 5, "waga": 5.9},
                {
                    "id": "119", "typ": "rachet", "nazwa": "5-70", "ilosc": 0, "img": "img/Ratchet5-70.webp", "ATK": 12, "DEF": 8, "STM": 10, "waga": 6.7},
                {
                    "id": "120", "typ": "rachet", "nazwa": "7-60", "ilosc": 0, "img": "img/Ratchet7-60.webp", "ATK": 8, "DEF": 14, "STM": 8, "waga": 7.1},
                {
                    "id": "121", "typ": "rachet", "nazwa": "7-70", "ilosc": 0, "img": "img/Ratchet7-70.webp", "ATK": 8, "DEF": 12, "STM": 10, "waga": 7.3},
                {
                    "id": "122", "typ": "rachet", "nazwa": "9-70", "ilosc": 0, "img": "img/Ratchet9-70.webp", "ATK": 13, "DEF": 10, "STM": 7, "waga": 6.3},
                {
                    "id": "123", "typ": "rachet", "nazwa": "4-55", "ilosc": 0, "img": "img/Ratchet4-55.webp", "ATK": 7, "DEF": 11, "STM": 12, "waga": 4.8 },
                {
                    "id": "124", "typ": "rachet", "nazwa": "6-60", "ilosc": 0, "img": "img/Ratchet6-60.webp", "ATK": 14, "DEF": 8, "STM": 8, "waga": 6.1 },
                {
                    "id": "125", "typ": "rachet", "nazwa": "6-80", "ilosc": 0, "img": "img/Ratchet6-80.webp", "ATK": 14, "DEF": 6, "STM": 10, "waga": 6.9 },
                {
                    "id": "126", "typ": "bit","rodzaj": "wytrzymalosc", "nazwa": "Ball", "skroconaNazwa": "B", "ilosc": 0, "img": "img/BitBall.webp", "ATK":15, "DEF": 25, "STM": 50, "waga": 2.1, "DASH": 10, "BURST_RES": 30},
                {
                    "id": "127", "typ": "bit","rodzaj": "atak", "nazwa": "Cyclone", "skroconaNazwa": "C", "ilosc": 0, "img": "img/BitCyclone.webp", "ATK": 40, "DEF": 5, "STM": 10, "waga":2.1, "DASH": 45, "BURST_RES": 80},
                {
                    "id": "128", "typ": "bit","rodzaj": "obrona", "nazwa": "Dot", "skroconaNazwa": "D", "ilosc": 0, "img": "img/BitDot.webp", "ATK": 10, "DEF": 55, "STM": 25, "waga": 2.0, "DASH": 10, "BURST_RES": 30},
                {
                    "id": "129", "typ": "bit","rodzaj": "balans", "nazwa": "Elevate", "skroconaNazwa": "E", "ilosc": 0, "img": "img/BitElevate.webp", "ATK": 30, "DEF": 15, "STM": 20, "waga": 3.2, "DASH": 35, "BURST_RES": 30},
                {
                    "id": "130", "typ": "bit","rodzaj": "atak", "nazwa": "Flat", "skroconaNazwa": "F", "ilosc": 0, "img": "img/BitFlat.webp", "ATK": 40, "DEF": 15, "STM": 10, "waga": 2.2, "DASH": 35, "BURST_RES": 80},
                {
                    "id": "131", "typ": "bit","rodzaj": "wytrzymalosc", "nazwa": "Gear Ball", "skroconaNazwa": "GB", "ilosc": 0, "img": "img/BitGearBall.webp", "ATK": 10, "DEF": 15, "STM": 45, "waga": 2.0, "DASH": 30, "BURST_RES": 30},
                {
                    "id": "132", "typ": "bit","rodzaj": "atak", "nazwa": "Gear Flat", "skroconaNazwa": "GF", "ilosc": 0, "img": "img/BitGearFlat.webp", "ATK": 50, "DEF": 5, "STM": 5, "waga": 2.3, "DASH": 40, "BURST_RES": 80},
                {
                    "id": "133", "typ": "bit","rodzaj": "obrona", "nazwa": "Gear Needle", "skroconaNazwa": "GN", "ilosc": 0, "img": "img/BitGearNeedle.webp", "ATK": 20, "DEF": 40, "STM": 10, "waga": 2.0, "DASH": 30, "BURST_RES": 30},
                {
                    "id": "134", "typ": "bit","rodzaj": "balans", "nazwa": "Gear Point", "skroconaNazwa": "GP", "ilosc": 0, "img": "img/BitGearPoint.webp", "ATK": 30, "DEF": 25, "STM": 15, "waga": 2.3, "DASH": 30, "BURST_RES": 80},
                {
                    "id": "135", "typ": "bit","rodzaj": "obrona", "nazwa": "High Needle", "skroconaNazwa": "HN", "ilosc": 0, "img": "img/BitHighNeedle.webp", "ATK": 15, "DEF": 55, "STM": 20, "waga": 2.2, "DASH": 10, "BURST_RES": 30},
                {
                    "id": "136", "typ": "bit","rodzaj": "balans", "nazwa": "High Taper", "skroconaNazwa": "HT", "ilosc": 0, "img": "img/BitHighTaper.webp", "ATK": 30, "DEF": 25, "STM": 20, "waga": 2.2, "DASH": 25, "BURST_RES": 80},
                {
                    "id": "137", "typ": "bit","rodzaj": "atak", "nazwa": "Low Flat", "skroconaNazwa": "LF", "ilosc": 0, "img": "img/BitLowFlat.webp", "ATK": 45, "DEF": 5, "STM": 10, "waga": 2.1, "DASH": 40, "BURST_RES": 80},
                {
                    "id": "138", "typ": "bit","rodzaj": "balans", "nazwa": "Merge", "skroconaNazwa": "M", "ilosc": 0, "img": "img/BitMerge.webp", "ATK": 50, "DEF": 20, "STM": 10, "waga": 3.4, "DASH": 20, "BURST_RES": 80},
                {
                    "id": "139", "typ": "bit","rodzaj": "obrona", "nazwa": "Needle", "skroconaNazwa": "N", "ilosc": 0, "img": "img/BitNeedle.webp", "ATK": 10, "DEF": 50, "STM": 30, "waga": 2.0, "DASH": 10, "BURST_RES": 30},
                {
                    "id": "140", "typ": "bit","rodzaj": "wytrzymalosc", "nazwa": "Orb", "skroconaNazwa": "O", "ilosc": 0, "img": "img/BitOrb.webp", "ATK": 10, "DEF": 30, "STM": 50, "waga": 2.0, "DASH": 10, "BURST_RES": 30},
                {
                    "id": "141", "typ": "bit","rodzaj": "balans", "nazwa": "Point", "skroconaNazwa": "P", "ilosc": 0, "img": "img/BitPoint.webp", "ATK": 25, "DEF": 25, "STM": 25, "waga": 2.2, "DASH": 25, "BURST_RES": 80},
                {
                    "id": "142", "typ": "bit","rodzaj": "atak", "nazwa": "Quake", "skroconaNazwa": "Q", "ilosc": 0, "img": "img/BitQuake.webp", "ATK": 55, "DEF": 15, "STM": 5, "waga": 2.2, "DASH": 25, "BURST_RES": 80},
                {
                    "id": "143", "typ": "bit","rodzaj": "atak", "nazwa": "Rush", "skroconaNazwa": "R", "ilosc": 0, "img": "img/BitRush.webp", "ATK": 40, "DEF": 10, "STM": 20, "waga": 2.1, "DASH": 30, "BURST_RES": 80},
                {
                    "id": "144", "typ": "bit","rodzaj": "obrona", "nazwa": "Spike", "skroconaNazwa": "S", "ilosc": 0, "img": "img/BitSpike.webp", "ATK": 10, "DEF": 45, "STM": 35, "waga": 2, "DASH": 10, "BURST_RES": 30},
                {
                    "id": "145", "typ": "bit","rodzaj": "balans", "nazwa": "Taper", "skroconaNazwa": "T", "ilosc": 0, "img": "img/BitTaper.webp", "ATK": 35, "DEF": 20, "STM": 20, "waga": 2.2, "DASH": 25, "BURST_RES": 80},
                {
                    "id": "146", "typ": "bit","rodzaj": "balans", "nazwa": "Trans Point", "skroconaNazwa": "TP", "ilosc": 0, "img": "img/BitTransPoint.webp", "ATK": 35, "DEF": 25, "STM": 25, "waga": 2.4, "DASH": 15, "BURST_RES": 80},
                {
                    "id": "147", "typ": "bit","rodzaj": "balans", "nazwa": "Unite", "skroconaNazwa": "U", "ilosc": 0, "img": "img/BitUnite.webp", "ATK": 25, "DEF": 25, "STM": 30, "waga": 2.1, "DASH": 25, "BURST_RES": 80},
                {
                    "id": "148", "typ": "bit","rodzaj": "atak", "nazwa": "Accel", "skroconaNazwa": "A", "ilosc": 0, "img": "img/BitAccel.webp", "ATK": 40, "DEF": 10, "STM": 10, "waga": 2.6, "DASH": 40, "BURST_RES": 80},
                {
                    "id": "149", "typ": "bit","rodzaj": "obrona", "nazwa": "Bound Spike", "skroconaNazwa": "BS", "ilosc": 0, "img": "img/BitBoundSpike.webp", "ATK": 5, "DEF": 60, "STM": 30, "waga": 2.0, "DASH": 5, "BURST_RES": 30},
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Dran",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipDran.webp",
                    "id": "150"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Cerberus",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipCerberus.webp",
                    "id": "151"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Fox",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipFox.webp",
                    "id": "152"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Hornet",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipHornet.webp",
                    "id": "153"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Kraken",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipKraken.webp",
                    "id": "154"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Leon",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipLeon.webp",
                    "id": "155"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Pegasus",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipPegasus.webp",
                    "id": "156"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Perseus",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipPerseus.webp",
                    "id": "157"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Rhino",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipRhino.webp",
                    "id": "158"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Sol",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipSol.webp",
                    "id": "159"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Stag",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipStag.webp",
                    "id": "160"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Valkyrie",
                    "ilosc": 0,
                    "waga": 5.6,
                    "img": "img/LockChipValkyrie.webp",
                    "id": "161",
                    "jestMetalowy": true
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Whale",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipWhale.webp",
                    "id": "162"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Wizard",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipWizard.webp",
                    "id": "163"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Flame",
                    "ilosc": 0,
                    "ATK": 5,
                    "DEF": 15,
                    "STM": 40,
                    "waga": 28.5,
                    "img": "img/MainBladeFlame.webp",
                    "id": "164"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Antler",
                    "ilosc": 0,
                    "ATK": 8,
                    "DEF": 15,
                    "STM": 37,
                    "waga": 28.8,
                    "img": "img/Antler.webp",
                    "id": "165"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Arc",
                    "ilosc": 0,
                    "ATK": 10,
                    "DEF": 10,
                    "STM": 40,
                    "waga": 29.2,
                    "img": "img/MainBladeArc.webp",
                    "id": "166"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Blast",
                    "ilosc": 0,
                    "ATK": 50,
                    "DEF": 10,
                    "STM": 15,
                    "waga": 32.8,
                    "img": "img/MainBladeBlast.webp",
                    "id": "167"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Brave",
                    "ilosc": 0,
                    "ATK": 40,
                    "DEF": 10,
                    "STM": 10,
                    "waga": 31.2,
                    "img": "img/MainBladeBrave.webp",
                    "id": "168"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Brush",
                    "ilosc": 0,
                    "ATK": 40,
                    "DEF": 15,
                    "STM": 5,
                    "waga": 30.3,
                    "img": "img/MainBladeBrush.webp",
                    "id": "169"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Dark",
                    "ilosc": 0,
                    "ATK": 10,
                    "DEF": 40,
                    "STM": 10,
                    "waga": 30.3,
                    "img": "img/MainBladeDark.webp",
                    "id": "170"
                },
                {
                    "id": "171",
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Eclipse",
                    "ilosc": 0,
                    "maTryby": true,
                    "tryby": [
                        {
                            "nazwaTrybu": "Upper",
                            "img": "img/eclipse.webp",
                            "ATK": 30,
                            "DEF": 20,
                            "STM": 10,
                            "waga": 32.3
                        },
                        {
                            "nazwaTrybu": "Smash",
                            "img": "img/MainBladeEclipse_29.webp",
                            "ATK": 20,
                            "DEF": 30,
                            "STM": 10,
                            "waga": 32.3
                        }
                    ]
                },


                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Fang",
                    "ilosc": 0,
                    "ATK": 35,
                    "DEF": 10,
                    "STM": 15,
                    "waga": 29.1,
                    "img": "img/MainBladeFang.webp",
                    "id": "172"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Fort",
                    "ilosc": 0,
                    "ATK": 24,
                    "DEF": 12,
                    "STM": 24,
                    "waga": 29.0,
                    "img": "img/MainBladeFort.webp",
                    "id": "173"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Reaper",
                    "ilosc": 0,
                    "ATK": 25,
                    "DEF": 10,
                    "STM": 25,
                    "waga": 29.0,
                    "img": "img/MainBladeReaper.webp",
                    "id": "174"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Volt",
                    "ilosc": 0,
                    "ATK": 45,
                    "DEF": 15,
                    "STM": 15,
                    "waga": 31.0,
                    "img": "img/MainBladeVolt.webp",
                    "id": "175"
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Wriggle",
                    "ilosc": 0,
                    "ATK": 18,
                    "DEF": 2,
                    "STM": 40,
                    "waga": 29.3,
                    "img": "img/MainBladeWriggle.webp",
                    "id": "176"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Assault",
                    "ilosc": 0,
                    "ATK": 25,
                    "DEF": 10,
                    "STM": 5,
                    "waga": 5,
                    "img": "img/AssistBladeAssault.webp",
                    "id": "177"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Bumper",
                    "ilosc": 0,
                    "ATK": 10,
                    "DEF": 20,
                    "STM": 10,
                    "waga": 5.3,
                    "img": "img/AssistBladeBumper.webp",
                    "id": "178"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Charge",
                    "ilosc": 0,
                    "ATK": 15,
                    "DEF": 20,
                    "STM": 5,
                    "waga": 5.0,
                    "img": "img/AssistBladeCharge.webp",
                    "id": "179"
                },

                {
                    "id": "180",
                    "typ": "cx-assist-blade",
                    "nazwa": "Dual",
                    "ilosc": 0,
                    "maTryby": true,
                    "tryby": [
                        {
                            "nazwaTrybu": "Upper",
                            "img": "img/AssistBladeDual.webp",
                            "ATK": 17,
                            "DEF": 13,
                            "STM": 10,
                            "waga": 5.9
                        },
                        {
                            "nazwaTrybu": "Smash",
                            "img": "img/AssistBladeDual_29.webp",
                            "ATK": 13,
                            "DEF": 17,
                            "STM": 10,
                            "waga": 5.9
                        }
                    ]
                },

                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Jaggy",
                    "ilosc": 0,
                    "ATK": 20,
                    "DEF": 15,
                    "STM": 5,
                    "waga": 4.9,
                    "img": "img/AssistBladeJaggy.webp",
                    "id": "181"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Massive",
                    "ilosc": 0,
                    "ATK": 15,
                    "DEF": 15,
                    "STM": 10,
                    "waga": 5.3,
                    "img": "img/AssistBladeMassive.webp",
                    "id": "182"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Round",
                    "ilosc": 0,
                    "ATK": 10,
                    "DEF": 10,
                    "STM": 20,
                    "waga": 4.7,
                    "img": "img/AssistBladeRound.webp",
                    "id": "183"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Slash",
                    "ilosc": 0,
                    "ATK": 10,
                    "DEF": 20,
                    "STM": 10,
                    "waga": 4.7,
                    "img": "img/AssistBladeSlash.webp",
                    "id": "184"
                },
                {
                    "id": "185",
                    "typ": "cx-assist-blade",
                    "nazwa": "Turn",
                    "ilosc": 0,
                    "maTryby": true,
                    "tryby": [
                        {
                            "nazwaTrybu": "Stamina",
                            "img": "img/AssistBladeTurn.webp",
                            "ATK": 10,
                            "DEF": 10,
                            "STM": 20,
                            "waga": 5.9
                        },
                        {
                            "nazwaTrybu": "Attack",
                            "img": "img/AssistBladeTurn2.webp",
                            "ATK": 15,
                            "DEF": 10,
                            "STM": 15,
                            "waga": 5.9
                        }
                    ]
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Wheel",
                    "ilosc": 0,
                    "ATK": 5,
                    "DEF": 15,
                    "STM": 20,
                    "waga": 7.2,
                    "img": "img/AssistBladeWheel.webp",
                    "id": "186"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Hells",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipHells.webp",
                    "id": "187"
                },
                {
                    "id": "188",
                    "typ": "bit","rodzaj": "atak",
                    "nazwa": "Gear Rush",
                    "skroconaNazwa": "GR",
                    "ilosc": 0,
                    "img": "img/BitGearRush.webp",
                    "ATK": 45,
                    "DEF": 10,
                    "STM": 10,
                    "waga": 2.1,
                    "DASH": 35,
                    "BURST_RES": 80
                },
                {
                    "id": "189",
                    "typ": "bit","rodzaj": "balans",
                    "nazwa": "Kick",
                    "skroconaNazwa": "K",
                    "ilosc": 0,
                    "img": "img/BitKick.webp",
                    "ATK": 35,
                    "DEF": 25,
                    "STM": 15,
                    "waga": 2.2,
                    "DASH": 25,
                    "BURST_RES": 80
                },
                {
                    "id": "190",
                    "typ": "bit","rodzaj": "wytrzymalosc",
                    "nazwa": "Low Orb",
                    "skroconaNazwa": "LO",
                    "ilosc": 0,
                    "img": "img/BitLowOrb.webp",
                    "ATK": 5,
                    "DEF": 25,
                    "STM": 55,
                    "waga": 1.85,
                    "DASH": 15,
                    "BURST_RES": 30
                },
                {
                    "id": "191",
                    "typ": "bit","rodzaj": "balans",
                    "nazwa": "Trans Kick",
                    "skroconaNazwa": "TK",
                    "ilosc": 0,
                    "img": "img/BitTransKick.webp",
                    "ATK": 35,
                    "DEF": 30,
                    "STM": 20,
                    "waga": 2.3,
                    "DASH": 15,
                    "BURST_RES": 80
                },
                {
                    "id": "192",
                    "typ": "bit","rodzaj": "atak",
                    "nazwa": "Vortex",
                    "skroconaNazwa": "V",
                    "ilosc": 0,
                    "img": "img/BitVortex.webp",
                    "ATK": 45,
                    "DEF": 10,
                    "STM": 5,
                    "waga": 2.2,
                    "DASH": 40,
                    "BURST_RES": 80
                },
                {
                    "id": "193_wallball",
                    "typ": "bit","rodzaj": "wytrzymalosc",
                    "nazwa": "Wall Ball",
                    "skroconaNazwa": "WB",
                    "ilosc": 0,
                    "img": "img/BitWallBall.webp",
                    "ATK": 15,
                    "DEF": 30,
                    "STM": 45,
                    "waga": 2.41,
                    "DASH": 10,
                    "BURST_RES": 30
                },
                {
                    "id": "193_wedge",
                    "typ": "bit","rodzaj": "obrona",
                    "nazwa": "Wedge",
                    "skroconaNazwa": "W",
                    "ilosc": 0,
                    "img": "img/BitWedge.webp",
                    "ATK": 5,
                    "DEF": 55,
                    "STM": 30,
                    "waga": 1.83,
                    "DASH": 10,
                    "BURST_RES": 30
                },
                {
                    "id": "194",
                    "typ": "bit","rodzaj": "wytrzymalosc",
                    "nazwa": "Disk Ball",
                    "skroconaNazwa": "DB",
                    "ilosc": 0,
                    "img": "img/BitDiskBall.webp",
                    "ATK": 15,
                    "DEF": 20,
                    "STM": 55,
                    "waga": 3.2,
                    "DASH": 10,
                    "BURST_RES": 30
                },
                {
                    "id": "195",
                    "typ": "bit","rodzaj": "wytrzymalosc",
                    "nazwa": "Free Ball",
                    "skroconaNazwa": "FB",
                    "ilosc": 0,
                    "img": "img/BitFreeBall.webp",
                    "ATK": 10,
                    "DEF": 25,
                    "STM": 60,
                    "waga": 1.9,
                    "DASH": 15,
                    "BURST_RES": 30
                },
                {
                    "id": "196",
                    "typ": "bit","rodzaj": "wytrzymalosc",
                    "nazwa": "Glide",
                    "skroconaNazwa": "G",
                    "ilosc": 0,
                    "img": "img/BitGlide.webp",
                    "ATK": 20,
                    "DEF": 10,
                    "STM": 55,
                    "waga": 2.5,
                    "DASH": 15,
                    "BURST_RES": 30
                },
                {
                    "id": "197",
                    "typ": "bit","rodzaj": "balans",
                    "nazwa": "Hexa",
                    "skroconaNazwa": "H",
                    "ilosc": 0,
                    "img": "img/BitHexa.webp",
                    "ATK": 30,
                    "DEF": 35,
                    "STM": 20,
                    "waga": 2.6,
                    "DASH": 15,
                    "BURST_RES": 80
                },
                {
                    "id": "198",
                    "typ": "bit","rodzaj": "atak",
                    "nazwa": "Level",
                    "skroconaNazwa": "L",
                    "ilosc": 0,
                    "img": "img/BitLevel.webp",
                    "ATK": 40,
                    "DEF": 5,
                    "STM": 15,
                    "waga": 2.7,
                    "DASH": 40,
                    "BURST_RES": 80
                },
                {
                    "id": "199",
                    "typ": "bit","rodzaj": "atak",
                    "nazwa": "Low Rush",
                    "skroconaNazwa": "LR",
                    "ilosc": 0,
                    "img": "img/BitLowRush.webp",
                    "ATK": 45,
                    "DEF": 5,
                    "STM": 10,
                    "waga": 1.9,
                    "DASH": 35,
                    "BURST_RES": 80
                },
                {
                    "id": "200",
                    "typ": "bit","rodzaj": "obrona",
                    "nazwa": "Metal Needle",
                    "skroconaNazwa": "MN",
                    "ilosc": 0,
                    "img": "img/BitMetalNeedle.webp",
                    "ATK": 8,
                    "DEF": 57,
                    "STM": 30,
                    "waga": 2.8,
                    "DASH": 5,
                    "BURST_RES": 30
                },
                {
                    "id": "201",
                    "typ": "bit","rodzaj": "atak",
                    "nazwa": "Rubber Accel",
                    "skroconaNazwa": "RA",
                    "ilosc": 0,
                    "img": "img/BitRubberAccel.webp",
                    "ATK": 60,
                    "DEF": 17,
                    "STM": 3,
                    "waga": 3.1,
                    "DASH": 20,
                    "BURST_RES": 80
                },
                {
                    "id": "202",
                    "typ": "bit","rodzaj": "atak",
                    "nazwa": "Under Flat",
                    "skroconaNazwa": "UF",
                    "ilosc": 0,
                    "img": "img/BitUnderFlat.webp",
                    "ATK": 55,
                    "DEF": 5,
                    "STM": 5,
                    "waga": 2.0,
                    "DASH": 35,
                    "BURST_RES": 80
                },
                {
                    "id": "203",
                    "typ": "bit","rodzaj": "obrona",
                    "nazwa": "Under Needle",
                    "skroconaNazwa": "UN",
                    "ilosc": 0,
                    "img": "img/BitUnderNeedle.webp",
                    "ATK": 10,
                    "DEF": 60,
                    "STM": 20,
                    "waga": 1.9,
                    "DASH": 10,
                    "BURST_RES": 30
                },
                {
                    "id": "204",
                    "typ": "bit","rodzaj": "balans",
                    "nazwa": "Zap",
                    "skroconaNazwa": "Z",
                    "ilosc": 0,
                    "img": "img/BitZap.webp",
                    "ATK": 30,
                    "DEF": 20,
                    "STM": 15,
                    "waga": 2.5,
                    "DASH": 35,
                    "BURST_RES": 80
                },
                {
                    "id": "205",
                    "typ": "rachet",
                    "nazwa": "Turbo",
                    "skroconaNazwa": "Tr",
                    "rodzaj": "atak",
                    "ilosc": 0,
                    "img": "img/RatchetBitTurbo.webp",
                    "integrujeBit": true,
                    "ilosc": 0,
                    "maTryby": true,
                    "tryby": [
                        {
                            "nazwaTrybu": "Stamina",

                            "ATK": 30,
                            "DEF": 30,
                            "STM": 60,
                            "waga": 12.8,
                            "DASH": 10,
                            "BURST_RES": 30
                        },
                        {
                            "nazwaTrybu": "Attack",

                            "ATK": 55,
                            "DEF": 20,
                            "STM": 10,
                            "waga": 9.0,
                            "DASH": 45,
                            "BURST_RES": 30
                        }
                    ]
                },
                {
                    "id": "206", "typ": "ux-blade","kierunek": "prawy", "nazwa": "ClockMirage", "ilosc": 0, "img": "img/BladeClockMirage.webp", "ATK": 10, "DEF": 10, "STM": 80, "waga": 37.6},
                {
                    "id": "207", "typ": "rachet", "nazwa": "9-65", "ilosc": 0, "img": "img/Ratchet9-65.webp", "ATK": 8, "DEF": 19, "STM": 13, "waga": 10.6},
                {
                    "id": "208",
                    "typ": "rachet",
                    "nazwa": "Operate",
                    "skroconaNazwa": "Op",
                    "rodzaj": "balans",
                    "ilosc": 0,
                    "img": "img/RachetBitOperate.webp",
                    "integrujeBit": true,
                    "maTryby": true,
                    "tryby": [
                        {
                            "nazwaTrybu": "Defence",

                            "ATK": 20,
                            "DEF": 50,
                            "STM": 50,
                            "waga": 14.13,
                            "DASH": 10,
                            "BURST_RES": 30
                        },
                        {
                            "nazwaTrybu": "Attack",

                            "ATK": 50,
                            "DEF": 35,
                            "STM": 10,
                            "waga": 14.13,
                            "DASH": 35,
                            "BURST_RES": 30
                        }
                    ]
                },
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Might",
                    "ilosc": 0,
                    "ATK": 25,
                    "DEF": 25,
                    "STM": 25,
                    "waga": 33.1,
                    "img": "img/MainBladeMight.webp",
                    "id": "209"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Heavy",
                    "ilosc": 0,
                    "ATK": 17,
                    "DEF": 17,
                    "STM": 11,
                    "waga": 7.8,
                    "img": "img/AssistBladeHeavy.webp",
                    "id": "210"
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Emperor",
                    "ilosc": 0,
                    "waga": 4.7,
                    "img": "img/LockChipEmperor.webp",
                    "id": "211",
                    "jestMetalowy": true
                },
                {
                    "typ": "cx-lock-chip",
                    "nazwa": "Wolf",
                    "ilosc": 0,
                    "waga": 1.7,
                    "img": "img/LockChipWolf.webp",
                    "id": "212"
                },
                {
                    "id": "213", "typ": "rachet", "nazwa": "0-60", "ilosc": 0, "img": "img/Ratchet0-60.webp", "ATK": 3, "DEF": 14, "STM": 13, "waga": 6.9},
                {
                    "typ": "cx-main-blade","kierunek": "prawy",
                    "nazwa": "Hunt",
                    "ilosc": 0,
                    "ATK": 20,
                    "DEF": 10,
                    "STM": 30,
                    "waga": 31.6,
                    "img": "img/MainBladeHunt.webp",
                    "id": "214"
                },
                {
                    "typ": "cx-assist-blade",
                    "nazwa": "Free",
                    "ilosc": 0,
                    "ATK": 5,
                    "DEF": 20,
                    "STM": 25,
                    "waga": 5.8,
                    "img": "img/AssistBladeFree.webp",
                    "id": "216"
                },
				  {
  "id": "217", "typ": "ux-blade","kierunek": "lewy", "nazwa": "MeteorDragoon", "ilosc": 0, "img":"img/BladeMeteorDragoon.png", "ATK": 75, "DEF": 15, "STM": 35, "waga": 0},
    {
  "id": "218", "typ": "ux-blade","kierunek": "prawy", "nazwa": "MummyCurse", "ilosc": 0, "img":"img/BladeMummyCurse.png", "ATK": 30, "DEF": 60, "STM": 20, "waga": 0},
  {
                    "id": "219",
                    "typ": "bit","rodzaj": "atak",
                    "nazwa": "Jolt",
                    "skroconaNazwa": "J",
                    "ilosc": 0,
                    "img": "img/BitJolt.png",
                    "ATK": 35,
                    "DEF": 10,
                    "STM": 15,
                    "waga": 0,
                    "DASH": 40,
                    "BURST_RES": 80
                },
				  {
                    "id": "220", "typ": "rachet", "nazwa": "7-55", "ilosc": 0, "img": "img/Ratchet7-55.webp", "ATK": 6, "DEF": 14, "STM": 10, "waga": 0},
              
  
                {
                    "id": "221", "typ": "ux-blade","kierunek": "prawy", "nazwa": "OrochiCluster", "ilosc": 0, "img":"img/BladeOrochiCluster.png", "ATK": 0, "DEF": 0, "STM": 0, "waga": 0}
             
            ]
        </script>
		<!-- ============================================= -->
<!-- === POP-UP LOGOWANIA/REJESTRACJI (NOWY) === -->
<!-- ============================================= -->
<div id="auth-overlay" style="display: none;">
    <div id="auth-popup">
        <button id="close-auth-popup" onclick="hideAuthPopup()">Ã—</button>
        <h3 id="auth-title">Logowanie</h3>
        <input type="email" id="auth-email" placeholder="Adres e-mail" autocomplete="email">
        <input type="password" id="auth-password" placeholder="HasÅ‚o" autocomplete="current-password">
        <div id="auth-error-message" style="display:none; color: #ff6b6b; margin-bottom: 10px;"></div>
        <button id="auth-submit-button" onclick="handleAuth()">Zaloguj siÄ™</button>
    </div>
</div>

</html>